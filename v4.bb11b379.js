parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"Jx9Q":[function(require,module,exports) {
var define;
var global = arguments[3];
var e,t=arguments[3];!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof e&&e.amd?e(r):t.createREGL=r()}(this,function(){"use strict";var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;++n)e[r[n]]=t[r[n]];return e},r="\n";function n(e){var t=new Error("(regl) "+e);throw console.error(t),t}function a(e,t){e||n(t)}function i(e){return e?": "+e:""}function o(e,t,r){t.indexOf(e)<0&&n("invalid value"+i(r)+". must be one of: "+t)}var f=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function u(e,t){for(e+="";e.length<t;)e=" "+e;return e}function s(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function c(e,t){this.number=e,this.line=t,this.errors=[]}function l(e,t,r){this.file=e,this.line=t,this.message=r}function d(){var e=new Error,t=(e.stack||e).toString(),r=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return n?n[1]:"unknown"}function m(){var e=new Error,t=(e.stack||e).toString(),r=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(r)return r[1];var n=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return n?n[1]:"unknown"}function p(e,t){var r,n=e.split("\n"),a=1,i=0,o={unknown:new s,0:new s};o.unknown.name=o[0].name=t||d(),o.unknown.lines.push(new c(0,""));for(var f=0;f<n.length;++f){var u=n[f],l=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var m=/(\d+)(\s+\d+)?/.exec(l[2]);m&&(a=0|m[1],m[2]&&((i=0|m[2])in o||(o[i]=new s)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);p&&(o[i].name=p[1]?(r=p[2],"undefined"!=typeof atob?atob(r):"base64:"+r):p[2])}o[i].lines.push(new c(a++,u))}return Object.keys(o).forEach(function(e){var t=o[e];t.lines.forEach(function(e){t.index[e.number]=e})}),o}function h(e){e._commandRef=d()}function b(e,t){var r=m();n(e+" in command "+(t||d())+("unknown"===r?"":" called from "+r))}function g(e,t,r,n){typeof e!==t&&b("invalid parameter type"+i(r)+". expected "+t+", got "+typeof e,n||d())}var v=33071,y=9728,x=9984,w=9985,k=9986,A=9987,_=5126,S=32819,T=32820,E=33635,D=34042,j={};function O(e,t){return e===T||e===S||e===E?2:e===D?4:j[e]*t}function C(e){return!(e&e-1||!e)}j[5120]=j[5121]=1,j[5122]=j[5123]=j[36193]=j[E]=j[S]=j[T]=2,j[5124]=j[5125]=j[_]=j[D]=4;var F=t(a,{optional:function(e){e()},raise:n,commandRaise:b,command:function(e,t,r){e||b(t,r||d())},parameter:function(e,t,r){e in t||n("unknown parameter ("+e+")"+i(r)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,r,n){e in t||b("unknown parameter ("+e+")"+i(r)+". possible values: "+Object.keys(t).join(),n||d())},constructor:function(e){Object.keys(e).forEach(function(e){f.indexOf(e)<0&&n('invalid regl constructor argument "'+e+'". must be one of '+f)})},type:function(e,t,r){typeof e!==t&&n("invalid parameter type"+i(r)+". expected "+t+", got "+typeof e)},commandType:g,isTypedArray:function(t,r){e(t)||n("invalid parameter type"+i(r)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||n("invalid parameter type, ("+e+")"+i(t)+". must be a nonnegative integer")},oneOf:o,shaderError:function(e,t,n,i,o){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var f=e.getShaderInfoLog(t),s=i===e.FRAGMENT_SHADER?"fragment":"vertex";g(n,"string",s+" shader source must be a string",o);var c=p(n,o),d=function(e){var t=[];return e.split("\n").forEach(function(e){if(!(e.length<5)){var r=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(e);r?t.push(new l(0|r[1],0|r[2],r[3].trim())):e.length>0&&t.push(new l("unknown",0,e))}}),t}(f);!function(e,t){t.forEach(function(t){var r=e[t.file];if(r){var n=r.index[t.line];if(n)return n.errors.push(t),void(r.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)})}(c,d),Object.keys(c).forEach(function(e){var t=c[e];if(t.hasErrors){var n=[""],a=[""];i("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach(function(e){if(e.errors.length>0){i(u(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),i(e.line+r,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach(function(n){var a=n.message,o=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(a);if(o){var f=o[1];switch(a=o[2],f){case"assign":f="="}t=Math.max(e.line.indexOf(f,t),0)}else t=0;i(u("| ",6)),i(u("^^^",t+3)+r,"font-weight:bold"),i(u("| ",6)),i(a+r,"font-weight:bold")}),i(u("| ",6)+r)}else i(u(e.number,4)+"|  "),i(e.line+r,"color:red")}),"undefined"==typeof document||window.chrome?console.log(n.join("")):(a[0]=n.join("%c"),console.log.apply(console,a))}function i(e,t){n.push(e),a.push(t||"")}}),a.raise("Error compiling "+s+" shader, "+c[0].name)}},linkError:function(e,t,n,i,o){if(!e.getProgramParameter(t,e.LINK_STATUS)){var f=e.getProgramInfoLog(t),u=p(n,o),s='Error linking program with vertex shader, "'+p(i,o)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+s+r+"%c"+f,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(s+r+f),a.raise(s)}},callSite:m,saveCommandRef:h,saveDrawInfo:function(e,t,r,n){function a(e){return e?n.id(e):0}function i(e,t){Object.keys(t).forEach(function(t){e[n.id(t)]=!0})}h(e),e._fragId=a(e.static.frag),e._vertId=a(e.static.vert);var o=e._uniformSet={};i(o,t.static),i(o,t.dynamic);var f=e._attributeSet={};i(f,r.static),i(f,r.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,r){e.texture?o(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):o(e.renderbuffer._renderbuffer.format,r,"unsupported renderbuffer format for attachment")},guessCommand:d,texture2D:function(e,t,r){var n,i=t.width,o=t.height,f=t.channels;a(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),e.wrapS===v&&e.wrapT===v||a(C(i)&&C(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==o&&a(e.minFilter!==x&&e.minFilter!==k&&e.minFilter!==w&&e.minFilter!==A,"min filter requires mipmap"):(a(C(i)&&C(o),"texture must be a square power of 2 to support mipmapping"),a(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),t.type===_&&(r.extensions.indexOf("oes_texture_float_linear")<0&&a(e.minFilter===y&&e.magFilter===y,"filter not supported, must enable oes_texture_float_linear"),a(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(n=0;n<16;++n)if(u[n]){var s=i>>n,c=o>>n;a(t.mipmask&1<<n,"missing mipmap data");var l=u[n];if(a(l.width===s&&l.height===c,"invalid shape for mip images"),a(l.format===t.format&&l.internalformat===t.internalformat&&l.type===t.type,"incompatible type for mip image"),l.compressed);else if(l.data){var d=Math.ceil(O(l.type,f)*s/l.unpackAlignment)*l.unpackAlignment;a(l.data.byteLength===d*c,"invalid data for image, buffer size is inconsistent with image format")}else l.element||l.copy}else e.genMipmaps||a(0==(t.mipmask&1<<n),"extra mipmap data");t.compressed&&a(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,r,n){var i=e.width,o=e.height,f=e.channels;a(i>0&&i<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),a(i===o,"cube map must be square"),a(t.wrapS===v&&t.wrapT===v,"wrap mode not supported by cube map");for(var u=0;u<r.length;++u){var s=r[u];a(s.width===i&&s.height===o,"inconsistent cube map face shape"),t.genMipmaps&&(a(!s.compressed,"can not generate mipmap for compressed textures"),a(1===s.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=s.images,l=0;l<16;++l){var d=c[l];if(d){var m=i>>l,p=o>>l;a(s.mipmask&1<<l,"missing mipmap data"),a(d.width===m&&d.height===p,"invalid shape for mip images"),a(d.format===e.format&&d.internalformat===e.internalformat&&d.type===e.type,"incompatible type for mip image"),d.compressed||(d.data?a(d.data.byteLength===m*p*Math.max(O(d.type,f),d.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):d.element||d.copy)}}}}}),z=0,B=0;function P(e,t){this.id=z++,this.type=e,this.data=t}function I(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function R(e){return"["+function e(t){if(0===t.length)return[];var r=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&r===n&&('"'===r||"'"===r))return['"'+I(t.substr(1,t.length-2))+'"'];var a=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(a)return e(t.substr(0,a.index)).concat(e(a[1])).concat(e(t.substr(a.index+a[0].length)));var i=t.split(".");if(1===i.length)return['"'+I(t)+'"'];for(var o=[],f=0;f<i.length;++f)o=o.concat(e(i[f]));return o}(e).join("][")+"]"}var L={DynamicVariable:P,define:function(e,t){return new P(e,R(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof P},unbox:function(e,t){return"function"==typeof e?new P(B,e):e},accessor:R},M={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},W="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function U(e){return"string"==typeof e?e.split():(F(Array.isArray(e),"invalid extension array"),e)}function H(e){return"string"==typeof e?(F("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function G(e){var r,n,a,i,o,f=e||{},u={},s=[],c=[],l="undefined"==typeof window?1:window.devicePixelRatio,d=!1,m=function(e){e&&F.raise(e)},p=function(){};if("string"==typeof f?(F("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),r=document.querySelector(f),F(r,"invalid query string for element")):"object"==typeof f?"string"==typeof(o=f).nodeName&&"function"==typeof o.appendChild&&"function"==typeof o.getBoundingClientRect?r=f:!function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(f)?(F.constructor(f),"gl"in f?i=f.gl:"canvas"in f?a=H(f.canvas):"container"in f&&(n=H(f.container)),"attributes"in f&&(u=f.attributes,F.type(u,"object","invalid context attributes")),"extensions"in f&&(s=U(f.extensions)),"optionalExtensions"in f&&(c=U(f.optionalExtensions)),"onDone"in f&&(F.type(f.onDone,"function","invalid or missing onDone callback"),m=f.onDone),"profile"in f&&(d=!!f.profile),"pixelRatio"in f&&(l=+f.pixelRatio,F(l>0,"invalid pixel ratio"))):a=(i=f).canvas:F.raise("invalid arguments to regl"),r&&("canvas"===r.nodeName.toLowerCase()?a=r:n=r),!i){if(!a){F("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var h=function(e,r,n){var a=document.createElement("canvas");function i(){var r=window.innerWidth,i=window.innerHeight;if(e!==document.body){var o=e.getBoundingClientRect();r=o.right-o.left,i=o.bottom-o.top}a.width=n*r,a.height=n*i,t(a.style,{width:r+"px",height:i+"px"})}return t(a.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(a),e===document.body&&(a.style.position="absolute",t(e.style,{margin:0,padding:0})),window.addEventListener("resize",i,!1),i(),{canvas:a,onDestroy:function(){window.removeEventListener("resize",i),e.removeChild(a)}}}(n||document.body,0,l);if(!h)return null;a=h.canvas,p=h.onDestroy}i=function(e,t){function r(r){try{return e.getContext(r,t)}catch(n){return null}}return r("webgl")||r("experimental-webgl")||r("webgl-experimental")}(a,u)}return i?{gl:i,canvas:a,container:n,extensions:s,optionalExtensions:c,pixelRatio:l,profile:d,onDone:m,onDestroy:p}:(p(),m("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function q(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=t(n);return r}var N=5120,Q=5121,V=5122,Y=5123,X=5124,$=5125,K=5126;function J(e){var t,r;return t=(e>65535)<<4,t|=r=((e>>>=t)>255)<<3,t|=r=((e>>>=r)>15)<<2,(t|=r=((e>>>=r)>3)<<1)|(e>>>=r)>>1}function Z(){var e=q(8,function(){return[]});function t(t){var r=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),n=e[J(r)>>2];return n.length>0?n.pop():new ArrayBuffer(r)}function r(t){e[J(t.byteLength)>>2].push(t)}return{alloc:t,free:r,allocType:function(e,r){var n=null;switch(e){case N:n=new Int8Array(t(r),0,r);break;case Q:n=new Uint8Array(t(r),0,r);break;case V:n=new Int16Array(t(2*r),0,r);break;case Y:n=new Uint16Array(t(2*r),0,r);break;case X:n=new Int32Array(t(4*r),0,r);break;case $:n=new Uint32Array(t(4*r),0,r);break;case K:n=new Float32Array(t(4*r),0,r);break;default:return null}return n.length!==r?n.subarray(0,r):n},freeType:function(e){r(e.buffer)}}}var ee=Z();ee.zero=Z();var te=function(e,t){var r=1;t.ext_texture_filter_anisotropic&&(r=e.getParameter(34047));var n=1,a=1;t.webgl_draw_buffers&&(n=e.getParameter(34852),a=e.getParameter(36063));var i=!!t.oes_texture_float;if(i){var o=e.createTexture();e.bindTexture(3553,o),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var f=e.createFramebuffer();if(e.bindFramebuffer(36160,f),e.framebufferTexture2D(36160,36064,3553,o,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))i=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=ee.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,u),e.getError()?i=!1:(e.deleteFramebuffer(f),e.deleteTexture(o),i=1===u[0]),ee.freeType(u)}}var s=!0;if(!("undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)))){var c=e.createTexture(),l=ee.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,c),e.texImage2D(34069,0,6408,3,3,0,6408,5121,l),ee.freeType(l),e.bindTexture(34067,null),e.deleteTexture(c),s=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:r,maxDrawbuffers:n,maxColorAttachments:a,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:i,npotTextureCube:s}};function re(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var ne=function(e){return Object.keys(e).map(function(t){return e[t]})},ae={shape:function(e){for(var t=[],r=e;r.length;r=r[0])t.push(r.length);return t},flatten:function(e,t,r,n){var a=1;if(t.length)for(var i=0;i<t.length;++i)a*=t[i];else a=0;var o=n||ee.allocType(r,a);switch(t.length){case 0:break;case 1:!function(e,t,r){for(var n=0;n<t;++n)r[n]=e[n]}(e,t[0],o);break;case 2:!function(e,t,r,n){for(var a=0,i=0;i<t;++i)for(var o=e[i],f=0;f<r;++f)n[a++]=o[f]}(e,t[0],t[1],o);break;case 3:ie(e,t[0],t[1],t[2],o,0);break;default:!function e(t,r,n,a,i){var o=1;for(var f=n+1;f<r.length;++f)o*=r[f];var u=r[n];if(r.length-n==4){var s=r[n+1],c=r[n+2],l=r[n+3];for(f=0;f<u;++f)ie(t[f],s,c,l,a,i),i+=o}else for(f=0;f<u;++f)e(t[f],r,n+1,a,i),i+=o}(e,t,0,o,0)}return o}};function ie(e,t,r,n,a,i){for(var o=i,f=0;f<t;++f)for(var u=e[f],s=0;s<r;++s)for(var c=u[s],l=0;l<n;++l)a[o++]=c[l]}var oe={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},fe={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},ue={dynamic:35048,stream:35040,static:35044},se=ae.flatten,ce=ae.shape,le=35044,de=35040,me=5121,pe=5126,he=[];function be(e){return 0|oe[Object.prototype.toString.call(e)]}function ge(e,t){for(var r=0;r<t.length;++r)e[r]=t[r]}function ve(e,t,r,n,a,i,o){for(var f=0,u=0;u<r;++u)for(var s=0;s<n;++s)e[f++]=t[a*u+i*s+o]}he[5120]=1,he[5122]=2,he[5124]=4,he[5121]=1,he[5123]=2,he[5125]=4,he[5126]=4;var ye={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},xe=0,we=1,ke=4,Ae=5120,_e=5121,Se=5122,Te=5123,Ee=5124,De=5125,je=34963,Oe=35040,Ce=35044;var Fe=new Float32Array(1),ze=new Uint32Array(Fe.buffer),Be=5123;function Pe(e){for(var t=ee.allocType(Be,e.length),r=0;r<e.length;++r)if(isNaN(e[r]))t[r]=65535;else if(e[r]===1/0)t[r]=31744;else if(e[r]===-1/0)t[r]=64512;else{Fe[0]=e[r];var n=ze[0],a=n>>>31<<15,i=(n<<1>>>24)-127,o=n>>13&1023;if(i<-24)t[r]=a;else if(i<-14){var f=-14-i;t[r]=a+(o+1024>>f)}else t[r]=i>15?a+31744:a+(i+15<<10)+o}return t}function Ie(t){return Array.isArray(t)||e(t)}var Re=function(e){return!(e&e-1||!e)},Le=34467,Me=3553,We=34067,Ue=34069,He=6408,Ge=6406,qe=6407,Ne=6409,Qe=6410,Ve=32854,Ye=32855,Xe=36194,$e=32819,Ke=32820,Je=33635,Ze=34042,et=6402,tt=34041,rt=35904,nt=35906,at=36193,it=33776,ot=33777,ft=33778,ut=33779,st=35986,ct=35987,lt=34798,dt=35840,mt=35841,pt=35842,ht=35843,bt=36196,gt=5121,vt=5123,yt=5125,xt=5126,wt=10242,kt=10243,At=10497,_t=33071,St=33648,Tt=10240,Et=10241,Dt=9728,jt=9729,Ot=9984,Ct=9985,Ft=9986,zt=9987,Bt=33170,Pt=4352,It=4353,Rt=4354,Lt=34046,Mt=3317,Wt=37440,Ut=37441,Ht=37443,Gt=37444,qt=33984,Nt=[Ot,Ft,Ct,zt],Qt=[0,Ne,Qe,qe,He],Vt={};function Yt(e){return"[object "+e+"]"}Vt[Ne]=Vt[Ge]=Vt[et]=1,Vt[tt]=Vt[Qe]=2,Vt[qe]=Vt[rt]=3,Vt[He]=Vt[nt]=4;var Xt=Yt("HTMLCanvasElement"),$t=Yt("CanvasRenderingContext2D"),Kt=Yt("ImageBitmap"),Jt=Yt("HTMLImageElement"),Zt=Yt("HTMLVideoElement"),er=Object.keys(oe).concat([Xt,$t,Kt,Jt,Zt]),tr=[];tr[gt]=1,tr[xt]=4,tr[at]=2,tr[vt]=2,tr[yt]=4;var rr=[];function nr(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function ar(e){return!!Array.isArray(e)&&!(0===e.length||!Ie(e[0]))}function ir(e){return Object.prototype.toString.call(e)}function or(e){return ir(e)===Xt}function fr(e){if(!e)return!1;var t=ir(e);return er.indexOf(t)>=0||(nr(e)||ar(e)||re(e))}function ur(e){return 0|oe[Object.prototype.toString.call(e)]}function sr(e,t){return ee.allocType(e.type===at?xt:e.type,t)}function cr(e,t){e.type===at?(e.data=Pe(t),ee.freeType(t)):e.data=t}function lr(e,t,r,n,a,i){var o;if(o=void 0!==rr[e]?rr[e]:Vt[e]*tr[t],i&&(o*=6),a){for(var f=0,u=r;u>=1;)f+=o*u*u,u/=2;return f}return o*r*n}function dr(r,n,a,i,o,f,u){var s={"don't care":Pt,"dont care":Pt,nice:Rt,fast:It},c={repeat:At,clamp:_t,mirror:St},l={nearest:Dt,linear:jt},d=t({mipmap:zt,"nearest mipmap nearest":Ot,"linear mipmap nearest":Ct,"nearest mipmap linear":Ft,"linear mipmap linear":zt},l),m={none:0,browser:Gt},p={uint8:gt,rgba4:$e,rgb565:Je,"rgb5 a1":Ke},h={alpha:Ge,luminance:Ne,"luminance alpha":Qe,rgb:qe,rgba:He,rgba4:Ve,"rgb5 a1":Ye,rgb565:Xe},b={};n.ext_srgb&&(h.srgb=rt,h.srgba=nt),n.oes_texture_float&&(p.float32=p.float=xt),n.oes_texture_half_float&&(p.float16=p["half float"]=at),n.webgl_depth_texture&&(t(h,{depth:et,"depth stencil":tt}),t(p,{uint16:vt,uint32:yt,"depth stencil":Ze})),n.webgl_compressed_texture_s3tc&&t(b,{"rgb s3tc dxt1":it,"rgba s3tc dxt1":ot,"rgba s3tc dxt3":ft,"rgba s3tc dxt5":ut}),n.webgl_compressed_texture_atc&&t(b,{"rgb atc":st,"rgba atc explicit alpha":ct,"rgba atc interpolated alpha":lt}),n.webgl_compressed_texture_pvrtc&&t(b,{"rgb pvrtc 4bppv1":dt,"rgb pvrtc 2bppv1":mt,"rgba pvrtc 4bppv1":pt,"rgba pvrtc 2bppv1":ht}),n.webgl_compressed_texture_etc1&&(b["rgb etc1"]=bt);var g=Array.prototype.slice.call(r.getParameter(Le));Object.keys(b).forEach(function(e){var t=b[e];g.indexOf(t)>=0&&(h[e]=t)});var v=Object.keys(h);a.textureFormats=v;var y=[];Object.keys(h).forEach(function(e){var t=h[e];y[t]=e});var x=[];Object.keys(p).forEach(function(e){var t=p[e];x[t]=e});var w=[];Object.keys(l).forEach(function(e){var t=l[e];w[t]=e});var k=[];Object.keys(d).forEach(function(e){var t=d[e];k[t]=e});var A=[];Object.keys(c).forEach(function(e){var t=c[e];A[t]=e});var _=v.reduce(function(e,t){var r=h[t];return r===Ne||r===Ge||r===Ne||r===Qe||r===et||r===tt?e[r]=r:r===Ye||t.indexOf("rgba")>=0?e[r]=He:e[r]=qe,e},{});function S(){this.internalformat=He,this.format=He,this.type=gt,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Gt,this.width=0,this.height=0,this.channels=0}function T(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function E(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(F.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(F.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(F.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(F.parameter(t.colorSpace,m,"invalid colorSpace"),e.colorSpace=m[t.colorSpace]),"type"in t){var r=t.type;F(n.oes_texture_float||!("float"===r||"float32"===r),"you must enable the OES_texture_float extension in order to use floating point textures."),F(n.oes_texture_half_float||!("half float"===r||"float16"===r),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),F(n.webgl_depth_texture||!("uint16"===r||"uint32"===r||"depth stencil"===r),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),F.parameter(r,p,"invalid texture type"),e.type=p[r]}var i=e.width,o=e.height,f=e.channels,u=!1;"shape"in t?(F(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),i=t.shape[0],o=t.shape[1],3===t.shape.length&&(f=t.shape[2],F(f>0&&f<=4,"invalid number of channels"),u=!0),F(i>=0&&i<=a.maxTextureSize,"invalid width"),F(o>=0&&o<=a.maxTextureSize,"invalid height")):("radius"in t&&(i=o=t.radius,F(i>=0&&i<=a.maxTextureSize,"invalid radius")),"width"in t&&(i=t.width,F(i>=0&&i<=a.maxTextureSize,"invalid width")),"height"in t&&(o=t.height,F(o>=0&&o<=a.maxTextureSize,"invalid height")),"channels"in t&&(f=t.channels,F(f>0&&f<=4,"invalid number of channels"),u=!0)),e.width=0|i,e.height=0|o,e.channels=0|f;var s=!1;if("format"in t){var c=t.format;F(n.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),F.parameter(c,h,"invalid texture format");var l=e.internalformat=h[c];e.format=_[l],c in p&&("type"in t||(e.type=p[c])),c in b&&(e.compressed=!0),s=!0}!u&&s?e.channels=Vt[e.format]:u&&!s?e.channels!==Qt[e.format]&&(e.format=e.internalformat=Qt[e.channels]):s&&u&&F(e.channels===Vt[e.format],"number of channels inconsistent with specified format")}}function D(e){r.pixelStorei(Wt,e.flipY),r.pixelStorei(Ut,e.premultiplyAlpha),r.pixelStorei(Ht,e.colorSpace),r.pixelStorei(Mt,e.unpackAlignment)}function j(){S.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function O(t,r){var n=null;if(fr(r)?n=r:r&&(F.type(r,"object","invalid pixel data type"),E(t,r),"x"in r&&(t.xOffset=0|r.x),"y"in r&&(t.yOffset=0|r.y),fr(r.data)&&(n=r.data)),F(!t.compressed||n instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),r.copy){F(!n,"can not specify copy and data field for the same texture");var i=o.viewportWidth,f=o.viewportHeight;t.width=t.width||i-t.xOffset,t.height=t.height||f-t.yOffset,t.needsCopy=!0,F(t.xOffset>=0&&t.xOffset<i&&t.yOffset>=0&&t.yOffset<f&&t.width>0&&t.width<=i&&t.height>0&&t.height<=f,"copy texture read out of bounds")}else if(n){if(e(n))t.channels=t.channels||4,t.data=n,"type"in r||t.type!==gt||(t.type=ur(n));else if(nr(n))t.channels=t.channels||4,function(e,t){var r=t.length;switch(e.type){case gt:case vt:case yt:case xt:var n=ee.allocType(e.type,r);n.set(t),e.data=n;break;case at:e.data=Pe(t);break;default:F.raise("unsupported texture type, must specify a typed array")}}(t,n),t.alignment=1,t.needsFree=!0;else if(re(n)){var u=n.data;Array.isArray(u)||t.type!==gt||(t.type=ur(u));var s,c,l,d,m,p,h=n.shape,b=n.stride;3===h.length?(l=h[2],p=b[2]):(F(2===h.length,"invalid ndarray pixel data, must be 2 or 3D"),l=1,p=1),s=h[0],c=h[1],d=b[0],m=b[1],t.alignment=1,t.width=s,t.height=c,t.channels=l,t.format=t.internalformat=Qt[l],t.needsFree=!0,function(e,t,r,n,a,i){for(var o=e.width,f=e.height,u=e.channels,s=sr(e,o*f*u),c=0,l=0;l<f;++l)for(var d=0;d<o;++d)for(var m=0;m<u;++m)s[c++]=t[r*d+n*l+a*m+i];cr(e,s)}(t,u,d,m,p,n.offset)}else if(or(n)||ir(n)===$t)or(n)?t.element=n:t.element=n.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(e){return ir(e)===Kt}(n))t.element=n,t.width=n.width,t.height=n.height,t.channels=4;else if(function(e){return ir(e)===Jt}(n))t.element=n,t.width=n.naturalWidth,t.height=n.naturalHeight,t.channels=4;else if(function(e){return ir(e)===Zt}(n))t.element=n,t.width=n.videoWidth,t.height=n.videoHeight,t.channels=4;else if(ar(n)){var g=t.width||n[0].length,v=t.height||n.length,y=t.channels;y=Ie(n[0][0])?y||n[0][0].length:y||1;for(var x=ae.shape(n),w=1,k=0;k<x.length;++k)w*=x[k];var A=sr(t,w);ae.flatten(n,x,"",A),cr(t,A),t.alignment=1,t.width=g,t.height=v,t.channels=y,t.format=t.internalformat=Qt[y],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===xt?F(a.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===at&&F(a.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function C(e,t,n){var a=e.element,o=e.data,f=e.internalformat,u=e.format,s=e.type,c=e.width,l=e.height,d=e.channels;if(D(e),a)r.texImage2D(t,n,u,u,s,a);else if(e.compressed)r.compressedTexImage2D(t,n,f,c,l,0,o);else if(e.needsCopy)i(),r.copyTexImage2D(t,n,u,e.xOffset,e.yOffset,c,l,0);else{var m=!o;m&&(o=ee.zero.allocType(s,c*l*d)),r.texImage2D(t,n,u,c,l,0,u,s,o),m&&o&&ee.zero.freeType(o)}}function z(e,t,n,a,o){var f=e.element,u=e.data,s=e.internalformat,c=e.format,l=e.type,d=e.width,m=e.height;D(e),f?r.texSubImage2D(t,o,n,a,c,l,f):e.compressed?r.compressedTexSubImage2D(t,o,n,a,s,d,m,u):e.needsCopy?(i(),r.copyTexSubImage2D(t,o,n,a,e.xOffset,e.yOffset,d,m)):r.texSubImage2D(t,o,n,a,d,m,c,l,u)}var B=[];function P(){return B.pop()||new j}function I(e){e.needsFree&&ee.freeType(e.data),j.call(e),B.push(e)}function R(){S.call(this),this.genMipmaps=!1,this.mipmapHint=Pt,this.mipmask=0,this.images=Array(16)}function L(e,t,r){var n=e.images[0]=P();e.mipmask=1,n.width=e.width=t,n.height=e.height=r,n.channels=e.channels=4}function M(e,t){var r=null;if(fr(t))T(r=e.images[0]=P(),e),O(r,t),e.mipmask=1;else if(E(e,t),Array.isArray(t.mipmap))for(var n=t.mipmap,a=0;a<n.length;++a)T(r=e.images[a]=P(),e),r.width>>=a,r.height>>=a,O(r,n[a]),e.mipmask|=1<<a;else T(r=e.images[0]=P(),e),O(r,t),e.mipmask=1;T(e,e.images[0]),(e.compressed&&e.internalformat===it||e.internalformat===ot||e.internalformat===ft||e.internalformat===ut)&&F(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function W(e,t){for(var r=e.images,n=0;n<r.length;++n){if(!r[n])return;C(r[n],t,n)}}var U=[];function H(){var e=U.pop()||new R;S.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function G(e){for(var t=e.images,r=0;r<t.length;++r)t[r]&&I(t[r]),t[r]=null;U.push(e)}function q(){this.minFilter=Dt,this.magFilter=Dt,this.wrapS=_t,this.wrapT=_t,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Pt}function N(e,t){if("min"in t){var r=t.min;F.parameter(r,d),e.minFilter=d[r],Nt.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var n=t.mag;F.parameter(n,l),e.magFilter=l[n]}var i=e.wrapS,o=e.wrapT;if("wrap"in t){var f=t.wrap;"string"==typeof f?(F.parameter(f,c),i=o=c[f]):Array.isArray(f)&&(F.parameter(f[0],c),F.parameter(f[1],c),i=c[f[0]],o=c[f[1]])}else{if("wrapS"in t){var u=t.wrapS;F.parameter(u,c),i=c[u]}if("wrapT"in t){var m=t.wrapT;F.parameter(m,c),o=c[m]}}if(e.wrapS=i,e.wrapT=o,"anisotropic"in t){var p=t.anisotropic;F("number"==typeof p&&p>=1&&p<=a.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var h=!1;switch(typeof t.mipmap){case"string":F.parameter(t.mipmap,s,"invalid mipmap hint"),e.mipmapHint=s[t.mipmap],e.genMipmaps=!0,h=!0;break;case"boolean":h=e.genMipmaps=t.mipmap;break;case"object":F(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,h=!0;break;default:F.raise("invalid mipmap type")}!h||"min"in t||(e.minFilter=Ot)}}function Q(e,t){r.texParameteri(t,Et,e.minFilter),r.texParameteri(t,Tt,e.magFilter),r.texParameteri(t,wt,e.wrapS),r.texParameteri(t,kt,e.wrapT),n.ext_texture_filter_anisotropic&&r.texParameteri(t,Lt,e.anisotropic),e.genMipmaps&&(r.hint(Bt,e.mipmapHint),r.generateMipmap(t))}var V=0,Y={},X=a.maxTextureUnits,$=Array(X).map(function(){return null});function K(e){S.call(this),this.mipmask=0,this.internalformat=He,this.id=V++,this.refCount=1,this.target=e,this.texture=r.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new q,u.profile&&(this.stats={size:0})}function J(e){r.activeTexture(qt),r.bindTexture(e.target,e.texture)}function Z(){var e=$[0];e?r.bindTexture(e.target,e.texture):r.bindTexture(Me,null)}function te(e){var t=e.texture;F(t,"must not double destroy texture");var n=e.unit,a=e.target;n>=0&&(r.activeTexture(qt+n),r.bindTexture(a,null),$[n]=null),r.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete Y[e.id],f.textureCount--}return t(K.prototype,{bind:function(){this.bindCount+=1;var e=this.unit;if(e<0){for(var t=0;t<X;++t){var n=$[t];if(n){if(n.bindCount>0)continue;n.unit=-1}$[t]=this,e=t;break}e>=X&&F.raise("insufficient number of texture units"),u.profile&&f.maxTextureUnits<e+1&&(f.maxTextureUnits=e+1),this.unit=e,r.activeTexture(qt+e),r.bindTexture(this.target,this.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&te(this)}}),u.profile&&(f.getTotalTextureSize=function(){var e=0;return Object.keys(Y).forEach(function(t){e+=Y[t].stats.size}),e}),{create2D:function(e,t){var n=new K(Me);function i(e,t){var r=n.texInfo;q.call(r);var o=H();return"number"==typeof e?L(o,0|e,"number"==typeof t?0|t:0|e):e?(F.type(e,"object","invalid arguments to regl.texture"),N(r,e),M(o,e)):L(o,1,1),r.genMipmaps&&(o.mipmask=(o.width<<1)-1),n.mipmask=o.mipmask,T(n,o),F.texture2D(r,o,a),n.internalformat=o.internalformat,i.width=o.width,i.height=o.height,J(n),W(o,Me),Q(r,Me),Z(),G(o),u.profile&&(n.stats.size=lr(n.internalformat,n.type,o.width,o.height,r.genMipmaps,!1)),i.format=y[n.internalformat],i.type=x[n.type],i.mag=w[r.magFilter],i.min=k[r.minFilter],i.wrapS=A[r.wrapS],i.wrapT=A[r.wrapT],i}return Y[n.id]=n,f.textureCount++,i(e,t),i.subimage=function(e,t,r,a){F(!!e,"must specify image data");var o=0|t,f=0|r,u=0|a,s=P();return T(s,n),s.width=0,s.height=0,O(s,e),s.width=s.width||(n.width>>u)-o,s.height=s.height||(n.height>>u)-f,F(n.type===s.type&&n.format===s.format&&n.internalformat===s.internalformat,"incompatible format for texture.subimage"),F(o>=0&&f>=0&&o+s.width<=n.width&&f+s.height<=n.height,"texture.subimage write out of bounds"),F(n.mipmask&1<<u,"missing mipmap data"),F(s.data||s.element||s.needsCopy,"missing image data"),J(n),z(s,Me,o,f,u),Z(),I(s),i},i.resize=function(e,t){var a,o=0|e,f=0|t||o;if(o===n.width&&f===n.height)return i;i.width=n.width=o,i.height=n.height=f,J(n);for(var s=n.channels,c=n.type,l=0;n.mipmask>>l;++l){var d=o>>l,m=f>>l;if(!d||!m)break;a=ee.zero.allocType(c,d*m*s),r.texImage2D(Me,l,n.format,d,m,0,n.format,n.type,a),a&&ee.zero.freeType(a)}return Z(),u.profile&&(n.stats.size=lr(n.internalformat,n.type,o,f,!1,!1)),i},i._reglType="texture2d",i._texture=n,u.profile&&(i.stats=n.stats),i.destroy=function(){n.decRef()},i},createCube:function(e,t,n,i,o,s){var c=new K(We);Y[c.id]=c,f.cubeCount++;var l=new Array(6);function d(e,t,r,n,i,o){var f,s=c.texInfo;for(q.call(s),f=0;f<6;++f)l[f]=H();if("number"!=typeof e&&e)if("object"==typeof e)if(t)M(l[0],e),M(l[1],t),M(l[2],r),M(l[3],n),M(l[4],i),M(l[5],o);else if(N(s,e),E(c,e),"faces"in e){var m=e.faces;for(F(Array.isArray(m)&&6===m.length,"cube faces must be a length 6 array"),f=0;f<6;++f)F("object"==typeof m[f]&&!!m[f],"invalid input for cube map face"),T(l[f],c),M(l[f],m[f])}else for(f=0;f<6;++f)M(l[f],e);else F.raise("invalid arguments to cube map");else{var p=0|e||1;for(f=0;f<6;++f)L(l[f],p,p)}for(T(c,l[0]),a.npotTextureCube||F(Re(c.width)&&Re(c.height),"your browser does not support non power or two texture dimensions"),s.genMipmaps?c.mipmask=(l[0].width<<1)-1:c.mipmask=l[0].mipmask,F.textureCube(c,s,l,a),c.internalformat=l[0].internalformat,d.width=l[0].width,d.height=l[0].height,J(c),f=0;f<6;++f)W(l[f],Ue+f);for(Q(s,We),Z(),u.profile&&(c.stats.size=lr(c.internalformat,c.type,d.width,d.height,s.genMipmaps,!0)),d.format=y[c.internalformat],d.type=x[c.type],d.mag=w[s.magFilter],d.min=k[s.minFilter],d.wrapS=A[s.wrapS],d.wrapT=A[s.wrapT],f=0;f<6;++f)G(l[f]);return d}return d(e,t,n,i,o,s),d.subimage=function(e,t,r,n,a){F(!!t,"must specify image data"),F("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var i=0|r,o=0|n,f=0|a,u=P();return T(u,c),u.width=0,u.height=0,O(u,t),u.width=u.width||(c.width>>f)-i,u.height=u.height||(c.height>>f)-o,F(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),F(i>=0&&o>=0&&i+u.width<=c.width&&o+u.height<=c.height,"texture.subimage write out of bounds"),F(c.mipmask&1<<f,"missing mipmap data"),F(u.data||u.element||u.needsCopy,"missing image data"),J(c),z(u,Ue+e,i,o,f),Z(),I(u),d},d.resize=function(e){var t=0|e;if(t!==c.width){d.width=c.width=t,d.height=c.height=t,J(c);for(var n=0;n<6;++n)for(var a=0;c.mipmask>>a;++a)r.texImage2D(Ue+n,a,c.format,t>>a,t>>a,0,c.format,c.type,null);return Z(),u.profile&&(c.stats.size=lr(c.internalformat,c.type,d.width,d.height,!1,!0)),d}},d._reglType="textureCube",d._texture=c,u.profile&&(d.stats=c.stats),d.destroy=function(){c.decRef()},d},clear:function(){for(var e=0;e<X;++e)r.activeTexture(qt+e),r.bindTexture(Me,null),$[e]=null;ne(Y).forEach(te),f.cubeCount=0,f.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<X;++e){var t=$[e];t&&(t.bindCount=0,t.unit=-1,$[e]=null)}ne(Y).forEach(function(e){e.texture=r.createTexture(),r.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===Me)r.texImage2D(Me,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var n=0;n<6;++n)r.texImage2D(Ue+n,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);Q(e.texInfo,e.target)})}}}rr[Ve]=2,rr[Ye]=2,rr[Xe]=2,rr[tt]=4,rr[it]=.5,rr[ot]=.5,rr[ft]=1,rr[ut]=1,rr[st]=.5,rr[ct]=1,rr[lt]=1,rr[dt]=.5,rr[mt]=.25,rr[pt]=.5,rr[ht]=.25,rr[bt]=.5;var mr=36161,pr=32854,hr=[];function br(e,t,r){return hr[e]*t*r}hr[pr]=2,hr[32855]=2,hr[36194]=2,hr[33189]=2,hr[36168]=1,hr[34041]=4,hr[35907]=4,hr[34836]=16,hr[34842]=8,hr[34843]=6;var gr=function(e,t,r,n,a){var i={rgba4:pr,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(i.srgba=35907),t.ext_color_buffer_half_float&&(i.rgba16f=34842,i.rgb16f=34843),t.webgl_color_buffer_float&&(i.rgba32f=34836);var o=[];Object.keys(i).forEach(function(e){var t=i[e];o[t]=e});var f=0,u={};function s(e){this.id=f++,this.refCount=1,this.renderbuffer=e,this.format=pr,this.width=0,this.height=0,a.profile&&(this.stats={size:0})}function c(t){var r=t.renderbuffer;F(r,"must not double destroy renderbuffer"),e.bindRenderbuffer(mr,null),e.deleteRenderbuffer(r),t.renderbuffer=null,t.refCount=0,delete u[t.id],n.renderbufferCount--}return s.prototype.decRef=function(){--this.refCount<=0&&c(this)},a.profile&&(n.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach(function(t){e+=u[t].stats.size}),e}),{create:function(t,f){var c=new s(e.createRenderbuffer());function l(t,n){var f=0,u=0,s=pr;if("object"==typeof t&&t){var d=t;if("shape"in d){var m=d.shape;F(Array.isArray(m)&&m.length>=2,"invalid renderbuffer shape"),f=0|m[0],u=0|m[1]}else"radius"in d&&(f=u=0|d.radius),"width"in d&&(f=0|d.width),"height"in d&&(u=0|d.height);"format"in d&&(F.parameter(d.format,i,"invalid renderbuffer format"),s=i[d.format])}else"number"==typeof t?(f=0|t,u="number"==typeof n?0|n:f):t?F.raise("invalid arguments to renderbuffer constructor"):f=u=1;if(F(f>0&&u>0&&f<=r.maxRenderbufferSize&&u<=r.maxRenderbufferSize,"invalid renderbuffer size"),f!==c.width||u!==c.height||s!==c.format)return l.width=c.width=f,l.height=c.height=u,c.format=s,e.bindRenderbuffer(mr,c.renderbuffer),e.renderbufferStorage(mr,s,f,u),F(0===e.getError(),"invalid render buffer format"),a.profile&&(c.stats.size=br(c.format,c.width,c.height)),l.format=o[c.format],l}return u[c.id]=c,n.renderbufferCount++,l(t,f),l.resize=function(t,n){var i=0|t,o=0|n||i;return i===c.width&&o===c.height?l:(F(i>0&&o>0&&i<=r.maxRenderbufferSize&&o<=r.maxRenderbufferSize,"invalid renderbuffer size"),l.width=c.width=i,l.height=c.height=o,e.bindRenderbuffer(mr,c.renderbuffer),e.renderbufferStorage(mr,c.format,i,o),F(0===e.getError(),"invalid render buffer format"),a.profile&&(c.stats.size=br(c.format,c.width,c.height)),l)},l._reglType="renderbuffer",l._renderbuffer=c,a.profile&&(l.stats=c.stats),l.destroy=function(){c.decRef()},l},clear:function(){ne(u).forEach(c)},restore:function(){ne(u).forEach(function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(mr,t.renderbuffer),e.renderbufferStorage(mr,t.format,t.width,t.height)}),e.bindRenderbuffer(mr,null)}}},vr=36160,yr=36161,xr=3553,wr=34069,kr=36064,Ar=36096,_r=36128,Sr=33306,Tr=36053,Er=6402,Dr=[6407,6408],jr=[];jr[6408]=4,jr[6407]=3;var Or=[];Or[5121]=1,Or[5126]=4,Or[36193]=2;var Cr=33189,Fr=36168,zr=34041,Br=[32854,32855,36194,35907,34842,34843,34836],Pr={};Pr[Tr]="complete",Pr[36054]="incomplete attachment",Pr[36057]="incomplete dimensions",Pr[36055]="incomplete, missing attachment",Pr[36061]="unsupported";var Ir=5126;function Rr(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ir,this.offset=0,this.stride=0,this.divisor=0}var Lr=35632,Mr=35633,Wr=35718,Ur=35721;var Hr=6408,Gr=5121,qr=3333,Nr=5126;function Qr(t,r,n,a,i,o,f){function u(u){var s;null===r.next?(F(i.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),s=Gr):(F(null!==r.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),s=r.next.colorAttachments[0].texture._texture.type,o.oes_texture_float?(F(s===Gr||s===Nr,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),s===Nr&&F(f.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):F(s===Gr,"Reading from a framebuffer is only allowed for the type 'uint8'"));var c=0,l=0,d=a.framebufferWidth,m=a.framebufferHeight,p=null;e(u)?p=u:u&&(F.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,l=0|u.y,F(c>=0&&c<a.framebufferWidth,"invalid x offset for regl.read"),F(l>=0&&l<a.framebufferHeight,"invalid y offset for regl.read"),d=0|(u.width||a.framebufferWidth-c),m=0|(u.height||a.framebufferHeight-l),p=u.data||null),p&&(s===Gr?F(p instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):s===Nr&&F(p instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),F(d>0&&d+c<=a.framebufferWidth,"invalid width for read pixels"),F(m>0&&m+l<=a.framebufferHeight,"invalid height for read pixels"),n();var h=d*m*4;return p||(s===Gr?p=new Uint8Array(h):s===Nr&&(p=p||new Float32Array(h))),F.isTypedArray(p,"data buffer for regl.read() must be a typedarray"),F(p.byteLength>=h,"data buffer for regl.read() too small"),t.pixelStorei(qr,4),t.readPixels(c,l,d,m,Hr,s,p),p}return function(e){return e&&"framebuffer"in e?function(e){var t;return r.setFBO({framebuffer:e.framebuffer},function(){t=u(e)}),t}(e):u(e)}}function Vr(e){return Array.prototype.slice.call(e)}function Yr(e){return Vr(e).join("")}var Xr="xyzw".split(""),$r=5121,Kr=1,Jr=2,Zr=0,en=1,tn=2,rn=3,nn=4,an="dither",on="blend.enable",fn="blend.color",un="blend.equation",sn="blend.func",cn="depth.enable",ln="depth.func",dn="depth.range",mn="depth.mask",pn="colorMask",hn="cull.enable",bn="cull.face",gn="frontFace",vn="lineWidth",yn="polygonOffset.enable",xn="polygonOffset.offset",wn="sample.alpha",kn="sample.enable",An="sample.coverage",_n="stencil.enable",Sn="stencil.mask",Tn="stencil.func",En="stencil.opFront",Dn="stencil.opBack",jn="scissor.enable",On="scissor.box",Cn="viewport",Fn="profile",zn="framebuffer",Bn="vert",Pn="frag",In="elements",Rn="primitive",Ln="count",Mn="offset",Wn="instances",Un=zn+"Width",Hn=zn+"Height",Gn=Cn+"Width",qn=Cn+"Height",Nn="drawingBufferWidth",Qn="drawingBufferHeight",Vn=[sn,un,Tn,En,Dn,An,Cn,On,xn],Yn=34962,Xn=34963,$n=3553,Kn=34067,Jn=2884,Zn=3042,ea=3024,ta=2960,ra=2929,na=3089,aa=32823,ia=32926,oa=32928,fa=5126,ua=35664,sa=35665,ca=35666,la=5124,da=35667,ma=35668,pa=35669,ha=35670,ba=35671,ga=35672,va=35673,ya=35674,xa=35675,wa=35676,ka=35678,Aa=35680,_a=4,Sa=1028,Ta=1029,Ea=2304,Da=2305,ja=32775,Oa=32776,Ca=519,Fa=7680,za=0,Ba=1,Pa=32774,Ia=513,Ra=36160,La=36064,Ma={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Wa=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ua={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ha={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ga={frag:35632,vert:35633},qa={cw:Ea,ccw:Da};function Na(t){return Array.isArray(t)||e(t)||re(t)}function Qa(e){return e.sort(function(e,t){return e===Cn?-1:t===Cn?1:e<t?-1:1})}function Va(e,t,r,n){this.thisDep=e,this.contextDep=t,this.propDep=r,this.append=n}function Ya(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function Xa(e){return new Va(!1,!1,!1,e)}function $a(e,t){var r=e.type;if(r===Zr){var n=e.data.length;return new Va(!0,n>=1,n>=2,t)}if(r===nn){var a=e.data;return new Va(a.thisDep,a.contextDep,a.propDep,t)}return new Va(r===rn,r===tn,r===en,t)}var Ka=new Va(!1,!1,!1,function(){});function Ja(e,r,n,a,i,o,f,u,s,c,l,d,m,p,h){var b=c.Record,g={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(g.min=ja,g.max=Oa);var v=n.angle_instanced_arrays,y=n.webgl_draw_buffers,x={dirty:!0,profile:h.profile},w={},k=[],A={},_={};function S(e){return e.replace(".","_")}function T(e,t,r){var n=S(e);k.push(e),w[n]=x[n]=!!r,A[n]=t}function E(e,t,r){var n=S(e);k.push(e),Array.isArray(r)?(x[n]=r.slice(),w[n]=r.slice()):x[n]=w[n]=r,_[n]=t}T(an,ea),T(on,Zn),E(fn,"blendColor",[0,0,0,0]),E(un,"blendEquationSeparate",[Pa,Pa]),E(sn,"blendFuncSeparate",[Ba,za,Ba,za]),T(cn,ra,!0),E(ln,"depthFunc",Ia),E(dn,"depthRange",[0,1]),E(mn,"depthMask",!0),E(pn,pn,[!0,!0,!0,!0]),T(hn,Jn),E(bn,"cullFace",Ta),E(gn,gn,Da),E(vn,vn,1),T(yn,aa),E(xn,"polygonOffset",[0,0]),T(wn,ia),T(kn,oa),E(An,"sampleCoverage",[1,!1]),T(_n,ta),E(Sn,"stencilMask",-1),E(Tn,"stencilFunc",[Ca,0,-1]),E(En,"stencilOpSeparate",[Sa,Fa,Fa,Fa]),E(Dn,"stencilOpSeparate",[Ta,Fa,Fa,Fa]),T(jn,na),E(On,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),E(Cn,Cn,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var D={gl:e,context:m,strings:r,next:w,current:x,draw:d,elements:o,buffer:i,shader:l,attributes:c.state,uniforms:s,framebuffer:u,extensions:n,timer:p,isBufferArgs:Na},j={primTypes:ye,compareFuncs:Ua,blendFuncs:Ma,blendEquations:g,stencilOps:Ha,glTypes:fe,orientationType:qa};F.optional(function(){D.isArrayLike=Ie}),y&&(j.backBuffer=[Ta],j.drawBuffer=q(a.maxDrawbuffers,function(e){return 0===e?[0]:q(e,function(e){return La+e})}));var O=0;function C(){var e=function(){var e=0,r=[],n=[];function a(){var r=[],n=[];return t(function(){r.push.apply(r,Vr(arguments))},{def:function(){var t="v"+e++;return n.push(t),arguments.length>0&&(r.push(t,"="),r.push.apply(r,Vr(arguments)),r.push(";")),t},toString:function(){return Yr([n.length>0?"var "+n.join(",")+";":"",Yr(r)])}})}function i(){var e=a(),r=a(),n=e.toString,i=r.toString;function o(t,n){r(t,n,"=",e.def(t,n),";")}return t(function(){e.apply(e,Vr(arguments))},{def:e.def,entry:e,exit:r,save:o,set:function(t,r,n){o(t,r),e(t,r,"=",n,";")},toString:function(){return n()+i()}})}var o=a(),f={};return{global:o,link:function(t){for(var a=0;a<n.length;++a)if(n[a]===t)return r[a];var i="g"+e++;return r.push(i),n.push(t),i},block:a,proc:function(e,r){var n=[];function a(){var e="a"+n.length;return n.push(e),e}r=r||0;for(var o=0;o<r;++o)a();var u=i(),s=u.toString;return f[e]=t(u,{arg:a,toString:function(){return Yr(["function(",n.join(),"){",s(),"}"])}})},scope:i,cond:function(){var e=Yr(arguments),r=i(),n=i(),a=r.toString,o=n.toString;return t(r,{then:function(){return r.apply(r,Vr(arguments)),this},else:function(){return n.apply(n,Vr(arguments)),this},toString:function(){var t=o();return t&&(t="else{"+t+"}"),Yr(["if(",e,"){",a(),"}",t])}})},compile:function(){var e=['"use strict";',o,"return {"];Object.keys(f).forEach(function(t){e.push('"',t,'":',f[t].toString(),",")}),e.push("}");var t=Yr(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,r.concat(t)).apply(null,n)}}}(),n=e.link,a=e.global;e.id=O++,e.batchId="0";var i=n(D),o=e.shared={props:"a0"};Object.keys(D).forEach(function(e){o[e]=a.def(i,".",e)}),F.optional(function(){e.CHECK=n(F),e.commandStr=F.guessCommand(),e.command=n(e.commandStr),e.assert=function(e,t,r){e("if(!(",t,"))",this.CHECK,".commandRaise(",n(r),",",this.command,");")},j.invalidBlendCombinations=Wa});var f=e.next={},u=e.current={};Object.keys(_).forEach(function(e){Array.isArray(x[e])&&(f[e]=a.def(o.next,".",e),u[e]=a.def(o.current,".",e))});var s=e.constants={};Object.keys(j).forEach(function(e){s[e]=a.def(JSON.stringify(j[e]))}),e.invoke=function(t,r){switch(r.type){case Zr:var a=["this",o.context,o.props,e.batchId];return t.def(n(r.data),".call(",a.slice(0,Math.max(r.data.length+1,4)),")");case en:return t.def(o.props,r.data);case tn:return t.def(o.context,r.data);case rn:return t.def("this",r.data);case nn:return r.data.append(e,t),r.data.ref}},e.attribCache={};var l={};return e.scopeAttrib=function(e){var t=r.id(e);if(t in l)return l[t];var a=c.scope[t];return a||(a=c.scope[t]=new b),l[t]=n(a)},e}function z(e,t,n,f,s){var c=e.static,d=e.dynamic;F.optional(function(){var e=[zn,Bn,Pn,In,Rn,Mn,Ln,Wn,Fn].concat(k);function t(t){Object.keys(t).forEach(function(t){F.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',s.commandStr)})}t(c),t(d)});var m=function(e,t){var r=e.static,n=e.dynamic;if(zn in r){var a=r[zn];return a?(a=u.getFramebuffer(a),F.command(a,"invalid framebuffer object"),Xa(function(e,t){var r=e.link(a),n=e.shared;t.set(n.framebuffer,".next",r);var i=n.context;return t.set(i,"."+Un,r+".width"),t.set(i,"."+Hn,r+".height"),r})):Xa(function(e,t){var r=e.shared;t.set(r.framebuffer,".next","null");var n=r.context;return t.set(n,"."+Un,n+"."+Nn),t.set(n,"."+Hn,n+"."+Qn),"null"})}if(zn in n){var i=n[zn];return $a(i,function(e,t){var r=e.invoke(t,i),n=e.shared,a=n.framebuffer,o=t.def(a,".getFramebuffer(",r,")");F.optional(function(){e.assert(t,"!"+r+"||"+o,"invalid framebuffer object")}),t.set(a,".next",o);var f=n.context;return t.set(f,"."+Un,o+"?"+o+".width:"+f+"."+Nn),t.set(f,"."+Hn,o+"?"+o+".height:"+f+"."+Qn),o})}return null}(e),p=function(e,t,r){var n=e.static,a=e.dynamic;function i(e){if(e in n){var i=n[e];F.commandType(i,"object","invalid "+e,r.commandStr);var o,f,u=!0,s=0|i.x,c=0|i.y;return"width"in i?(o=0|i.width,F.command(o>=0,"invalid "+e,r.commandStr)):u=!1,"height"in i?(f=0|i.height,F.command(f>=0,"invalid "+e,r.commandStr)):u=!1,new Va(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,function(e,t){var r=e.shared.context,n=o;"width"in i||(n=t.def(r,".",Un,"-",s));var a=f;return"height"in i||(a=t.def(r,".",Hn,"-",c)),[s,c,n,a]})}if(e in a){var l=a[e],d=$a(l,function(t,r){var n=t.invoke(r,l);F.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)});var a=t.shared.context,i=r.def(n,".x|0"),o=r.def(n,".y|0"),f=r.def('"width" in ',n,"?",n,".width|0:","(",a,".",Un,"-",i,")"),u=r.def('"height" in ',n,"?",n,".height|0:","(",a,".",Hn,"-",o,")");return F.optional(function(){t.assert(r,f+">=0&&"+u+">=0","invalid "+e)}),[i,o,f,u]});return t&&(d.thisDep=d.thisDep||t.thisDep,d.contextDep=d.contextDep||t.contextDep,d.propDep=d.propDep||t.propDep),d}return t?new Va(t.thisDep,t.contextDep,t.propDep,function(e,t){var r=e.shared.context;return[0,0,t.def(r,".",Un),t.def(r,".",Hn)]}):null}var o=i(Cn);if(o){var f=o;o=new Va(o.thisDep,o.contextDep,o.propDep,function(e,t){var r=f.append(e,t),n=e.shared.context;return t.set(n,"."+Gn,r[2]),t.set(n,"."+qn,r[3]),r})}return{viewport:o,scissor_box:i(On)}}(e,m,s),h=function(e,t){var r=e.static,n=e.dynamic,a=function(){if(In in r){var e=r[In];Na(e)?e=o.getElements(o.create(e,!0)):e&&(e=o.getElements(e),F.command(e,"invalid elements",t.commandStr));var a=Xa(function(t,r){if(e){var n=t.link(e);return t.ELEMENTS=n,n}return t.ELEMENTS=null,null});return a.value=e,a}if(In in n){var i=n[In];return $a(i,function(e,t){var r=e.shared,n=r.isBufferArgs,a=r.elements,o=e.invoke(t,i),f=t.def("null"),u=t.def(n,"(",o,")"),s=e.cond(u).then(f,"=",a,".createStream(",o,");").else(f,"=",a,".getElements(",o,");");return F.optional(function(){e.assert(s.else,"!"+o+"||"+f,"invalid elements")}),t.entry(s),t.exit(e.cond(u).then(a,".destroyStream(",f,");")),e.ELEMENTS=f,f})}return null}();function i(e,i){if(e in r){var o=0|r[e];return F.command(!i||o>=0,"invalid "+e,t.commandStr),Xa(function(e,t){return i&&(e.OFFSET=o),o})}if(e in n){var f=n[e];return $a(f,function(t,r){var n=t.invoke(r,f);return i&&(t.OFFSET=n,F.optional(function(){t.assert(r,n+">=0","invalid "+e)})),n})}return i&&a?Xa(function(e,t){return e.OFFSET="0",0}):null}var f=i(Mn,!0);return{elements:a,primitive:function(){if(Rn in r){var e=r[Rn];return F.commandParameter(e,ye,"invalid primitve",t.commandStr),Xa(function(t,r){return ye[e]})}if(Rn in n){var i=n[Rn];return $a(i,function(e,t){var r=e.constants.primTypes,n=e.invoke(t,i);return F.optional(function(){e.assert(t,n+" in "+r,"invalid primitive, must be one of "+Object.keys(ye))}),t.def(r,"[",n,"]")})}return a?Ya(a)?a.value?Xa(function(e,t){return t.def(e.ELEMENTS,".primType")}):Xa(function(){return _a}):new Va(a.thisDep,a.contextDep,a.propDep,function(e,t){var r=e.ELEMENTS;return t.def(r,"?",r,".primType:",_a)}):null}(),count:function(){if(Ln in r){var e=0|r[Ln];return F.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),Xa(function(){return e})}if(Ln in n){var i=n[Ln];return $a(i,function(e,t){var r=e.invoke(t,i);return F.optional(function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">=0&&"+r+"===("+r+"|0)","invalid vertex count")}),r})}if(a){if(Ya(a)){if(a)return f?new Va(f.thisDep,f.contextDep,f.propDep,function(e,t){var r=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return F.optional(function(){e.assert(t,r+">=0","invalid vertex offset/element buffer too small")}),r}):Xa(function(e,t){return t.def(e.ELEMENTS,".vertCount")});var o=Xa(function(){return-1});return F.optional(function(){o.MISSING=!0}),o}var u=new Va(a.thisDep||f.thisDep,a.contextDep||f.contextDep,a.propDep||f.propDep,function(e,t){var r=e.ELEMENTS;return e.OFFSET?t.def(r,"?",r,".vertCount-",e.OFFSET,":-1"):t.def(r,"?",r,".vertCount:-1")});return F.optional(function(){u.DYNAMIC=!0}),u}return null}(),instances:i(Wn,!1),offset:f}}(e,s),y=function(e,t){var r=e.static,n=e.dynamic,i={};return k.forEach(function(e){var o=S(e);function f(t,a){if(e in r){var f=t(r[e]);i[o]=Xa(function(){return f})}else if(e in n){var u=n[e];i[o]=$a(u,function(e,t){return a(e,t,e.invoke(t,u))})}}switch(e){case hn:case on:case an:case _n:case cn:case jn:case yn:case wn:case kn:case mn:return f(function(r){return F.commandType(r,"boolean",e,t.commandStr),r},function(t,r,n){return F.optional(function(){t.assert(r,"typeof "+n+'==="boolean"',"invalid flag "+e,t.commandStr)}),n});case ln:return f(function(r){return F.commandParameter(r,Ua,"invalid "+e,t.commandStr),Ua[r]},function(t,r,n){var a=t.constants.compareFuncs;return F.optional(function(){t.assert(r,n+" in "+a,"invalid "+e+", must be one of "+Object.keys(Ua))}),r.def(a,"[",n,"]")});case dn:return f(function(e){return F.command(Ie(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e},function(e,t,r){return F.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===2&&typeof "+r+'[0]==="number"&&typeof '+r+'[1]==="number"&&'+r+"[0]<="+r+"[1]","depth range must be a 2d array")}),[t.def("+",r,"[0]"),t.def("+",r,"[1]")]});case sn:return f(function(e){F.commandType(e,"object","blend.func",t.commandStr);var r="srcRGB"in e?e.srcRGB:e.src,n="srcAlpha"in e?e.srcAlpha:e.src,a="dstRGB"in e?e.dstRGB:e.dst,i="dstAlpha"in e?e.dstAlpha:e.dst;return F.commandParameter(r,Ma,o+".srcRGB",t.commandStr),F.commandParameter(n,Ma,o+".srcAlpha",t.commandStr),F.commandParameter(a,Ma,o+".dstRGB",t.commandStr),F.commandParameter(i,Ma,o+".dstAlpha",t.commandStr),F.command(-1===Wa.indexOf(r+", "+a),"unallowed blending combination (srcRGB, dstRGB) = ("+r+", "+a+")",t.commandStr),[Ma[r],Ma[a],Ma[n],Ma[i]]},function(t,r,n){var a=t.constants.blendFuncs;function i(i,o){var f=r.def('"',i,o,'" in ',n,"?",n,".",i,o,":",n,".",i);return F.optional(function(){t.assert(r,f+" in "+a,"invalid "+e+"."+i+o+", must be one of "+Object.keys(Ma))}),f}F.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid blend func, must be an object")});var o=i("src","RGB"),f=i("dst","RGB");F.optional(function(){var e=t.constants.invalidBlendCombinations;t.assert(r,e+".indexOf("+o+'+", "+'+f+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var u=r.def(a,"[",o,"]"),s=r.def(a,"[",i("src","Alpha"),"]");return[u,r.def(a,"[",f,"]"),s,r.def(a,"[",i("dst","Alpha"),"]")]});case un:return f(function(r){return"string"==typeof r?(F.commandParameter(r,g,"invalid "+e,t.commandStr),[g[r],g[r]]):"object"==typeof r?(F.commandParameter(r.rgb,g,e+".rgb",t.commandStr),F.commandParameter(r.alpha,g,e+".alpha",t.commandStr),[g[r.rgb],g[r.alpha]]):void F.commandRaise("invalid blend.equation",t.commandStr)},function(t,r,n){var a=t.constants.blendEquations,i=r.def(),o=r.def(),f=t.cond("typeof ",n,'==="string"');return F.optional(function(){function r(e,r,n){t.assert(e,n+" in "+a,"invalid "+r+", must be one of "+Object.keys(g))}r(f.then,e,n),t.assert(f.else,n+"&&typeof "+n+'==="object"',"invalid "+e),r(f.else,e+".rgb",n+".rgb"),r(f.else,e+".alpha",n+".alpha")}),f.then(i,"=",o,"=",a,"[",n,"];"),f.else(i,"=",a,"[",n,".rgb];",o,"=",a,"[",n,".alpha];"),r(f),[i,o]});case fn:return f(function(e){return F.command(Ie(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),q(4,function(t){return+e[t]})},function(e,t,r){return F.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===4","blend.color must be a 4d array")}),q(4,function(e){return t.def("+",r,"[",e,"]")})});case Sn:return f(function(e){return F.commandType(e,"number",o,t.commandStr),0|e},function(e,t,r){return F.optional(function(){e.assert(t,"typeof "+r+'==="number"',"invalid stencil.mask")}),t.def(r,"|0")});case Tn:return f(function(r){F.commandType(r,"object",o,t.commandStr);var n=r.cmp||"keep",a=r.ref||0,i="mask"in r?r.mask:-1;return F.commandParameter(n,Ua,e+".cmp",t.commandStr),F.commandType(a,"number",e+".ref",t.commandStr),F.commandType(i,"number",e+".mask",t.commandStr),[Ua[n],a,i]},function(e,t,r){var n=e.constants.compareFuncs;return F.optional(function(){function a(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}a(r+"&&typeof ",r,'==="object"'),a('!("cmp" in ',r,")||(",r,".cmp in ",n,")")}),[t.def('"cmp" in ',r,"?",n,"[",r,".cmp]",":",Fa),t.def(r,".ref|0"),t.def('"mask" in ',r,"?",r,".mask|0:-1")]});case En:case Dn:return f(function(r){F.commandType(r,"object",o,t.commandStr);var n=r.fail||"keep",a=r.zfail||"keep",i=r.zpass||"keep";return F.commandParameter(n,Ha,e+".fail",t.commandStr),F.commandParameter(a,Ha,e+".zfail",t.commandStr),F.commandParameter(i,Ha,e+".zpass",t.commandStr),[e===Dn?Ta:Sa,Ha[n],Ha[a],Ha[i]]},function(t,r,n){var a=t.constants.stencilOps;function i(i){return F.optional(function(){t.assert(r,'!("'+i+'" in '+n+")||("+n+"."+i+" in "+a+")","invalid "+e+"."+i+", must be one of "+Object.keys(Ha))}),r.def('"',i,'" in ',n,"?",a,"[",n,".",i,"]:",Fa)}return F.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)}),[e===Dn?Ta:Sa,i("fail"),i("zfail"),i("zpass")]});case xn:return f(function(e){F.commandType(e,"object",o,t.commandStr);var r=0|e.factor,n=0|e.units;return F.commandType(r,"number",o+".factor",t.commandStr),F.commandType(n,"number",o+".units",t.commandStr),[r,n]},function(t,r,n){return F.optional(function(){t.assert(r,n+"&&typeof "+n+'==="object"',"invalid "+e)}),[r.def(n,".factor|0"),r.def(n,".units|0")]});case bn:return f(function(e){var r=0;return"front"===e?r=Sa:"back"===e&&(r=Ta),F.command(!!r,o,t.commandStr),r},function(e,t,r){return F.optional(function(){e.assert(t,r+'==="front"||'+r+'==="back"',"invalid cull.face")}),t.def(r,'==="front"?',Sa,":",Ta)});case vn:return f(function(e){return F.command("number"==typeof e&&e>=a.lineWidthDims[0]&&e<=a.lineWidthDims[1],"invalid line width, must be a positive number between "+a.lineWidthDims[0]+" and "+a.lineWidthDims[1],t.commandStr),e},function(e,t,r){return F.optional(function(){e.assert(t,"typeof "+r+'==="number"&&'+r+">="+a.lineWidthDims[0]+"&&"+r+"<="+a.lineWidthDims[1],"invalid line width")}),r});case gn:return f(function(e){return F.commandParameter(e,qa,o,t.commandStr),qa[e]},function(e,t,r){return F.optional(function(){e.assert(t,r+'==="cw"||'+r+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),t.def(r+'==="cw"?'+Ea+":"+Da)});case pn:return f(function(e){return F.command(Ie(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map(function(e){return!!e})},function(e,t,r){return F.optional(function(){e.assert(t,e.shared.isArrayLike+"("+r+")&&"+r+".length===4","invalid color.mask")}),q(4,function(e){return"!!"+r+"["+e+"]"})});case An:return f(function(e){F.command("object"==typeof e&&e,o,t.commandStr);var r="value"in e?e.value:1,n=!!e.invert;return F.command("number"==typeof r&&r>=0&&r<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[r,n]},function(e,t,r){return F.optional(function(){e.assert(t,r+"&&typeof "+r+'==="object"',"invalid sample.coverage")}),[t.def('"value" in ',r,"?+",r,".value:1"),t.def("!!",r,".invert")]})}}),i}(e,s),x=function(e){var t=e.static,n=e.dynamic;function a(e){if(e in t){var a=r.id(t[e]);F.optional(function(){l.shader(Ga[e],a,F.guessCommand())});var i=Xa(function(){return a});return i.id=a,i}if(e in n){var o=n[e];return $a(o,function(t,r){var n=t.invoke(r,o),a=r.def(t.shared.strings,".id(",n,")");return F.optional(function(){r(t.shared.shader,".shader(",Ga[e],",",a,",",t.command,");")}),a})}return null}var i,o=a(Pn),f=a(Bn),u=null;return Ya(o)&&Ya(f)?(u=l.program(f.id,o.id),i=Xa(function(e,t){return e.link(u)})):i=new Va(o&&o.thisDep||f&&f.thisDep,o&&o.contextDep||f&&f.contextDep,o&&o.propDep||f&&f.propDep,function(e,t){var r,n=e.shared.shader;r=o?o.append(e,t):t.def(n,".",Pn);var a=n+".program("+(f?f.append(e,t):t.def(n,".",Bn))+","+r;return F.optional(function(){a+=","+e.command}),t.def(a+")")}),{frag:o,vert:f,progVar:i,program:u}}(e);function w(e){var t=p[e];t&&(y[e]=t)}w(Cn),w(S(On));var A=Object.keys(y).length>0,_={framebuffer:m,draw:h,shader:x,state:y,dirty:A};return _.profile=function(e){var t,r=e.static,n=e.dynamic;if(Fn in r){var a=!!r[Fn];(t=Xa(function(e,t){return a})).enable=a}else if(Fn in n){var i=n[Fn];t=$a(i,function(e,t){return e.invoke(t,i)})}return t}(e),_.uniforms=function(e,t){var r=e.static,n=e.dynamic,a={};return Object.keys(r).forEach(function(e){var n,i=r[e];if("number"==typeof i||"boolean"==typeof i)n=Xa(function(){return i});else if("function"==typeof i){var o=i._reglType;"texture2d"===o||"textureCube"===o?n=Xa(function(e){return e.link(i)}):"framebuffer"===o||"framebufferCube"===o?(F.command(i.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),n=Xa(function(e){return e.link(i.color[0])})):F.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else Ie(i)?n=Xa(function(t){return t.global.def("[",q(i.length,function(r){return F.command("number"==typeof i[r]||"boolean"==typeof i[r],"invalid uniform "+e,t.commandStr),i[r]}),"]")}):F.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);n.value=i,a[e]=n}),Object.keys(n).forEach(function(e){var t=n[e];a[e]=$a(t,function(e,r){return e.invoke(r,t)})}),a}(n,s),_.attributes=function(e,t){var n=e.static,a=e.dynamic,o={};return Object.keys(n).forEach(function(e){var a=n[e],f=r.id(e),u=new b;if(Na(a))u.state=Kr,u.buffer=i.getBuffer(i.create(a,Yn,!1,!0)),u.type=0;else{var s=i.getBuffer(a);if(s)u.state=Kr,u.buffer=s,u.type=0;else if(F.command("object"==typeof a&&a,"invalid data for attribute "+e,t.commandStr),"constant"in a){var c=a.constant;u.buffer="null",u.state=Jr,"number"==typeof c?u.x=c:(F.command(Ie(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+e,t.commandStr),Xr.forEach(function(e,t){t<c.length&&(u[e]=c[t])}))}else{s=Na(a.buffer)?i.getBuffer(i.create(a.buffer,Yn,!1,!0)):i.getBuffer(a.buffer),F.command(!!s,'missing buffer for attribute "'+e+'"',t.commandStr);var l=0|a.offset;F.command(l>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var d=0|a.stride;F.command(d>=0&&d<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var m=0|a.size;F.command(!("size"in a)||m>0&&m<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var p=!!a.normalized,h=0;"type"in a&&(F.commandParameter(a.type,fe,"invalid type for attribute "+e,t.commandStr),h=fe[a.type]);var g=0|a.divisor;"divisor"in a&&(F.command(0===g||v,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),F.command(g>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),F.optional(function(){var r=t.commandStr,n=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(a).forEach(function(t){F.command(n.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+n+")",r)})}),u.buffer=s,u.state=Kr,u.size=m,u.normalized=p,u.type=h||s.dtype,u.offset=l,u.stride=d,u.divisor=g}}o[e]=Xa(function(e,t){var r=e.attribCache;if(f in r)return r[f];var n={isStream:!1};return Object.keys(u).forEach(function(e){n[e]=u[e]}),u.buffer&&(n.buffer=e.link(u.buffer),n.type=n.type||n.buffer+".dtype"),r[f]=n,n})}),Object.keys(a).forEach(function(e){var t=a[e];o[e]=$a(t,function(r,n){var a=r.invoke(n,t),i=r.shared,o=r.constants,f=i.isBufferArgs,u=i.buffer;F.optional(function(){r.assert(n,a+"&&(typeof "+a+'==="object"||typeof '+a+'==="function")&&('+f+"("+a+")||"+u+".getBuffer("+a+")||"+u+".getBuffer("+a+".buffer)||"+f+"("+a+'.buffer)||("constant" in '+a+"&&(typeof "+a+'.constant==="number"||'+i.isArrayLike+"("+a+".constant))))",'invalid dynamic attribute "'+e+'"')});var s={isStream:n.def(!1)},c=new b;c.state=Kr,Object.keys(c).forEach(function(e){s[e]=n.def(""+c[e])});var l=s.buffer,d=s.type;function m(e){n(s[e],"=",a,".",e,"|0;")}return n("if(",f,"(",a,")){",s.isStream,"=true;",l,"=",u,".createStream(",Yn,",",a,");",d,"=",l,".dtype;","}else{",l,"=",u,".getBuffer(",a,");","if(",l,"){",d,"=",l,".dtype;",'}else if("constant" in ',a,"){",s.state,"=",Jr,";","if(typeof "+a+'.constant === "number"){',s[Xr[0]],"=",a,".constant;",Xr.slice(1).map(function(e){return s[e]}).join("="),"=0;","}else{",Xr.map(function(e,t){return s[e]+"="+a+".constant.length>"+t+"?"+a+".constant["+t+"]:0;"}).join(""),"}}else{","if(",f,"(",a,".buffer)){",l,"=",u,".createStream(",Yn,",",a,".buffer);","}else{",l,"=",u,".getBuffer(",a,".buffer);","}",d,'="type" in ',a,"?",o.glTypes,"[",a,".type]:",l,".dtype;",s.normalized,"=!!",a,".normalized;"),m("size"),m("offset"),m("stride"),m("divisor"),n("}}"),n.exit("if(",s.isStream,"){",u,".destroyStream(",l,");","}"),s})}),o}(t,s),_.context=function(e){var t=e.static,r=e.dynamic,n={};return Object.keys(t).forEach(function(e){var r=t[e];n[e]=Xa(function(e,t){return"number"==typeof r||"boolean"==typeof r?""+r:e.link(r)})}),Object.keys(r).forEach(function(e){var t=r[e];n[e]=$a(t,function(e,r){return e.invoke(r,t)})}),n}(f),_}function B(e,t,r){var n=e.shared.context,a=e.scope();Object.keys(r).forEach(function(i){t.save(n,"."+i);var o=r[i];a(n,".",i,"=",o.append(e,t),";")}),t(a)}function P(e,t,r,n){var a,i=e.shared,o=i.gl,f=i.framebuffer;y&&(a=t.def(i.extensions,".webgl_draw_buffers"));var u,s=e.constants,c=s.drawBuffer,l=s.backBuffer;u=r?r.append(e,t):t.def(f,".next"),n||t("if(",u,"!==",f,".cur){"),t("if(",u,"){",o,".bindFramebuffer(",Ra,",",u,".framebuffer);"),y&&t(a,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),t("}else{",o,".bindFramebuffer(",Ra,",null);"),y&&t(a,".drawBuffersWEBGL(",l,");"),t("}",f,".cur=",u,";"),n||t("}")}function I(e,t,r){var n=e.shared,a=n.gl,i=e.current,o=e.next,f=n.current,u=n.next,s=e.cond(f,".dirty");k.forEach(function(t){var n,c,l=S(t);if(!(l in r.state))if(l in o){n=o[l],c=i[l];var d=q(x[l].length,function(e){return s.def(n,"[",e,"]")});s(e.cond(d.map(function(e,t){return e+"!=="+c+"["+t+"]"}).join("||")).then(a,".",_[l],"(",d,");",d.map(function(e,t){return c+"["+t+"]="+e}).join(";"),";"))}else{n=s.def(u,".",l);var m=e.cond(n,"!==",f,".",l);s(m),l in A?m(e.cond(n).then(a,".enable(",A[l],");").else(a,".disable(",A[l],");"),f,".",l,"=",n,";"):m(a,".",_[l],"(",n,");",f,".",l,"=",n,";")}}),0===Object.keys(r.state).length&&s(f,".dirty=false;"),t(s)}function R(e,t,r,n){var a=e.shared,i=e.current,o=a.current,f=a.gl;Qa(Object.keys(r)).forEach(function(a){var u=r[a];if(!n||n(u)){var s=u.append(e,t);if(A[a]){var c=A[a];Ya(u)?t(f,s?".enable(":".disable(",c,");"):t(e.cond(s).then(f,".enable(",c,");").else(f,".disable(",c,");")),t(o,".",a,"=",s,";")}else if(Ie(s)){var l=i[a];t(f,".",_[a],"(",s,");",s.map(function(e,t){return l+"["+t+"]="+e}).join(";"),";")}else t(f,".",_[a],"(",s,");",o,".",a,"=",s,";")}})}function M(e,t){v&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function W(e,t,r,n,a){var i,o,f,u=e.shared,s=e.stats,c=u.current,l=u.timer,d=r.profile;function m(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function h(e){e(i=t.def(),"=",m(),";"),"string"==typeof a?e(s,".count+=",a,";"):e(s,".count++;"),p&&(n?e(o=t.def(),"=",l,".getNumPendingQueries();"):e(l,".beginQuery(",s,");"))}function b(e){e(s,".cpuTime+=",m(),"-",i,";"),p&&(n?e(l,".pushScopeStats(",o,",",l,".getNumPendingQueries(),",s,");"):e(l,".endQuery();"))}function g(e){var r=t.def(c,".profile");t(c,".profile=",e,";"),t.exit(c,".profile=",r,";")}if(d){if(Ya(d))return void(d.enable?(h(t),b(t.exit),g("true")):g("false"));g(f=d.append(e,t))}else f=t.def(c,".profile");var v=e.block();h(v),t("if(",f,"){",v,"}");var y=e.block();b(y),t.exit("if(",f,"){",y,"}")}function U(e,t,r,n,a){var i=e.shared;n.forEach(function(n){var o,f=n.name,u=r.attributes[f];if(u){if(!a(u))return;o=u.append(e,t)}else{if(!a(Ka))return;var s=e.scopeAttrib(f);F.optional(function(){e.assert(t,s+".state","missing attribute "+f)}),o={},Object.keys(new b).forEach(function(e){o[e]=t.def(s,".",e)})}!function(r,n,a){var o=i.gl,f=t.def(r,".location"),u=t.def(i.attributes,"[",f,"]"),s=a.state,c=a.buffer,l=[a.x,a.y,a.z,a.w],d=["buffer","normalized","offset","stride"];function m(){t("if(!",u,".buffer){",o,".enableVertexAttribArray(",f,");}");var r,i=a.type;if(r=a.size?t.def(a.size,"||",n):n,t("if(",u,".type!==",i,"||",u,".size!==",r,"||",d.map(function(e){return u+"."+e+"!=="+a[e]}).join("||"),"){",o,".bindBuffer(",Yn,",",c,".buffer);",o,".vertexAttribPointer(",[f,r,i,a.normalized,a.stride,a.offset],");",u,".type=",i,";",u,".size=",r,";",d.map(function(e){return u+"."+e+"="+a[e]+";"}).join(""),"}"),v){var s=a.divisor;t("if(",u,".divisor!==",s,"){",e.instancing,".vertexAttribDivisorANGLE(",[f,s],");",u,".divisor=",s,";}")}}function p(){t("if(",u,".buffer){",o,".disableVertexAttribArray(",f,");",u,".buffer=null;","}if(",Xr.map(function(e,t){return u+"."+e+"!=="+l[t]}).join("||"),"){",o,".vertexAttrib4f(",f,",",l,");",Xr.map(function(e,t){return u+"."+e+"="+l[t]+";"}).join(""),"}")}s===Kr?m():s===Jr?p():(t("if(",s,"===",Kr,"){"),m(),t("}else{"),p(),t("}"))}(e.link(n),function(e){switch(e){case ua:case da:case ba:return 2;case sa:case ma:case ga:return 3;case ca:case pa:case va:return 4;default:return 1}}(n.info.type),o)})}function H(e,t,n,a,i){for(var o,f=e.shared,u=f.gl,s=0;s<a.length;++s){var c,l=a[s],d=l.name,m=l.info.type,p=n.uniforms[d],h=e.link(l)+".location";if(p){if(!i(p))continue;if(Ya(p)){var b=p.value;if(F.command(null!=b,'missing uniform "'+d+'"',e.commandStr),m===ka||m===Aa){F.command("function"==typeof b&&(m===ka&&("texture2d"===b._reglType||"framebuffer"===b._reglType)||m===Aa&&("textureCube"===b._reglType||"framebufferCube"===b._reglType)),"invalid texture for uniform "+d,e.commandStr);var g=e.link(b._texture||b.color[0]._texture);t(u,".uniform1i(",h,",",g+".bind());"),t.exit(g,".unbind();")}else if(m===ya||m===xa||m===wa){F.optional(function(){F.command(Ie(b),"invalid matrix for uniform "+d,e.commandStr),F.command(m===ya&&4===b.length||m===xa&&9===b.length||m===wa&&16===b.length,"invalid length for matrix uniform "+d,e.commandStr)});var v=e.global.def("new Float32Array(["+Array.prototype.slice.call(b)+"])"),y=2;m===xa?y=3:m===wa&&(y=4),t(u,".uniformMatrix",y,"fv(",h,",false,",v,");")}else{switch(m){case fa:F.commandType(b,"number","uniform "+d,e.commandStr),o="1f";break;case ua:F.command(Ie(b)&&2===b.length,"uniform "+d,e.commandStr),o="2f";break;case sa:F.command(Ie(b)&&3===b.length,"uniform "+d,e.commandStr),o="3f";break;case ca:F.command(Ie(b)&&4===b.length,"uniform "+d,e.commandStr),o="4f";break;case ha:F.commandType(b,"boolean","uniform "+d,e.commandStr),o="1i";break;case la:F.commandType(b,"number","uniform "+d,e.commandStr),o="1i";break;case ba:case da:F.command(Ie(b)&&2===b.length,"uniform "+d,e.commandStr),o="2i";break;case ga:case ma:F.command(Ie(b)&&3===b.length,"uniform "+d,e.commandStr),o="3i";break;case va:case pa:F.command(Ie(b)&&4===b.length,"uniform "+d,e.commandStr),o="4i"}t(u,".uniform",o,"(",h,",",Ie(b)?Array.prototype.slice.call(b):b,");")}continue}c=p.append(e,t)}else{if(!i(Ka))continue;c=t.def(f.uniforms,"[",r.id(d),"]")}m===ka?t("if(",c,"&&",c,'._reglType==="framebuffer"){',c,"=",c,".color[0];","}"):m===Aa&&t("if(",c,"&&",c,'._reglType==="framebufferCube"){',c,"=",c,".color[0];","}"),F.optional(function(){function r(r,n){e.assert(t,r,'bad data or missing for uniform "'+d+'".  '+n)}function n(e){r("typeof "+c+'==="'+e+'"',"invalid type, expected "+e)}function a(t,n){r(f.isArrayLike+"("+c+")&&"+c+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function i(t){r("typeof "+c+'==="function"&&'+c+'._reglType==="texture'+(t===$n?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(m){case la:n("number");break;case da:a(2);break;case ma:a(3);break;case pa:a(4);break;case fa:n("number");break;case ua:a(2);break;case sa:a(3);break;case ca:a(4);break;case ha:n("boolean");break;case ba:a(2);break;case ga:a(3);break;case va:case ya:a(4);break;case xa:a(9);break;case wa:a(16);break;case ka:i($n);break;case Aa:i(Kn)}});var x=1;switch(m){case ka:case Aa:var w=t.def(c,"._texture");t(u,".uniform1i(",h,",",w,".bind());"),t.exit(w,".unbind();");continue;case la:case ha:o="1i";break;case da:case ba:o="2i",x=2;break;case ma:case ga:o="3i",x=3;break;case pa:case va:o="4i",x=4;break;case fa:o="1f";break;case ua:o="2f",x=2;break;case sa:o="3f",x=3;break;case ca:o="4f",x=4;break;case ya:o="Matrix2fv";break;case xa:o="Matrix3fv";break;case wa:o="Matrix4fv"}if(t(u,".uniform",o,"(",h,","),"M"===o.charAt(0)){var k=Math.pow(m-ya+2,2),A=e.global.def("new Float32Array(",k,")");t("false,(Array.isArray(",c,")||",c," instanceof Float32Array)?",c,":(",q(k,function(e){return A+"["+e+"]="+c+"["+e+"]"}),",",A,")")}else t(x>1?q(x,function(e){return c+"["+e+"]"}):c);t(");")}}function G(e,t,r,n){var a=e.shared,i=a.gl,o=a.draw,f=n.draw;var u=function(){var a,u=f.elements,s=t;return u?((u.contextDep&&n.contextDynamic||u.propDep)&&(s=r),a=u.append(e,s)):a=s.def(o,".",In),a&&s("if("+a+")"+i+".bindBuffer("+Xn+","+a+".buffer.buffer);"),a}();function s(a){var i=f[a];return i?i.contextDep&&n.contextDynamic||i.propDep?i.append(e,r):i.append(e,t):t.def(o,".",a)}var c,l,d=s(Rn),m=s(Mn),p=function(){var a,i=f.count,u=t;return i?((i.contextDep&&n.contextDynamic||i.propDep)&&(u=r),a=i.append(e,u),F.optional(function(){i.MISSING&&e.assert(t,"false","missing vertex count"),i.DYNAMIC&&e.assert(u,a+">=0","missing vertex count")})):(a=u.def(o,".",Ln),F.optional(function(){e.assert(u,a+">=0","missing vertex count")})),a}();if("number"==typeof p){if(0===p)return}else r("if(",p,"){"),r.exit("}");v&&(c=s(Wn),l=e.instancing);var h=u+".type",b=f.elements&&Ya(f.elements);function g(){function e(){r(l,".drawElementsInstancedANGLE(",[d,p,h,m+"<<(("+h+"-"+$r+")>>1)",c],");")}function t(){r(l,".drawArraysInstancedANGLE(",[d,m,p,c],");")}u?b?e():(r("if(",u,"){"),e(),r("}else{"),t(),r("}")):t()}function y(){function e(){r(i+".drawElements("+[d,p,h,m+"<<(("+h+"-"+$r+")>>1)"]+");")}function t(){r(i+".drawArrays("+[d,m,p]+");")}u?b?e():(r("if(",u,"){"),e(),r("}else{"),t(),r("}")):t()}v&&("number"!=typeof c||c>=0)?"string"==typeof c?(r("if(",c,">0){"),g(),r("}else if(",c,"<0){"),y(),r("}")):g():y()}function N(e,t,r,n,a){var i=C(),o=i.proc("body",a);return F.optional(function(){i.commandStr=t.commandStr,i.command=i.link(t.commandStr)}),v&&(i.instancing=o.def(i.shared.extensions,".angle_instanced_arrays")),e(i,o,r,n),i.compile().body}function Q(e,t,r,n){M(e,t),U(e,t,r,n.attributes,function(){return!0}),H(e,t,r,n.uniforms,function(){return!0}),G(e,t,t,r)}function V(e,t,r,n){function a(){return!0}e.batchId="a1",M(e,t),U(e,t,r,n.attributes,a),H(e,t,r,n.uniforms,a),G(e,t,t,r)}function Y(e,t,r,n){M(e,t);var a=r.contextDep,i=t.def(),o=t.def();e.shared.props=o,e.batchId=i;var f=e.scope(),u=e.scope();function s(e){return e.contextDep&&a||e.propDep}function c(e){return!s(e)}if(t(f.entry,"for(",i,"=0;",i,"<","a1",";++",i,"){",o,"=","a0","[",i,"];",u,"}",f.exit),r.needsContext&&B(e,u,r.context),r.needsFramebuffer&&P(e,u,r.framebuffer),R(e,u,r.state,s),r.profile&&s(r.profile)&&W(e,u,r,!1,!0),n)U(e,f,r,n.attributes,c),U(e,u,r,n.attributes,s),H(e,f,r,n.uniforms,c),H(e,u,r,n.uniforms,s),G(e,f,u,r);else{var l=e.global.def("{}"),d=r.shader.progVar.append(e,u),m=u.def(d,".id"),p=u.def(l,"[",m,"]");u(e.shared.gl,".useProgram(",d,".program);","if(!",p,"){",p,"=",l,"[",m,"]=",e.link(function(t){return N(V,e,r,t,2)}),"(",d,");}",p,".call(this,a0[",i,"],",i,");")}}function X(e,t,r){var n=t.static[r];if(n&&function(e){if("object"==typeof e&&!Ie(e)){for(var t=Object.keys(e),r=0;r<t.length;++r)if(L.isDynamic(e[t[r]]))return!0;return!1}}(n)){var a=e.global,i=Object.keys(n),o=!1,f=!1,u=!1,s=e.global.def("{}");i.forEach(function(t){var r=n[t];if(L.isDynamic(r)){"function"==typeof r&&(r=n[t]=L.unbox(r));var i=$a(r,null);o=o||i.thisDep,u=u||i.propDep,f=f||i.contextDep}else{switch(a(s,".",t,"="),typeof r){case"number":a(r);break;case"string":a('"',r,'"');break;case"object":Array.isArray(r)&&a("[",r.join(),"]");break;default:a(e.link(r))}a(";")}}),t.dynamic[r]=new L.DynamicVariable(nn,{thisDep:o,contextDep:f,propDep:u,ref:s,append:function(e,t){i.forEach(function(r){var a=n[r];if(L.isDynamic(a)){var i=e.invoke(t,a);t(s,".",r,"=",i,";")}})}}),delete t.static[r]}}return{next:w,current:x,procs:function(){var e=C(),t=e.proc("poll"),r=e.proc("refresh"),n=e.block();t(n),r(n);var i,o=e.shared,f=o.gl,u=o.next,s=o.current;n(s,".dirty=false;"),P(e,t),P(e,r,null,!0),v&&(i=e.link(v));for(var c=0;c<a.maxAttributes;++c){var l=r.def(o.attributes,"[",c,"]"),d=e.cond(l,".buffer");d.then(f,".enableVertexAttribArray(",c,");",f,".bindBuffer(",Yn,",",l,".buffer.buffer);",f,".vertexAttribPointer(",c,",",l,".size,",l,".type,",l,".normalized,",l,".stride,",l,".offset);").else(f,".disableVertexAttribArray(",c,");",f,".vertexAttrib4f(",c,",",l,".x,",l,".y,",l,".z,",l,".w);",l,".buffer=null;"),r(d),v&&r(i,".vertexAttribDivisorANGLE(",c,",",l,".divisor);")}return Object.keys(A).forEach(function(a){var i=A[a],o=n.def(u,".",a),c=e.block();c("if(",o,"){",f,".enable(",i,")}else{",f,".disable(",i,")}",s,".",a,"=",o,";"),r(c),t("if(",o,"!==",s,".",a,"){",c,"}")}),Object.keys(_).forEach(function(a){var i,o,c=_[a],l=x[a],d=e.block();if(d(f,".",c,"("),Ie(l)){var m=l.length;i=e.global.def(u,".",a),o=e.global.def(s,".",a),d(q(m,function(e){return i+"["+e+"]"}),");",q(m,function(e){return o+"["+e+"]="+i+"["+e+"];"}).join("")),t("if(",q(m,function(e){return i+"["+e+"]!=="+o+"["+e+"]"}).join("||"),"){",d,"}")}else i=n.def(u,".",a),o=n.def(s,".",a),d(i,");",s,".",a,"=",i,";"),t("if(",i,"!==",o,"){",d,"}");r(d)}),e.compile()}(),compile:function(e,t,n,a,i){var o=C();o.stats=o.link(i),Object.keys(t.static).forEach(function(e){X(o,t,e)}),Vn.forEach(function(t){X(o,e,t)});var f=z(e,t,n,a,o);return function(e,t){var r=e.proc("draw",1);M(e,r),B(e,r,t.context),P(e,r,t.framebuffer),I(e,r,t),R(e,r,t.state),W(e,r,t,!1,!0);var n=t.shader.progVar.append(e,r);if(r(e.shared.gl,".useProgram(",n,".program);"),t.shader.program)Q(e,r,t,t.shader.program);else{var a=e.global.def("{}"),i=r.def(n,".id"),o=r.def(a,"[",i,"]");r(e.cond(o).then(o,".call(this,a0);").else(o,"=",a,"[",i,"]=",e.link(function(r){return N(Q,e,t,r,1)}),"(",n,");",o,".call(this,a0);"))}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}(o,f),function(e,t){var n=e.proc("scope",3);e.batchId="a2";var a=e.shared,i=a.current;function o(r){var i=t.shader[r];i&&n.set(a.shader,"."+r,i.append(e,n))}B(e,n,t.context),t.framebuffer&&t.framebuffer.append(e,n),Qa(Object.keys(t.state)).forEach(function(r){var i=t.state[r].append(e,n);Ie(i)?i.forEach(function(t,a){n.set(e.next[r],"["+a+"]",t)}):n.set(a.next,"."+r,i)}),W(e,n,t,!0,!0),[In,Mn,Ln,Wn,Rn].forEach(function(r){var i=t.draw[r];i&&n.set(a.draw,"."+r,""+i.append(e,n))}),Object.keys(t.uniforms).forEach(function(i){n.set(a.uniforms,"["+r.id(i)+"]",t.uniforms[i].append(e,n))}),Object.keys(t.attributes).forEach(function(r){var a=t.attributes[r].append(e,n),i=e.scopeAttrib(r);Object.keys(new b).forEach(function(e){n.set(i,"."+e,a[e])})}),o(Bn),o(Pn),Object.keys(t.state).length>0&&(n(i,".dirty=true;"),n.exit(i,".dirty=true;")),n("a1(",e.shared.context,",a0,",e.batchId,");")}(o,f),function(e,t){var r=e.proc("batch",2);e.batchId="0",M(e,r);var n=!1,a=!0;Object.keys(t.context).forEach(function(e){n=n||t.context[e].propDep}),n||(B(e,r,t.context),a=!1);var i=t.framebuffer,o=!1;function f(e){return e.contextDep&&n||e.propDep}i?(i.propDep?n=o=!0:i.contextDep&&n&&(o=!0),o||P(e,r,i)):P(e,r,null),t.state.viewport&&t.state.viewport.propDep&&(n=!0),I(e,r,t),R(e,r,t.state,function(e){return!f(e)}),t.profile&&f(t.profile)||W(e,r,t,!1,"a1"),t.contextDep=n,t.needsContext=a,t.needsFramebuffer=o;var u=t.shader.progVar;if(u.contextDep&&n||u.propDep)Y(e,r,t,null);else{var s=u.append(e,r);if(r(e.shared.gl,".useProgram(",s,".program);"),t.shader.program)Y(e,r,t,t.shader.program);else{var c=e.global.def("{}"),l=r.def(s,".id"),d=r.def(c,"[",l,"]");r(e.cond(d).then(d,".call(this,a0,a1);").else(d,"=",c,"[",l,"]=",e.link(function(r){return N(Y,e,t,r,2)}),"(",s,");",d,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&r(e.shared.current,".dirty=true;")}(o,f),o.compile()}}}var Za=34918,ei=34919,ti=35007,ri=function(e,t){if(!t.ext_disjoint_timer_query)return null;var r=[];function n(e){r.push(e)}var a=[];function i(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var o=[];function f(e){o.push(e)}var u=[];function s(e,t,r){var n=o.pop()||new i;n.startQueryIndex=e,n.endQueryIndex=t,n.sum=0,n.stats=r,u.push(n)}var c=[],l=[];return{beginQuery:function(e){var n=r.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(ti,n),a.push(n),s(a.length-1,a.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(ti)},pushScopeStats:s,update:function(){var e,r,i=a.length;if(0!==i){l.length=Math.max(l.length,i+1),c.length=Math.max(c.length,i+1),c[0]=0,l[0]=0;var o=0;for(e=0,r=0;r<a.length;++r){var s=a[r];t.ext_disjoint_timer_query.getQueryObjectEXT(s,ei)?(o+=t.ext_disjoint_timer_query.getQueryObjectEXT(s,Za),n(s)):a[e++]=s,c[r+1]=o,l[r+1]=e}for(a.length=e,e=0,r=0;r<u.length;++r){var d=u[r],m=d.startQueryIndex,p=d.endQueryIndex;d.sum+=c[p]-c[m];var h=l[m],b=l[p];b===h?(d.stats.gpuTime+=d.sum/1e6,f(d)):(d.startQueryIndex=h,d.endQueryIndex=b,u[e++]=d)}u.length=e}},getNumPendingQueries:function(){return a.length},clear:function(){r.push.apply(r,a);for(var e=0;e<r.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(r[e]);a.length=0,r.length=0},restore:function(){a.length=0,r.length=0}}},ni=16384,ai=256,ii=1024,oi=34962,fi="webglcontextlost",ui="webglcontextrestored",si=1,ci=2,li=3;function di(e,t){for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}return function(r){var n=G(r);if(!n)return null;var a=n.gl,i=a.getContextAttributes(),o=a.isContextLost(),f=function(e,t){var r={};function n(t){F.type(t,"string","extension name must be string");var n,a=t.toLowerCase();try{n=r[a]=e.getExtension(a)}catch(i){}return!!n}for(var a=0;a<t.extensions.length;++a){var i=t.extensions[a];if(!n(i))return t.onDestroy(),t.onDone('"'+i+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(n),{extensions:r,restore:function(){Object.keys(r).forEach(function(e){if(r[e]&&!n(e))throw new Error("(regl): error restoring extension "+e)})}}}(a,n);if(!f)return null;var u,s,c=(u={"":0},s=[""],{id:function(e){var t=u[e];return t||(t=u[e]=s.length,s.push(e),t)},str:function(e){return s[e]}}),l={bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},d=f.extensions,m=ri(a,d),p=W(),h=a.drawingBufferWidth,b=a.drawingBufferHeight,g={tick:0,time:0,viewportWidth:h,viewportHeight:b,framebufferWidth:h,framebufferHeight:b,drawingBufferWidth:h,drawingBufferHeight:b,pixelRatio:n.pixelRatio},v=te(a,d),y=function(e,t,r,n){for(var a=r.maxAttributes,i=new Array(a),o=0;o<a;++o)i[o]=new Rr;return{Record:Rr,scope:{},state:i}}(0,0,v),x=function(t,r,n,a){var i=0,o={};function f(e){this.id=i++,this.buffer=t.createBuffer(),this.type=e,this.usage=le,this.byteLength=0,this.dimension=1,this.dtype=me,this.persistentData=null,n.profile&&(this.stats={size:0})}f.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},f.prototype.destroy=function(){l(this)};var u=[];function s(e,r,n){e.byteLength=r.byteLength,t.bufferData(e.type,r,n)}function c(t,r,n,a,i,o){var f,u;if(t.usage=n,Array.isArray(r)){if(t.dtype=a||pe,r.length>0)if(Array.isArray(r[0])){f=ce(r);for(var c=1,l=1;l<f.length;++l)c*=f[l];t.dimension=c,s(t,u=se(r,f,t.dtype),n),o?t.persistentData=u:ee.freeType(u)}else if("number"==typeof r[0]){t.dimension=i;var d=ee.allocType(t.dtype,r.length);ge(d,r),s(t,d,n),o?t.persistentData=d:ee.freeType(d)}else e(r[0])?(t.dimension=r[0].length,t.dtype=a||be(r[0])||pe,s(t,u=se(r,[r.length,r[0].length],t.dtype),n),o?t.persistentData=u:ee.freeType(u)):F.raise("invalid buffer data")}else if(e(r))t.dtype=a||be(r),t.dimension=i,s(t,r,n),o&&(t.persistentData=new Uint8Array(new Uint8Array(r.buffer)));else if(re(r)){f=r.shape;var m=r.stride,p=r.offset,h=0,b=0,g=0,v=0;1===f.length?(h=f[0],b=1,g=m[0],v=0):2===f.length?(h=f[0],b=f[1],g=m[0],v=m[1]):F.raise("invalid shape"),t.dtype=a||be(r.data)||pe,t.dimension=b;var y=ee.allocType(t.dtype,h*b);ve(y,r.data,h,b,g,v,p),s(t,y,n),o?t.persistentData=y:ee.freeType(y)}else r instanceof ArrayBuffer?(t.dtype=me,t.dimension=i,s(t,r,n),o&&(t.persistentData=new Uint8Array(new Uint8Array(r)))):F.raise("invalid buffer data")}function l(e){r.bufferCount--;for(var n=0;n<a.state.length;++n){var i=a.state[n];i.buffer===e&&(t.disableVertexAttribArray(n),i.buffer=null)}var f=e.buffer;F(f,"buffer must not be deleted already"),t.deleteBuffer(f),e.buffer=null,delete o[e.id]}return n.profile&&(r.getTotalBufferSize=function(){var e=0;return Object.keys(o).forEach(function(t){e+=o[t].stats.size}),e}),{create:function(a,i,u,s){r.bufferCount++;var d=new f(i);function m(r){var a=le,i=null,o=0,f=0,u=1;return Array.isArray(r)||e(r)||re(r)||r instanceof ArrayBuffer?i=r:"number"==typeof r?o=0|r:r&&(F.type(r,"object","buffer arguments must be an object, a number or an array"),"data"in r&&(F(null===i||Array.isArray(i)||e(i)||re(i),"invalid data for buffer"),i=r.data),"usage"in r&&(F.parameter(r.usage,ue,"invalid buffer usage"),a=ue[r.usage]),"type"in r&&(F.parameter(r.type,fe,"invalid buffer type"),f=fe[r.type]),"dimension"in r&&(F.type(r.dimension,"number","invalid dimension"),u=0|r.dimension),"length"in r&&(F.nni(o,"buffer length must be a nonnegative integer"),o=0|r.length)),d.bind(),i?c(d,i,a,f,u,s):(o&&t.bufferData(d.type,o,a),d.dtype=f||me,d.usage=a,d.dimension=u,d.byteLength=o),n.profile&&(d.stats.size=d.byteLength*he[d.dtype]),m}function p(e,r){F(r+e.byteLength<=d.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+r+" to a buffer of size "+d.byteLength),t.bufferSubData(d.type,r,e)}return o[d.id]=d,u||m(a),m._reglType="buffer",m._buffer=d,m.subdata=function(t,r){var n,a=0|(r||0);if(d.bind(),e(t)||t instanceof ArrayBuffer)p(t,a);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var i=ee.allocType(d.dtype,t.length);ge(i,t),p(i,a),ee.freeType(i)}else if(Array.isArray(t[0])||e(t[0])){n=ce(t);var o=se(t,n,d.dtype);p(o,a),ee.freeType(o)}else F.raise("invalid buffer data")}else if(re(t)){n=t.shape;var f=t.stride,u=0,s=0,c=0,l=0;1===n.length?(u=n[0],s=1,c=f[0],l=0):2===n.length?(u=n[0],s=n[1],c=f[0],l=f[1]):F.raise("invalid shape");var h=Array.isArray(t.data)?d.dtype:be(t.data),b=ee.allocType(h,u*s);ve(b,t.data,u,s,c,l,t.offset),p(b,a),ee.freeType(b)}else F.raise("invalid data for buffer subdata");return m},n.profile&&(m.stats=d.stats),m.destroy=function(){l(d)},m},createStream:function(e,t){var r=u.pop();return r||(r=new f(e)),r.bind(),c(r,t,de,0,1,!1),r},destroyStream:function(e){u.push(e)},clear:function(){ne(o).forEach(l),u.forEach(l)},getBuffer:function(e){return e&&e._buffer instanceof f?e._buffer:null},restore:function(){ne(o).forEach(function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})},_initBuffer:c}}(a,l,n,y),w=function(t,r,n,a){var i={},o=0,f={uint8:_e,uint16:Te};function u(e){this.id=o++,i[this.id]=this,this.buffer=e,this.primType=ke,this.vertCount=0,this.type=0}r.oes_element_index_uint&&(f.uint32=De),u.prototype.bind=function(){this.buffer.bind()};var s=[];function c(a,i,o,f,u,s,c){if(a.buffer.bind(),i){var l=c;c||e(i)&&(!re(i)||e(i.data))||(l=r.oes_element_index_uint?De:Te),n._initBuffer(a.buffer,i,o,l,3)}else t.bufferData(je,s,o),a.buffer.dtype=d||_e,a.buffer.usage=o,a.buffer.dimension=3,a.buffer.byteLength=s;var d=c;if(!c){switch(a.buffer.dtype){case _e:case Ae:d=_e;break;case Te:case Se:d=Te;break;case De:case Ee:d=De;break;default:F.raise("unsupported type for element array")}a.buffer.dtype=d}a.type=d,F(d!==De||!!r.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var m=u;m<0&&(m=a.buffer.byteLength,d===Te?m>>=1:d===De&&(m>>=2)),a.vertCount=m;var p=f;if(f<0){p=ke;var h=a.buffer.dimension;1===h&&(p=xe),2===h&&(p=we),3===h&&(p=ke)}a.primType=p}function l(e){a.elementsCount--,F(null!==e.buffer,"must not double destroy elements"),delete i[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,r){var i=n.create(null,je,!0),o=new u(i._buffer);function s(t){if(t)if("number"==typeof t)i(t),o.primType=ke,o.vertCount=0|t,o.type=_e;else{var r=null,n=Ce,a=-1,u=-1,l=0,d=0;Array.isArray(t)||e(t)||re(t)?r=t:(F.type(t,"object","invalid arguments for elements"),"data"in t&&(r=t.data,F(Array.isArray(r)||e(r)||re(r),"invalid data for element buffer")),"usage"in t&&(F.parameter(t.usage,ue,"invalid element buffer usage"),n=ue[t.usage]),"primitive"in t&&(F.parameter(t.primitive,ye,"invalid element buffer primitive"),a=ye[t.primitive]),"count"in t&&(F("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(F.parameter(t.type,f,"invalid buffer type"),d=f[t.type]),"length"in t?l=0|t.length:(l=u,d===Te||d===Se?l*=2:d!==De&&d!==Ee||(l*=4))),c(o,r,n,a,u,l,d)}else i(),o.primType=ke,o.vertCount=0,o.type=_e;return s}return a.elementsCount++,s(t),s._reglType="elements",s._elements=o,s.subdata=function(e,t){return i.subdata(e,t),s},s.destroy=function(){l(o)},s},createStream:function(e){var t=s.pop();return t||(t=new u(n.create(null,je,!0,!1)._buffer)),c(t,e,Oe,-1,-1,0,0),t},destroyStream:function(e){s.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){ne(i).forEach(l)}}}(a,d,x,l),k=function(e,t,r,n){var a={},i={};function o(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}function f(e,t){for(var r=0;r<e.length;++r)if(e[r].id===t.id)return void(e[r].location=t.location);e.push(t)}function u(r,n,o){var f=r===Lr?a:i,u=f[n];if(!u){var s=t.str(n);u=e.createShader(r),e.shaderSource(u,s),e.compileShader(u),F.shaderError(e,u,s,r,o),f[n]=u}return u}var s={},c=[],l=0;function d(e,t){this.id=l++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],n.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function m(r,a){var i,s,c=u(Lr,r.fragId),l=u(Mr,r.vertId),d=r.program=e.createProgram();e.attachShader(d,c),e.attachShader(d,l),e.linkProgram(d),F.linkError(e,d,t.str(r.fragId),t.str(r.vertId),a);var m=e.getProgramParameter(d,Wr);n.profile&&(r.stats.uniformsCount=m);var p=r.uniforms;for(i=0;i<m;++i)if(s=e.getActiveUniform(d,i))if(s.size>1)for(var h=0;h<s.size;++h){var b=s.name.replace("[0]","["+h+"]");f(p,new o(b,t.id(b),e.getUniformLocation(d,b),s))}else f(p,new o(s.name,t.id(s.name),e.getUniformLocation(d,s.name),s));var g=e.getProgramParameter(d,Ur);n.profile&&(r.stats.attributesCount=g);var v=r.attributes;for(i=0;i<g;++i)(s=e.getActiveAttrib(d,i))&&f(v,new o(s.name,t.id(s.name),e.getAttribLocation(d,s.name),s))}return n.profile&&(r.getMaxUniformsCount=function(){var e=0;return c.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},r.getMaxAttributesCount=function(){var e=0;return c.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e}),{clear:function(){var t=e.deleteShader.bind(e);ne(a).forEach(t),a={},ne(i).forEach(t),i={},c.forEach(function(t){e.deleteProgram(t.program)}),c.length=0,s={},r.shaderCount=0},program:function(e,t,n){F.command(e>=0,"missing vertex shader",n),F.command(t>=0,"missing fragment shader",n);var a=s[t];a||(a=s[t]={});var i=a[e];return i||(i=new d(t,e),r.shaderCount++,m(i,n),a[e]=i,c.push(i)),i},restore:function(){a={},i={};for(var e=0;e<c.length;++e)m(c[e])},shader:u,frag:-1,vert:-1}}(a,c,l,n),A=dr(a,d,v,function(){T.procs.poll()},g,l,n),_=gr(a,d,v,l,n),S=function(e,r,n,a,i,o){var f={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],s=["rgba4","rgb565","rgb5 a1"];r.ext_srgb&&s.push("srgba"),r.ext_color_buffer_half_float&&s.push("rgba16f","rgb16f"),r.webgl_color_buffer_float&&s.push("rgba32f");var c=["uint8"];function l(e,t,r){this.target=e,this.texture=t,this.renderbuffer=r;var n=0,a=0;t?(n=t.width,a=t.height):r&&(n=r.width,a=r.height),this.width=n,this.height=a}function d(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function m(e,t,r){if(e)if(e.texture){var n=e.texture._texture,a=Math.max(1,n.width),i=Math.max(1,n.height);F(a===t&&i===r,"inconsistent width/height for supplied texture"),n.refCount+=1}else{var o=e.renderbuffer._renderbuffer;F(o.width===t&&o.height===r,"inconsistent width/height for renderbuffer"),o.refCount+=1}}function p(t,r){r&&(r.texture?e.framebufferTexture2D(vr,t,r.target,r.texture._texture.texture,0):e.framebufferRenderbuffer(vr,t,yr,r.renderbuffer._renderbuffer.renderbuffer))}function h(e){var t=xr,r=null,n=null,a=e;"object"==typeof e&&(a=e.data,"target"in e&&(t=0|e.target)),F.type(a,"function","invalid attachment data");var i=a._reglType;return"texture2d"===i?(r=a,F(t===xr)):"textureCube"===i?(r=a,F(t>=wr&&t<wr+6,"invalid cube map target")):"renderbuffer"===i?(n=a,t=yr):F.raise("invalid regl object for attachment"),new l(t,r,n)}function b(e,t,r,n,o){if(r){var f=a.create2D({width:e,height:t,format:n,type:o});return f._texture.refCount=0,new l(xr,f,null)}var u=i.create({width:e,height:t,format:n});return u._renderbuffer.refCount=0,new l(yr,null,u)}function g(e){return e&&(e.texture||e.renderbuffer)}function v(e,t,r){e&&(e.texture?e.texture.resize(t,r):e.renderbuffer&&e.renderbuffer.resize(t,r),e.width=t,e.height=r)}r.oes_texture_half_float&&c.push("half float","float16"),r.oes_texture_float&&c.push("float","float32");var y=0,x={};function w(){this.id=y++,x[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function k(e){e.colorAttachments.forEach(d),d(e.depthAttachment),d(e.stencilAttachment),d(e.depthStencilAttachment)}function A(t){var r=t.framebuffer;F(r,"must not double destroy framebuffer"),e.deleteFramebuffer(r),t.framebuffer=null,o.framebufferCount--,delete x[t.id]}function _(t){var r;e.bindFramebuffer(vr,t.framebuffer);var a=t.colorAttachments;for(r=0;r<a.length;++r)p(kr+r,a[r]);for(r=a.length;r<n.maxColorAttachments;++r)e.framebufferTexture2D(vr,kr+r,xr,null,0);e.framebufferTexture2D(vr,Sr,xr,null,0),e.framebufferTexture2D(vr,Ar,xr,null,0),e.framebufferTexture2D(vr,_r,xr,null,0),p(Ar,t.depthAttachment),p(_r,t.stencilAttachment),p(Sr,t.depthStencilAttachment);var i=e.checkFramebufferStatus(vr);e.isContextLost()||i===Tr||F.raise("framebuffer configuration not supported, status = "+Pr[i]),e.bindFramebuffer(vr,f.next?f.next.framebuffer:null),f.cur=f.next,e.getError()}function S(e,a){var i=new w;function l(e,t){var a;F(f.next!==i,"can not update framebuffer which is currently in use");var o=0,d=0,p=!0,v=!0,y=null,x=!0,w="rgba",A="uint8",S=1,T=null,E=null,D=null,j=!1;if("number"==typeof e)o=0|e,d=0|t||o;else if(e){F.type(e,"object","invalid arguments for framebuffer");var O=e;if("shape"in O){var C=O.shape;F(Array.isArray(C)&&C.length>=2,"invalid shape for framebuffer"),o=C[0],d=C[1]}else"radius"in O&&(o=d=O.radius),"width"in O&&(o=O.width),"height"in O&&(d=O.height);("color"in O||"colors"in O)&&(y=O.color||O.colors,Array.isArray(y)&&F(1===y.length||r.webgl_draw_buffers,"multiple render targets not supported")),y||("colorCount"in O&&(S=0|O.colorCount,F(S>0,"invalid color buffer count")),"colorTexture"in O&&(x=!!O.colorTexture,w="rgba4"),"colorType"in O&&(A=O.colorType,x?(F(r.oes_texture_float||!("float"===A||"float32"===A),"you must enable OES_texture_float in order to use floating point framebuffer objects"),F(r.oes_texture_half_float||!("half float"===A||"float16"===A),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===A||"float16"===A?(F(r.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),w="rgba16f"):"float"!==A&&"float32"!==A||(F(r.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),w="rgba32f"),F.oneOf(A,c,"invalid color type")),"colorFormat"in O&&(w=O.colorFormat,u.indexOf(w)>=0?x=!0:s.indexOf(w)>=0?x=!1:x?F.oneOf(O.colorFormat,u,"invalid color format for texture"):F.oneOf(O.colorFormat,s,"invalid color format for renderbuffer"))),("depthTexture"in O||"depthStencilTexture"in O)&&(j=!(!O.depthTexture&&!O.depthStencilTexture),F(!j||r.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in O&&("boolean"==typeof O.depth?p=O.depth:(T=O.depth,v=!1)),"stencil"in O&&("boolean"==typeof O.stencil?v=O.stencil:(E=O.stencil,p=!1)),"depthStencil"in O&&("boolean"==typeof O.depthStencil?p=v=O.depthStencil:(D=O.depthStencil,p=!1,v=!1))}else o=d=1;var z=null,B=null,P=null,I=null;if(Array.isArray(y))z=y.map(h);else if(y)z=[h(y)];else for(z=new Array(S),a=0;a<S;++a)z[a]=b(o,d,x,w,A);F(r.webgl_draw_buffers||z.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),F(z.length<=n.maxColorAttachments,"too many color attachments, not supported"),o=o||z[0].width,d=d||z[0].height,T?B=h(T):p&&!v&&(B=b(o,d,j,"depth","uint32")),E?P=h(E):v&&!p&&(P=b(o,d,!1,"stencil","uint8")),D?I=h(D):!T&&!E&&v&&p&&(I=b(o,d,j,"depth stencil","depth stencil")),F(!!T+!!E+!!D<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var R=null;for(a=0;a<z.length;++a)if(m(z[a],o,d),F(!z[a]||z[a].texture&&Dr.indexOf(z[a].texture._texture.format)>=0||z[a].renderbuffer&&Br.indexOf(z[a].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+a+" is invalid"),z[a]&&z[a].texture){var L=jr[z[a].texture._texture.format]*Or[z[a].texture._texture.type];null===R?R=L:F(R===L,"all color attachments much have the same number of bits per pixel.")}return m(B,o,d),F(!B||B.texture&&B.texture._texture.format===Er||B.renderbuffer&&B.renderbuffer._renderbuffer.format===Cr,"invalid depth attachment for framebuffer object"),m(P,o,d),F(!P||P.renderbuffer&&P.renderbuffer._renderbuffer.format===Fr,"invalid stencil attachment for framebuffer object"),m(I,o,d),F(!I||I.texture&&I.texture._texture.format===zr||I.renderbuffer&&I.renderbuffer._renderbuffer.format===zr,"invalid depth-stencil attachment for framebuffer object"),k(i),i.width=o,i.height=d,i.colorAttachments=z,i.depthAttachment=B,i.stencilAttachment=P,i.depthStencilAttachment=I,l.color=z.map(g),l.depth=g(B),l.stencil=g(P),l.depthStencil=g(I),l.width=i.width,l.height=i.height,_(i),l}return o.framebufferCount++,l(e,a),t(l,{resize:function(e,t){F(f.next!==i,"can not resize a framebuffer which is currently in use");var r=Math.max(0|e,1),n=Math.max(0|t||r,1);if(r===i.width&&n===i.height)return l;for(var a=i.colorAttachments,o=0;o<a.length;++o)v(a[o],r,n);return v(i.depthAttachment,r,n),v(i.stencilAttachment,r,n),v(i.depthStencilAttachment,r,n),i.width=l.width=r,i.height=l.height=n,_(i),l},_reglType:"framebuffer",_framebuffer:i,destroy:function(){A(i),k(i)},use:function(e){f.setFBO({framebuffer:l},e)}})}return t(f,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof w)return t}return null},create:S,createCube:function(e){var i=Array(6);function o(e){var n;F(i.indexOf(f.next)<0,"can not update framebuffer which is currently in use");var s,l={color:null},d=0,m=null,p="rgba",h="uint8",b=1;if("number"==typeof e)d=0|e;else if(e){F.type(e,"object","invalid arguments for framebuffer");var g=e;if("shape"in g){var v=g.shape;F(Array.isArray(v)&&v.length>=2,"invalid shape for framebuffer"),F(v[0]===v[1],"cube framebuffer must be square"),d=v[0]}else"radius"in g&&(d=0|g.radius),"width"in g?(d=0|g.width,"height"in g&&F(g.height===d,"must be square")):"height"in g&&(d=0|g.height);("color"in g||"colors"in g)&&(m=g.color||g.colors,Array.isArray(m)&&F(1===m.length||r.webgl_draw_buffers,"multiple render targets not supported")),m||("colorCount"in g&&(b=0|g.colorCount,F(b>0,"invalid color buffer count")),"colorType"in g&&(F.oneOf(g.colorType,c,"invalid color type"),h=g.colorType),"colorFormat"in g&&(p=g.colorFormat,F.oneOf(g.colorFormat,u,"invalid color format for texture"))),"depth"in g&&(l.depth=g.depth),"stencil"in g&&(l.stencil=g.stencil),"depthStencil"in g&&(l.depthStencil=g.depthStencil)}else d=1;if(m)if(Array.isArray(m))for(s=[],n=0;n<m.length;++n)s[n]=m[n];else s=[m];else{s=Array(b);var y={radius:d,format:p,type:h};for(n=0;n<b;++n)s[n]=a.createCube(y)}for(l.color=Array(s.length),n=0;n<s.length;++n){var x=s[n];F("function"==typeof x&&"textureCube"===x._reglType,"invalid cube map"),d=d||x.width,F(x.width===d&&x.height===d,"invalid cube map shape"),l.color[n]={target:wr,data:s[n]}}for(n=0;n<6;++n){for(var w=0;w<s.length;++w)l.color[w].target=wr+n;n>0&&(l.depth=i[0].depth,l.stencil=i[0].stencil,l.depthStencil=i[0].depthStencil),i[n]?i[n](l):i[n]=S(l)}return t(o,{width:d,height:d,color:s})}return o(e),t(o,{faces:i,resize:function(e){var t,r=0|e;if(F(r>0&&r<=n.maxCubeMapSize,"invalid radius for cube fbo"),r===o.width)return o;var a=o.color;for(t=0;t<a.length;++t)a[t].resize(r);for(t=0;t<6;++t)i[t].resize(r);return o.width=o.height=r,o},_reglType:"framebufferCube",destroy:function(){i.forEach(function(e){e.destroy()})}})},clear:function(){ne(x).forEach(A)},restore:function(){f.cur=null,f.next=null,f.dirty=!0,ne(x).forEach(function(t){t.framebuffer=e.createFramebuffer(),_(t)})}})}(a,d,v,A,_,l),T=Ja(a,c,d,v,x,w,0,S,{},y,k,{elements:null,primitive:4,count:-1,offset:0,instances:-1},g,m,n),E=Qr(a,S,T.procs.poll,g,i,d,v),D=T.next,j=a.canvas,O=[],C=[],z=[],B=[n.onDestroy],P=null;function I(){if(0===O.length)return m&&m.update(),void(P=null);P=M.next(I),$();for(var e=O.length-1;e>=0;--e){var t=O[e];t&&t(g,null,0)}a.flush(),m&&m.update()}function R(){!P&&O.length>0&&(P=M.next(I))}function U(){P&&(M.cancel(I),P=null)}function H(e){e.preventDefault(),o=!0,U(),C.forEach(function(e){e()})}function q(e){a.getError(),o=!1,f.restore(),k.restore(),x.restore(),A.restore(),_.restore(),S.restore(),m&&m.restore(),T.procs.refresh(),R(),z.forEach(function(e){e()})}function N(e){function r(e){var t={},r={};return Object.keys(e).forEach(function(n){var a=e[n];L.isDynamic(a)?r[n]=L.unbox(a,n):t[n]=a}),{dynamic:r,static:t}}F(!!e,"invalid args to regl({...})"),F.type(e,"object","invalid args to regl({...})");var n=r(e.context||{}),a=r(e.uniforms||{}),i=r(e.attributes||{}),f=r(function(e){var r=t({},e);function n(e){if(e in r){var t=r[e];delete r[e],Object.keys(t).forEach(function(n){r[e+"."+n]=t[n]})}}return delete r.uniforms,delete r.attributes,delete r.context,"stencil"in r&&r.stencil.op&&(r.stencil.opBack=r.stencil.opFront=r.stencil.op,delete r.stencil.op),n("blend"),n("depth"),n("cull"),n("stencil"),n("polygonOffset"),n("scissor"),n("sample"),r}(e)),u={gpuTime:0,cpuTime:0,count:0},s=T.compile(f,i,a,n,u),c=s.draw,l=s.batch,d=s.scope,m=[];return t(function(e,t){var r;if(o&&F.raise("context lost"),"function"==typeof e)return d.call(this,null,e,0);if("function"==typeof t){if("number"==typeof e){for(r=0;r<e;++r)d.call(this,null,t,r);return}if(Array.isArray(e)){for(r=0;r<e.length;++r)d.call(this,e[r],t,r);return}return d.call(this,e,t,0)}if("number"==typeof e){if(e>0)return l.call(this,function(e){for(;m.length<e;)m.push(null);return m}(0|e),0|e)}else{if(!Array.isArray(e))return c.call(this,e);if(e.length)return l.call(this,e,e.length)}},{stats:u})}j&&(j.addEventListener(fi,H,!1),j.addEventListener(ui,q,!1));var Q=S.setFBO=N({framebuffer:L.define.call(null,si,"framebuffer")});function V(e,t){var r=0;T.procs.poll();var n=t.color;n&&(a.clearColor(+n[0]||0,+n[1]||0,+n[2]||0,+n[3]||0),r|=ni),"depth"in t&&(a.clearDepth(+t.depth),r|=ai),"stencil"in t&&(a.clearStencil(0|t.stencil),r|=ii),F(!!r,"called regl.clear with no buffer specified"),a.clear(r)}function Y(e){return F.type(e,"function","regl.frame() callback must be a function"),O.push(e),R(),{cancel:function(){var t=di(O,e);F(t>=0,"cannot cancel a frame twice"),O[t]=function e(){var t=di(O,e);O[t]=O[O.length-1],O.length-=1,O.length<=0&&U()}}}}function X(){var e=D.viewport,t=D.scissor_box;e[0]=e[1]=t[0]=t[1]=0,g.viewportWidth=g.framebufferWidth=g.drawingBufferWidth=e[2]=t[2]=a.drawingBufferWidth,g.viewportHeight=g.framebufferHeight=g.drawingBufferHeight=e[3]=t[3]=a.drawingBufferHeight}function $(){g.tick+=1,g.time=J(),X(),T.procs.poll()}function K(){X(),T.procs.refresh(),m&&m.update()}function J(){return(W()-p)/1e3}K();var Z=t(N,{clear:function(e){if(F("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var r=0;r<6;++r)Q(t({framebuffer:e.framebuffer.faces[r]},e),V);else Q(e,V);else V(0,e)},prop:L.define.bind(null,si),context:L.define.bind(null,ci),this:L.define.bind(null,li),draw:N({}),buffer:function(e){return x.create(e,oi,!1,!1)},elements:function(e){return w.create(e,!1)},texture:A.create2D,cube:A.createCube,renderbuffer:_.create,framebuffer:S.create,framebufferCube:S.createCube,attributes:i,frame:Y,on:function(e,t){var r;switch(F.type(t,"function","listener callback must be a function"),e){case"frame":return Y(t);case"lost":r=C;break;case"restore":r=z;break;case"destroy":r=B;break;default:F.raise("invalid event, must be one of frame,lost,restore,destroy")}return r.push(t),{cancel:function(){for(var e=0;e<r.length;++e)if(r[e]===t)return r[e]=r[r.length-1],void r.pop()}}},limits:v,hasExtension:function(e){return v.extensions.indexOf(e.toLowerCase())>=0},read:E,destroy:function(){O.length=0,U(),j&&(j.removeEventListener(fi,H),j.removeEventListener(ui,q)),k.clear(),S.clear(),_.clear(),A.clear(),w.clear(),x.clear(),m&&m.clear(),B.forEach(function(e){e()})},_gl:a,_refresh:K,poll:function(){$(),m&&m.update()},now:J,stats:l});return n.onDone(null,Z),Z}});
},{}],"KkZG":[function(require,module,exports) {
"use strict";function e(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}function t(e,t){var n=e.__state.conversionName.toString(),o=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),s=e.a,a=Math.round(e.h),l=e.s.toFixed(1),d=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var c=e.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===n?"rgb("+o+","+i+","+r+")":"CSS_RGBA"===n?"rgba("+o+","+i+","+r+","+s+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+i+","+r+"]":"RGBA_ARRAY"===n?"["+o+","+i+","+r+","+s+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+",a:"+s+"}":"HSV_OBJ"===n?"{h:"+a+",s:"+l+",v:"+d+"}":"HSVA_OBJ"===n?"{h:"+a+",s:"+l+",v:"+d+",a:"+s+"}":"unknown format"}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.GUI=exports.gui=exports.dom=exports.controllers=exports.color=void 0;var n=Array.prototype.forEach,o=Array.prototype.slice,i={BREAK:{},extend:function(e){return this.each(o.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))},this),e},defaults:function(e){return this.each(o.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))},this),e},compose:function(){var e=o.call(arguments);return function(){for(var t=o.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,o){if(e)if(n&&e.forEach&&e.forEach===n)e.forEach(t,o);else if(e.length===e.length+0){var i,r=void 0;for(r=0,i=e.length;r<i;r++)if(r in e&&t.call(o,e[r],r)===this.BREAK)return}else for(var s in e)if(t.call(o,e[s],s)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var o=void 0;return function(){var i=this,r=arguments;var s=n||!o;clearTimeout(o),o=setTimeout(function(){o=null,n||e.apply(i,r)},t),s&&e.apply(i,r)}},toArray:function(e){return e.toArray?e.toArray():o.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},r=[{litmus:i.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:t},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:t},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:t},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:t}}},{litmus:i.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:i.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:i.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(i.isNumber(e.r)&&i.isNumber(e.g)&&i.isNumber(e.b)&&i.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(i.isNumber(e.r)&&i.isNumber(e.g)&&i.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(i.isNumber(e.h)&&i.isNumber(e.s)&&i.isNumber(e.v)&&i.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(i.isNumber(e.h)&&i.isNumber(e.s)&&i.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],s=void 0,a=void 0,l=function(){a=!1;var e=arguments.length>1?i.toArray(arguments):arguments[0];return i.each(r,function(t){if(t.litmus(e))return i.each(t.conversions,function(t,n){if(s=t.read(e),!1===a&&!1!==s)return a=s,s.conversionName=n,s.conversion=t,i.BREAK}),i.BREAK}),a},d=void 0,c={hsv_to_rgb:function(e,t,n){var o=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),r=n*(1-t),s=n*(1-i*t),a=n*(1-(1-i)*t),l=[[n,a,r],[s,n,r],[r,n,a],[r,s,n],[a,r,n],[n,r,s]][o];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,n){var o=Math.min(e,t,n),i=Math.max(e,t,n),r=i-o,s=void 0;return 0===i?{h:NaN,s:0,v:0}:(s=e===i?(t-n)/r:t===i?2+(n-e)/r:4+(e-t)/r,(s/=6)<0&&(s+=1),{h:360*s,s:r/i,v:i/255})},rgb_to_hex:function(e,t,n){var o=this.hex_with_component(0,2,e);return o=this.hex_with_component(o,1,t),o=this.hex_with_component(o,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(d=8*t)|e&~(255<<d)}},u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),p=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,o)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(o):void 0},f=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},m=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},g=function(){function e(){if(_(this,e),this.__state=l.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return h(e,[{key:"toString",value:function(){return t(this)}},{key:"toHexString",value:function(){return t(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function b(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(g.recalculateRGB(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(g.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function v(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(g.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(g.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}g.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=c.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");i.extend(e.__state,c.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},g.recalculateHSV=function(e){var t=c.rgb_to_hsv(e.r,e.g,e.b);i.extend(e.__state,{s:t.s,v:t.v}),i.isNaN(t.h)?i.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},g.COMPONENTS=["r","g","b","h","s","v","hex","a"],b(g.prototype,"r",2),b(g.prototype,"g",1),b(g.prototype,"b",0),v(g.prototype,"h"),v(g.prototype,"s"),v(g.prototype,"v"),Object.defineProperty(g.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(g.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=c.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var y=function(){function e(t,n){_(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return h(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),w={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},x={};i.each(w,function(e,t){i.each(e,function(e){x[e]=t})});var E=/(\d+(\.\d+)?)px/;function C(e){if("0"===e||i.isUndefined(e))return 0;var t=e.match(E);return i.isNull(t)?0:parseFloat(t[1])}var A={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var o=n,r=t;i.isUndefined(r)&&(r=!0),i.isUndefined(o)&&(o=!0),e.style.position="absolute",r&&(e.style.left=0,e.style.right=0),o&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,o){var r=n||{},s=x[t];if(!s)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(s);switch(s){case"MouseEvents":var l=r.x||r.clientX||0,d=r.y||r.clientY||0;a.initMouseEvent(t,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,l,d,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=a.initKeyboardEvent||a.initKeyEvent;i.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:a.initEvent(t,r.bubbles||!1,r.cancelable||!0)}i.defaults(a,o),e.dispatchEvent(a)},bind:function(e,t,n,o){var i=o||!1;return e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n),A},unbind:function(e,t,n,o){var i=o||!1;return e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on"+t,n),A},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return A},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),o=n.indexOf(t);-1!==o&&(n.splice(o,1),e.className=n.join(" "))}else e.className=void 0;return A},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return C(t["border-left-width"])+C(t["border-right-width"])+C(t["padding-left"])+C(t["padding-right"])+C(t.width)},getHeight:function(e){var t=getComputedStyle(e);return C(t["border-top-width"])+C(t["border-bottom-width"])+C(t["padding-top"])+C(t["padding-bottom"])+C(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},k=function(e){function t(e,n){_(this,t);var o=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=o;return o.__prev=o.getValue(),o.__checkbox=document.createElement("input"),o.__checkbox.setAttribute("type","checkbox"),A.bind(o.__checkbox,"change",function(){i.setValue(!i.__prev)},!1),o.domElement.appendChild(o.__checkbox),o.updateDisplay(),o}return f(t,y),h(t,[{key:"setValue",value:function(e){var n=p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),S=function(e){function t(e,n,o){_(this,t);var r=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),s=o,a=r;if(r.__select=document.createElement("select"),i.isArray(s)){var l={};i.each(s,function(e){l[e]=e}),s=l}return i.each(s,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),a.__select.appendChild(n)}),r.updateDisplay(),A.bind(r.__select,"change",function(){var e=this.options[this.selectedIndex].value;a.setValue(e)}),r.domElement.appendChild(r.__select),r}return f(t,y),h(t,[{key:"setValue",value:function(e){var n=p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return A.isActive(this.__select)?this:(this.__select.value=this.getValue(),p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(),O=function(e){function t(e,n){_(this,t);var o=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=o;function r(){i.setValue(i.__input.value)}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),A.bind(o.__input,"keyup",r),A.bind(o.__input,"change",r),A.bind(o.__input,"blur",function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}),A.bind(o.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return f(t,y),h(t,[{key:"updateDisplay",value:function(){return A.isActive(this.__input)||(this.__input.value=this.getValue()),p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function T(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var L=function(e){function t(e,n,o){_(this,t);var r=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),s=o||{};return r.__min=s.min,r.__max=s.max,r.__step=s.step,i.isUndefined(r.__step)?0===r.initialValue?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=T(r.__impliedStep),r}return f(t,y),h(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=T(e),this}}]),t}();function R(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}var B=function(e){function t(e,n,o){_(this,t);var r=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o));r.__truncationSuspended=!1;var s=r,a=void 0;function l(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function d(e){var t=a-e.clientY;s.setValue(s.getValue()+t*s.__impliedStep),a=e.clientY}function c(){A.unbind(window,"mousemove",d),A.unbind(window,"mouseup",c),l()}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),A.bind(r.__input,"change",function(){var e=parseFloat(s.__input.value);i.isNaN(e)||s.setValue(e)}),A.bind(r.__input,"blur",function(){l()}),A.bind(r.__input,"mousedown",function(e){A.bind(window,"mousemove",d),A.bind(window,"mouseup",c),a=e.clientY}),A.bind(r.__input,"keydown",function(e){13===e.keyCode&&(s.__truncationSuspended=!0,this.blur(),s.__truncationSuspended=!1,l())}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return f(t,L),h(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():R(this.getValue(),this.__precision),p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}();function N(e,t,n,o,i){return o+(e-t)/(n-t)*(i-o)}var H=function(e){function t(e,n,o,i,r){_(this,t);var s=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:o,max:i,step:r})),a=s;function l(e){e.preventDefault();var t=a.__background.getBoundingClientRect();return a.setValue(N(e.clientX,t.left,t.right,a.__min,a.__max)),!1}function d(){A.unbind(window,"mousemove",l),A.unbind(window,"mouseup",d),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function c(e){var t=e.touches[0].clientX,n=a.__background.getBoundingClientRect();a.setValue(N(t,n.left,n.right,a.__min,a.__max))}function u(){A.unbind(window,"touchmove",c),A.unbind(window,"touchend",u),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),A.bind(s.__background,"mousedown",function(e){document.activeElement.blur(),A.bind(window,"mousemove",l),A.bind(window,"mouseup",d),l(e)}),A.bind(s.__background,"touchstart",function(e){if(1!==e.touches.length)return;A.bind(window,"touchmove",c),A.bind(window,"touchend",u),c(e)}),A.addClass(s.__background,"slider"),A.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return f(t,L),h(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),F=function(e){function t(e,n,o){_(this,t);var i=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===o?"Fire":o,A.bind(i.__button,"click",function(e){return e.preventDefault(),r.fire(),!1}),A.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return f(t,y),h(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(),P=function(e){function t(e,n){_(this,t);var o=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));o.__color=new g(o.getValue()),o.__temp=new g(0);var r=o;o.domElement=document.createElement("div"),A.makeSelectable(o.domElement,!1),o.__selector=document.createElement("div"),o.__selector.className="selector",o.__saturation_field=document.createElement("div"),o.__saturation_field.className="saturation-field",o.__field_knob=document.createElement("div"),o.__field_knob.className="field-knob",o.__field_knob_border="2px solid ",o.__hue_knob=document.createElement("div"),o.__hue_knob.className="hue-knob",o.__hue_field=document.createElement("div"),o.__hue_field.className="hue-field",o.__input=document.createElement("input"),o.__input.type="text",o.__input_textShadow="0 1px 1px ",A.bind(o.__input,"keydown",function(e){13===e.keyCode&&h.call(this)}),A.bind(o.__input,"blur",h),A.bind(o.__selector,"mousedown",function(){A.addClass(this,"drag").bind(window,"mouseup",function(){A.removeClass(r.__selector,"drag")})}),A.bind(o.__selector,"touchstart",function(){A.addClass(this,"drag").bind(window,"touchend",function(){A.removeClass(r.__selector,"drag")})});var s=document.createElement("div");function a(e){f(e),A.bind(window,"mousemove",f),A.bind(window,"touchmove",f),A.bind(window,"mouseup",c),A.bind(window,"touchend",c)}function d(e){b(e),A.bind(window,"mousemove",b),A.bind(window,"touchmove",b),A.bind(window,"mouseup",u),A.bind(window,"touchend",u)}function c(){A.unbind(window,"mousemove",f),A.unbind(window,"touchmove",f),A.unbind(window,"mouseup",c),A.unbind(window,"touchend",c),p()}function u(){A.unbind(window,"mousemove",b),A.unbind(window,"touchmove",b),A.unbind(window,"mouseup",u),A.unbind(window,"touchend",u),p()}function h(){var e=l(this.value);!1!==e?(r.__color.__state=e,r.setValue(r.__color.toOriginal())):this.value=r.__color.toString()}function p(){r.__onFinishChange&&r.__onFinishChange.call(r,r.__color.toOriginal())}function f(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=r.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,o=n.clientX,i=n.clientY,s=(o-t.left)/(t.right-t.left),a=1-(i-t.top)/(t.bottom-t.top);return a>1?a=1:a<0&&(a=0),s>1?s=1:s<0&&(s=0),r.__color.v=a,r.__color.s=s,r.setValue(r.__color.toOriginal()),!1}function b(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=r.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),r.__color.h=360*n,r.setValue(r.__color.toOriginal()),!1}return i.extend(o.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),i.extend(o.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:o.__field_knob_border+(o.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),i.extend(o.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),i.extend(o.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),i.extend(s.style,{width:"100%",height:"100%",background:"none"}),D(s,"top","rgba(0,0,0,0)","#000"),i.extend(o.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),V(o.__hue_field),i.extend(o.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:o.__input_textShadow+"rgba(0,0,0,0.7)"}),A.bind(o.__saturation_field,"mousedown",a),A.bind(o.__saturation_field,"touchstart",a),A.bind(o.__field_knob,"mousedown",a),A.bind(o.__field_knob,"touchstart",a),A.bind(o.__hue_field,"mousedown",d),A.bind(o.__hue_field,"touchstart",d),o.__saturation_field.appendChild(s),o.__selector.appendChild(o.__field_knob),o.__selector.appendChild(o.__saturation_field),o.__selector.appendChild(o.__hue_field),o.__hue_field.appendChild(o.__hue_knob),o.domElement.appendChild(o.__input),o.domElement.appendChild(o.__selector),o.updateDisplay(),o}return f(t,y),h(t,[{key:"updateDisplay",value:function(){var e=l(this.getValue());if(!1!==e){var t=!1;i.each(g.COMPONENTS,function(n){if(!i.isUndefined(e[n])&&!i.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&i.extend(this.__color.__state,e)}i.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,o=255-n;i.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,D(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),i.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),t}(),j=["-moz-","-o-","-webkit-","-ms-",""];function D(e,t,n,o){e.style.background="",i.each(j,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+o+" 100%); "})}function V(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var I={load:function(e,t){var n=t||document,o=n.createElement("link");o.type="text/css",o.rel="stylesheet",o.href=e,n.getElementsByTagName("head")[0].appendChild(o)},inject:function(e,t){var n=t||document,o=document.createElement("style");o.type="text/css",o.innerHTML=e;var i=n.getElementsByTagName("head")[0];try{i.appendChild(o)}catch(r){}}},z='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',M=function(e,t){var n=e[t];return i.isArray(arguments[2])||i.isObject(arguments[2])?new S(e,t,arguments[2]):i.isNumber(n)?i.isNumber(arguments[2])&&i.isNumber(arguments[3])?i.isNumber(arguments[4])?new H(e,t,arguments[2],arguments[3],arguments[4]):new H(e,t,arguments[2],arguments[3]):i.isNumber(arguments[4])?new B(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new B(e,t,{min:arguments[2],max:arguments[3]}):i.isString(n)?new O(e,t):i.isFunction(n)?new F(e,t,""):i.isBoolean(n)?new k(e,t):null};function G(e){setTimeout(e,1e3/60)}var U=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||G,X=function(){function e(){_(this,e),this.backgroundElement=document.createElement("div"),i.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),A.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),i.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;A.bind(this.backgroundElement,"click",function(){t.hide()})}return h(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),i.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",A.unbind(e.domElement,"webkitTransitionEnd",t),A.unbind(e.domElement,"transitionend",t),A.unbind(e.domElement,"oTransitionEnd",t)};A.bind(this.domElement,"webkitTransitionEnd",t),A.bind(this.domElement,"transitionend",t),A.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-A.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-A.getHeight(this.domElement)/2+"px"}}]),e}(),K=e(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");I.inject(K);var Y="dg",J=72,W=20,Q="Default",q=function(){try{return!!window.localStorage}catch(e){return!1}}(),Z=void 0,$=!0,ee=void 0,te=!1,ne=[],oe=function e(t){var n=this,o=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),A.addClass(this.domElement,Y),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],o=i.defaults(o,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),o=i.defaults(o,{resizable:o.autoPlace,hideable:o.autoPlace}),i.isUndefined(o.load)?o.load={preset:Q}:o.preset&&(o.load.preset=o.preset),i.isUndefined(o.parent)&&o.hideable&&ne.push(this),o.resizable=i.isUndefined(o.parent)&&o.resizable,o.autoPlace&&i.isUndefined(o.scrollable)&&(o.scrollable=!0);var r,s=q&&"true"===localStorage.getItem(ce(this,"isLocal")),a=void 0,l=void 0;if(Object.defineProperties(this,{parent:{get:function(){return o.parent}},scrollable:{get:function(){return o.scrollable}},autoPlace:{get:function(){return o.autoPlace}},closeOnTop:{get:function(){return o.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:o.load.preset},set:function(e){n.parent?n.getRoot().preset=e:o.load.preset=e,ge(this),n.revert()}},width:{get:function(){return o.width},set:function(e){o.width=e,fe(n,e)}},name:{get:function(){return o.name},set:function(e){o.name=e,l&&(l.innerHTML=o.name)}},closed:{get:function(){return o.closed},set:function(t){o.closed=t,o.closed?A.addClass(n.__ul,e.CLASS_CLOSED):A.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return o.load}},useLocalStorage:{get:function(){return s},set:function(e){q&&(s=e,e?A.bind(window,"unload",a):A.unbind(window,"unload",a),localStorage.setItem(ce(n,"isLocal"),e))}}}),i.isUndefined(o.parent)){if(this.closed=o.closed||!1,A.addClass(this.domElement,e.CLASS_MAIN),A.makeSelectable(this.domElement,!1),q&&s){n.useLocalStorage=!0;var d=localStorage.getItem(ce(this,"gui"));d&&(o.load=JSON.parse(d))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,A.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),o.closeOnTop?(A.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(A.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),A.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===o.closed&&(o.closed=!0);var c=document.createTextNode(o.name);A.addClass(c,"controller-name"),l=ie(n,c);A.addClass(this.__ul,e.CLASS_CLOSED),A.addClass(l,"title"),A.bind(l,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),o.closed||(this.closed=!1)}o.autoPlace&&(i.isUndefined(o.parent)&&($&&(ee=document.createElement("div"),A.addClass(ee,Y),A.addClass(ee,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(ee),$=!1),ee.appendChild(this.domElement),A.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||fe(n,o.width)),this.__resizeHandler=function(){n.onResizeDebounced()},A.bind(window,"resize",this.__resizeHandler),A.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),A.bind(this.__ul,"transitionend",this.__resizeHandler),A.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),o.resizable&&pe(this),a=function(){q&&"true"===localStorage.getItem(ce(n,"isLocal"))&&localStorage.setItem(ce(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=a,o.parent||((r=n.getRoot()).width+=1,i.defer(function(){r.width-=1}))};function ie(e,t,n){var o=document.createElement("li");return t&&o.appendChild(t),n?e.__ul.insertBefore(o,n):e.__ul.appendChild(o),e.onResize(),o}function re(e){A.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&A.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function se(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function ae(e,t,n){if(n.__li=t,n.__gui=e,i.extend(n,{options:function(t){if(arguments.length>1){var o=n.__li.nextElementSibling;return n.remove(),de(e,n.object,n.property,{before:o,factoryArgs:[i.toArray(arguments)]})}if(i.isArray(t)||i.isObject(t)){var r=n.__li.nextElementSibling;return n.remove(),de(e,n.object,n.property,{before:r,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof H){var o=new B(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});i.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(e){var t=n[e],i=o[e];n[e]=o[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(o,e),t.apply(n,e)}}),A.addClass(t,"has-slider"),n.domElement.insertBefore(o.domElement,n.domElement.firstElementChild)}else if(n instanceof B){var r=function(t){if(i.isNumber(n.__min)&&i.isNumber(n.__max)){var o=n.__li.firstElementChild.firstElementChild.innerHTML,r=n.__gui.__listening.indexOf(n)>-1;n.remove();var s=de(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return s.name(o),r&&s.listen(),s}return t};n.min=i.compose(r,n.min),n.max=i.compose(r,n.max)}else n instanceof k?(A.bind(t,"click",function(){A.fakeEvent(n.__checkbox,"click")}),A.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof F?(A.bind(t,"click",function(){A.fakeEvent(n.__button,"click")}),A.bind(t,"mouseover",function(){A.addClass(n.__button,"hover")}),A.bind(t,"mouseout",function(){A.removeClass(n.__button,"hover")})):n instanceof P&&(A.addClass(t,"color"),n.updateDisplay=i.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=i.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&se(e.getRoot(),!0),t},n.setValue)}function le(e,t){var n=e.getRoot(),o=n.__rememberedObjects.indexOf(t.object);if(-1!==o){var i=n.__rememberedObjectIndecesToControllers[o];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[o]=i),i[t.property]=t,n.load&&n.load.remembered){var r=n.load.remembered,s=void 0;if(r[e.preset])s=r[e.preset];else{if(!r[Q])return;s=r[Q]}if(s[o]&&void 0!==s[o][t.property]){var a=s[o][t.property];t.initialValue=a,t.setValue(a)}}}}function de(e,t,n,o){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var i=void 0;if(o.color)i=new P(t,n);else{var r=[t,n].concat(o.factoryArgs);i=M.apply(e,r)}o.before instanceof y&&(o.before=o.before.__li),le(e,i),A.addClass(i.domElement,"c");var s=document.createElement("span");A.addClass(s,"property-name"),s.innerHTML=i.property;var a=document.createElement("div");a.appendChild(s),a.appendChild(i.domElement);var l=ie(e,a,o.before);return A.addClass(l,oe.CLASS_CONTROLLER_ROW),i instanceof P?A.addClass(l,"color"):A.addClass(l,u(i.getValue())),ae(e,l,i),e.__controllers.push(i),i}function ce(e,t){return document.location.href+"."+t}function ue(e,t,n){var o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function _e(e,t){t.style.display=e.useLocalStorage?"block":"none"}function he(e){var t=e.__save_row=document.createElement("li");A.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),A.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",A.addClass(n,"button gears");var o=document.createElement("span");o.innerHTML="Save",A.addClass(o,"button"),A.addClass(o,"save");var r=document.createElement("span");r.innerHTML="New",A.addClass(r,"button"),A.addClass(r,"save-as");var s=document.createElement("span");s.innerHTML="Revert",A.addClass(s,"button"),A.addClass(s,"revert");var a=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?i.each(e.load.remembered,function(t,n){ue(e,n,n===e.preset)}):ue(e,Q,!1),A.bind(a,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(a),t.appendChild(n),t.appendChild(o),t.appendChild(r),t.appendChild(s),q){var l=document.getElementById("dg-local-explain"),d=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(ce(e,"isLocal"))&&d.setAttribute("checked","checked"),_e(e,l),A.bind(d,"change",function(){e.useLocalStorage=!e.useLocalStorage,_e(e,l)})}var c=document.getElementById("dg-new-constructor");A.bind(c,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||Z.hide()}),A.bind(n,"click",function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),Z.show(),c.focus(),c.select()}),A.bind(o,"click",function(){e.save()}),A.bind(r,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),A.bind(s,"click",function(){e.revert()})}function pe(e){var t=void 0;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function o(){A.removeClass(e.__closeButton,oe.CLASS_DRAG),A.unbind(window,"mousemove",n),A.unbind(window,"mouseup",o)}function r(i){return i.preventDefault(),t=i.clientX,A.addClass(e.__closeButton,oe.CLASS_DRAG),A.bind(window,"mousemove",n),A.bind(window,"mouseup",o),!1}e.__resize_handle=document.createElement("div"),i.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),A.bind(e.__resize_handle,"mousedown",r),A.bind(e.__closeButton,"mousedown",r),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function fe(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function me(e,t){var n={};return i.each(e.__rememberedObjects,function(o,r){var s={},a=e.__rememberedObjectIndecesToControllers[r];i.each(a,function(e,n){s[n]=t?e.initialValue:e.getValue()}),n[r]=s}),n}function ge(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}function be(e){0!==e.length&&U.call(window,function(){be(e)}),i.each(e,function(e){e.updateDisplay()})}oe.toggleHide=function(){te=!te,i.each(ne,function(e){e.domElement.style.display=te?"none":""})},oe.CLASS_AUTO_PLACE="a",oe.CLASS_AUTO_PLACE_CONTAINER="ac",oe.CLASS_MAIN="main",oe.CLASS_CONTROLLER_ROW="cr",oe.CLASS_TOO_TALL="taller-than-window",oe.CLASS_CLOSED="closed",oe.CLASS_CLOSE_BUTTON="close-button",oe.CLASS_CLOSE_TOP="close-top",oe.CLASS_CLOSE_BOTTOM="close-bottom",oe.CLASS_DRAG="drag",oe.DEFAULT_WIDTH=245,oe.TEXT_CLOSED="Close Controls",oe.TEXT_OPEN="Open Controls",oe._keydownHandler=function(e){"text"===document.activeElement.type||e.which!==J&&e.keyCode!==J||oe.toggleHide()},A.bind(window,"keydown",oe._keydownHandler,!1),i.extend(oe.prototype,{add:function(e,t){return de(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return de(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;i.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&ee.removeChild(this.domElement);var e=this;i.each(this.__folders,function(t){e.removeFolder(t)}),A.unbind(window,"keydown",oe._keydownHandler,!1),re(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new oe(t);this.__folders[e]=n;var o=ie(this,n.domElement);return A.addClass(o,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],re(e);var t=this;i.each(e.__folders,function(t){e.removeFolder(t)}),i.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=A.getOffset(e.__ul).top,n=0;i.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=A.getHeight(t))}),window.innerHeight-t-W<n?(A.addClass(e.domElement,oe.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-W+"px"):(A.removeClass(e.domElement,oe.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&i.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:i.debounce(function(){this.onResize()},50),remember:function(){if(i.isUndefined(Z)&&((Z=new X).domElement.innerHTML=z),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;i.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&he(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&fe(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=me(this)),e.folders={},i.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=me(this),se(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Q]=me(this,!0)),this.load.remembered[e]=me(this),this.preset=e,ue(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){i.each(this.__controllers,function(t){this.getRoot().load.remembered?le(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),i.each(this.__folders,function(e){e.revert(e)}),e||se(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&be(this.__listening)},updateDisplay:function(){i.each(this.__controllers,function(e){e.updateDisplay()}),i.each(this.__folders,function(e){e.updateDisplay()})}});var ve={Color:g,math:c,interpret:l};exports.color=ve;var ye={Controller:y,BooleanController:k,OptionController:S,StringController:O,NumberController:L,NumberControllerBox:B,NumberControllerSlider:H,FunctionController:F,ColorController:P};exports.controllers=ye;var we={dom:A};exports.dom=we;var xe={GUI:oe};exports.gui=xe;var Ee=oe;exports.GUI=Ee;var Ce={color:ve,controllers:ye,dom:we,gui:xe,GUI:Ee},Ae=Ce;exports.default=Ae;
},{}],"yodp":[function(require,module,exports) {
"use strict";function t(t){if("object"==typeof t){if("buttons"in t)return t.buttons;if("which"in t){if(2===(e=t.which))return 4;if(3===e)return 2;if(e>0)return 1<<e-1}else if("button"in t){var e;if(1===(e=t.button))return 4;if(2===e)return 2;if(e>=0)return 1<<e}}return 0}function e(t){return t.target||t.srcElement||window}function n(t){if("object"==typeof t){if("offsetX"in t)return t.offsetX;var n=e(t).getBoundingClientRect();return t.clientX-n.left}return 0}function r(t){if("object"==typeof t){if("offsetY"in t)return t.offsetY;var n=e(t).getBoundingClientRect();return t.clientY-n.top}return 0}exports.buttons=t,exports.element=e,exports.x=n,exports.y=r;
},{}],"a0vS":[function(require,module,exports) {
"use strict";module.exports=t;var e=require("mouse-event");function t(t,n){n||(n=t,t=window);var r=0,o=0,i=0,s={shift:!1,alt:!1,control:!1,meta:!1},u=!1;function v(e){var t=!1;return"altKey"in e&&(t=t||e.altKey!==s.alt,s.alt=!!e.altKey),"shiftKey"in e&&(t=t||e.shiftKey!==s.shift,s.shift=!!e.shiftKey),"ctrlKey"in e&&(t=t||e.ctrlKey!==s.control,s.control=!!e.ctrlKey),"metaKey"in e&&(t=t||e.metaKey!==s.meta,s.meta=!!e.metaKey),t}function d(t,u){var d=e.x(u),m=e.y(u);"buttons"in u&&(t=0|u.buttons),(t!==r||d!==o||m!==i||v(u))&&(r=0|t,o=d||0,i=m||0,n&&n(r,o,i,s))}function m(e){d(0,e)}function a(){(r||o||i||s.shift||s.alt||s.meta||s.control)&&(o=i=0,r=0,s.shift=s.alt=s.control=s.meta=!1,n&&n(0,0,0,s))}function l(e){v(e)&&n&&n(r,o,i,s)}function E(t){0===e.buttons(t)?d(0,t):d(r,t)}function L(t){d(r|e.buttons(t),t)}function w(t){d(r&~e.buttons(t),t)}function c(){u||(u=!0,t.addEventListener("mousemove",E),t.addEventListener("mousedown",L),t.addEventListener("mouseup",w),t.addEventListener("mouseleave",m),t.addEventListener("mouseenter",m),t.addEventListener("mouseout",m),t.addEventListener("mouseover",m),t.addEventListener("blur",a),t.addEventListener("keyup",l),t.addEventListener("keydown",l),t.addEventListener("keypress",l),t!==window&&(window.addEventListener("blur",a),window.addEventListener("keyup",l),window.addEventListener("keydown",l),window.addEventListener("keypress",l)))}c();var y={element:t};return Object.defineProperties(y,{enabled:{get:function(){return u},set:function(e){e?c():u&&(u=!1,t.removeEventListener("mousemove",E),t.removeEventListener("mousedown",L),t.removeEventListener("mouseup",w),t.removeEventListener("mouseleave",m),t.removeEventListener("mouseenter",m),t.removeEventListener("mouseout",m),t.removeEventListener("mouseover",m),t.removeEventListener("blur",a),t.removeEventListener("keyup",l),t.removeEventListener("keydown",l),t.removeEventListener("keypress",l),t!==window&&(window.removeEventListener("blur",a),window.removeEventListener("keyup",l),window.removeEventListener("keydown",l),window.removeEventListener("keypress",l)))},enumerable:!0},buttons:{get:function(){return r},enumerable:!0},x:{get:function(){return o},enumerable:!0},y:{get:function(){return i},enumerable:!0},mods:{get:function(){return s},enumerable:!0}}),y}
},{"mouse-event":"yodp"}],"iSxC":[function(require,module,exports) {
"use strict";var e=!0,r={disableLog:function(r){return"boolean"!=typeof r?new Error("Argument type: "+typeof r+". Please use a boolean."):(e=r,r?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(e)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(e,r,o){var t=e.match(r);return t&&t.length>=o&&parseInt(t[o],10)},detectBrowser:function(){var e={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return e.browser="Not a supported browser.",e;e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}return e}};module.exports={log:r.log,disableLog:r.disableLog,browserDetails:r.detectBrowser(),extractVersion:r.extractVersion};
},{}],"s6SN":[function(require,module,exports) {
"use strict";var e=require("../utils.js").log;module.exports=function(){var i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var i={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var t="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==t.exact&&"number"==typeof t.exact&&(t.min=t.max=t.exact);var a=function(e,i){return e?e+i.charAt(0).toUpperCase()+i.slice(1):"deviceId"===i?"sourceId":i};if(void 0!==t.ideal){i.optional=i.optional||[];var r={};"number"==typeof t.ideal?(r[a("min",n)]=t.ideal,i.optional.push(r),(r={})[a("max",n)]=t.ideal,i.optional.push(r)):(r[a("",n)]=t.ideal,i.optional.push(r))}void 0!==t.exact&&"number"!=typeof t.exact?(i.mandatory=i.mandatory||{},i.mandatory[a("",n)]=t.exact):["min","max"].forEach(function(e){void 0!==t[e]&&(i.mandatory=i.mandatory||{},i.mandatory[a(e,n)]=t[e])})}}),e.advanced&&(i.optional=(i.optional||[]).concat(e.advanced)),i},n=function(n,t){if((n=JSON.parse(JSON.stringify(n)))&&n.audio&&(n.audio=i(n.audio)),n&&"object"==typeof n.video){var a=n.video.facingMode;if((a=a&&("object"==typeof a?a:{ideal:a}))&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete n.video.facingMode,"environment"===a.exact||"environment"===a.ideal))return navigator.mediaDevices.enumerateDevices().then(function(r){var o=(r=r.filter(function(e){return"videoinput"===e.kind})).find(function(e){return-1!==e.label.toLowerCase().indexOf("back")})||r.length&&r[r.length-1];return o&&(n.video.deviceId=a.exact?{exact:o.deviceId}:{ideal:o.deviceId}),n.video=i(n.video),e("chrome: "+JSON.stringify(n)),t(n)});n.video=i(n.video)}return e("chrome: "+JSON.stringify(n)),t(n)},t=function(e){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};navigator.getUserMedia=function(e,i,a){n(e,function(e){navigator.webkitGetUserMedia(e,i,function(e){a(t(e))})})};var a=function(e){return new Promise(function(i,n){navigator.getUserMedia(e,i,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:a,enumerateDevices:function(){return new Promise(function(e){var i={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:i[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var r=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return n(e,function(e){return r(e).then(function(i){if(e.audio&&!i.getAudioTracks().length||e.video&&!i.getVideoTracks().length)throw i.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return i},function(e){return Promise.reject(t(e))})})}}else navigator.mediaDevices.getUserMedia=function(e){return a(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){e("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){e("Dummy mediaDevices.removeEventListener called.")})};
},{"../utils.js":"iSxC"}],"uI5X":[function(require,module,exports) {
"use strict";var e=require("../utils.js").log,t=require("../utils.js").browserDetails,n={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(n){var r=new Event("track");r.track=n.track,r.receiver={track:n.track},r.streams=[e.stream],t.dispatchEvent(r)}),e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),e?(this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})):this.src=""}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(t,n){e("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy);var r=new webkitRTCPeerConnection(t,n),i=r.getStats.bind(r);return r.getStats=function(e,t,n){var r=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return i(e,t);var c=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},a=function(e,t){var n=new Map(Object.keys(e).map(function(t){return[t,e[t]]}));return t=t||e,Object.keys(t).forEach(function(e){n[e]=t[e]}),n};if(arguments.length>=2){return i.apply(this,[function(e){o[1](a(c(e)))},arguments[0]])}return new Promise(function(t,n){1===o.length&&"object"==typeof e?i.apply(r,[function(e){t(a(c(e)))},n]):i.apply(r,[function(e){t(a(c(e),e.result()))},n])}).then(t,n)},r},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){t.apply(e,[r,i,n])})}return t.apply(this,arguments)}}),t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this,r=new Promise(function(r,i){t.apply(n,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var n=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};module.exports={shimMediaStream:n.shimMediaStream,shimOnTrack:n.shimOnTrack,shimSourceObject:n.shimSourceObject,shimPeerConnection:n.shimPeerConnection,shimGetUserMedia:require("./getusermedia")};
},{"../utils.js":"iSxC","./getusermedia":"s6SN"}],"YHvh":[function(require,module,exports) {
"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(r){return r.trim().split("\n").map(function(r){return r.trim()})},r.splitSections=function(r){return r.split("\nm=").map(function(r,e){return(e>0?"m="+r:r).trim()+"\r\n"})},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(r){return 0===r.indexOf(t)})},r.parseCandidate=function(r){for(var e,t={foundation:(e=0===r.indexOf("a=candidate:")?r.substring(12).split(" "):r.substring(10).split(" "))[0],component:e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],port:parseInt(e[5],10),type:e[7]},n=8;n<e.length;n+=2)switch(e[n]){case"raddr":t.relatedAddress=e[n+1];break;case"rport":t.relatedPort=parseInt(e[n+1],10);break;case"tcptype":t.tcpType=e[n+1];break;default:t[e[n]]=e[n+1]}return t},r.writeCandidate=function(r){var e=[];e.push(r.foundation),e.push(r.component),e.push(r.protocol.toUpperCase()),e.push(r.priority),e.push(r.ip),e.push(r.port);var t=r.type;return e.push("typ"),e.push(t),"host"!==t&&r.relatedAddress&&r.relatedPort&&(e.push("raddr"),e.push(r.relatedAddress),e.push("rport"),e.push(r.relatedPort)),r.tcpType&&"tcp"===r.protocol.toLowerCase()&&(e.push("tcptype"),e.push(r.tcpType)),"candidate:"+e.join(" ")},r.parseIceOptions=function(r){return r.substr(14).split(" ")},r.parseRtpMap=function(r){var e=r.substr(9).split(" "),t={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),t.name=e[0],t.clockRate=parseInt(e[1],10),t.numChannels=3===e.length?parseInt(e[2],10):1,t},r.writeRtpMap=function(r){var e=r.payloadType;return void 0!==r.preferredPayloadType&&(e=r.preferredPayloadType),"a=rtpmap:"+e+" "+r.name+"/"+r.clockRate+(1!==r.numChannels?"/"+r.numChannels:"")+"\r\n"},r.parseExtmap=function(r){var e=r.substr(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1]}},r.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&"sendrecv"!==r.direction?"/"+r.direction:"")+" "+r.uri+"\r\n"},r.parseFmtp=function(r){for(var e,t={},n=r.substr(r.indexOf(" ")+1).split(";"),a=0;a<n.length;a++)t[(e=n[a].trim().split("="))[0].trim()]=e[1];return t},r.writeFmtp=function(r){var e="",t=r.payloadType;if(void 0!==r.preferredPayloadType&&(t=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){var n=[];Object.keys(r.parameters).forEach(function(e){n.push(e+"="+r.parameters[e])}),e+="a=fmtp:"+t+" "+n.join(";")+"\r\n"}return e},r.parseRtcpFb=function(r){var e=r.substr(r.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},r.writeRtcpFb=function(r){var e="",t=r.payloadType;return void 0!==r.preferredPayloadType&&(t=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(function(r){e+="a=rtcp-fb:"+t+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+"\r\n"}),e},r.parseSsrcMedia=function(r){var e=r.indexOf(" "),t={ssrc:parseInt(r.substr(7,e-7),10)},n=r.indexOf(":",e);return n>-1?(t.attribute=r.substr(e+1,n-e-1),t.value=r.substr(n+1)):t.attribute=r.substr(e+1),t},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(r){var e=r.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(r,e){var t="a=setup:"+e+"\r\n";return r.fingerprints.forEach(function(r){t+="a=fingerprint:"+r.algorithm+" "+r.value+"\r\n"}),t},r.getIceParameters=function(e,t){var n=r.splitLines(e);return{usernameFragment:(n=n.concat(r.splitLines(t))).filter(function(r){return 0===r.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(r){return 0===r.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(r){return"a=ice-ufrag:"+r.usernameFragment+"\r\na=ice-pwd:"+r.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),a=3;a<n.length;a++){var s=n[a],i=r.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(i){var c=r.parseRtpMap(i),p=r.matchPrefix(e,"a=fmtp:"+s+" ");switch(c.parameters=p.length?r.parseFmtp(p[0]):{},c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(r.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(r){return void 0!==r.preferredPayloadType?r.preferredPayloadType:r.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var a=0;return t.codecs.forEach(function(r){r.maxptime>a&&(a=r.maxptime)}),a>0&&(n+="a=maxptime:"+a+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],a=r.parseRtpParameters(e),s=-1!==a.fecMechanisms.indexOf("RED"),i=-1!==a.fecMechanisms.indexOf("ULPFEC"),c=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(r){return"cname"===r.attribute}),p=c.length>0&&c[0].ssrc,o=r.matchPrefix(e,"a=ssrc-group:FID").map(function(r){var e=r.split(" ");return e.shift(),e.map(function(r){return parseInt(r,10)})});o.length>0&&o[0].length>1&&o[0][0]===p&&(t=o[0][1]),a.codecs.forEach(function(r){if("RTX"===r.name.toUpperCase()&&r.parameters.apt){var e={ssrc:p,codecPayloadType:parseInt(r.parameters.apt,10),rtx:{ssrc:t}};n.push(e),s&&((e=JSON.parse(JSON.stringify(e))).fec={ssrc:t,mechanism:i?"red+ulpfec":"red"},n.push(e))}}),0===n.length&&p&&n.push({ssrc:p});var u=r.matchPrefix(e,"b=");return u.length&&(0===u[0].indexOf("b=TIAS:")?u=parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")&&(u=parseInt(u[0].substr(5),10)),n.forEach(function(r){r.maxBitrate=u})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(r){return"cname"===r.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var a=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=a.length>0,t.compound=0===a.length;var s=r.matchPrefix(e,"a=rtcp-mux");return t.mux=s.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var a=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(r){return"msid"===r.attribute});return a.length>0?{stream:(t=a[0].value.split(" "))[0],track:t[1]}:void 0},r.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,a){var s=r.writeRtpDescription(e.kind,t);if(s+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),s+="a=mid:"+e.mid+"\r\n",e.direction?s+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var i="msid:"+a.id+" "+e.rtpSender.track.id+"\r\n";s+="a="+i,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+i,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+i,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),s},r.getDirection=function(e,t){for(var n=r.splitLines(e),a=0;a<n.length;a++)switch(n[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[a].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(r){return"0"===r.split(" ",2)[1]},module.exports=r;
},{}],"YdKx":[function(require,module,exports) {
"use strict";module.exports=function(){var e=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(n){return e(n).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}};
},{}],"XRic":[function(require,module,exports) {
"use strict";var e=require("sdp"),t=require("../utils").browserDetails,n={shimPeerConnection:function(){if(window.RTCIceGatherer){window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e});var n=Object.getOwnPropertyDescriptor(MediaStreamTrack.prototype,"enabled");Object.defineProperty(MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}window.RTCPeerConnection=function(e){var n=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){n[e]=i[e].bind(i)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return n.localStreams},this.getRemoteStreams=function(){return n.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}if(this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers){var r=JSON.parse(JSON.stringify(e.iceServers));this.iceOptions.iceServers=r.filter(function(e){if(e&&e.urls){var n=e.urls;return"string"==typeof n&&(n=[n]),!!(n=n.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")||0===e.indexOf("stun:")&&t.version>=14393})[0])}return!1})}this._config=e,this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var t=this,n=e.splitSections(t.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(e){if(!e.candidate||0===Object.keys(e.candidate).length)for(var i=1;i<n.length;i++)-1===n[i].indexOf("\r\na=end-of-candidates\r\n")&&(n[i]+="a=end-of-candidates\r\n");else-1===e.candidate.candidate.indexOf("typ endOfCandidates")&&(n[e.candidate.sdpMLineIndex+1]+="a="+e.candidate.candidate+"\r\n");(t.localDescription.sdp=n.join(""),t.dispatchEvent(e),null!==t.onicecandidate&&t.onicecandidate(e),e.candidate||"complete"===t.iceGatheringState)||t.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})&&(t.iceGatheringState="complete")}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.getConfiguration=function(){return this._config},window.RTCPeerConnection.prototype.addStream=function(e){var t=e.clone();e.getTracks().forEach(function(e,n){var i=t.getTracks()[n];e.addEventListener("enabled",function(e){i.enabled=e.enabled})}),this.localStreams.push(t),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(e){for(var i=0;i<t.codecs.length;i++){var r=t.codecs[i];if(e.name.toLowerCase()===r.name.toLowerCase()&&e.clockRate===r.clockRate){r.numChannels=Math.min(e.numChannels,r.numChannels),n.codecs.push(r),r.rtcpFeedback=r.rtcpFeedback.filter(function(t){for(var n=0;n<e.rtcpFeedback.length;n++)if(e.rtcpFeedback[n].type===t.type&&e.rtcpFeedback[n].parameter===t.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var i=0;i<t.headerExtensions.length;i++){var r=t.headerExtensions[i];if(e.uri===r.uri){n.headerExtensions.push(r);break}}}),n},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(t,n){var i=this,r=new RTCIceGatherer(i.iceOptions),a=new RTCIceTransport(r);r.onlocalcandidate=function(o){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:n};var c=o.candidate,d=!c||0===Object.keys(c).length;d?(void 0===r.state&&(r.state="completed"),s.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(c.component="RTCP"===a.component?2:1,s.candidate.candidate=e.writeCandidate(c));var p=e.splitSections(i.localDescription.sdp);-1===s.candidate.candidate.indexOf("typ endOfCandidates")?p[s.candidate.sdpMLineIndex+1]+="a="+s.candidate.candidate+"\r\n":p[s.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",i.localDescription.sdp=p.join("");var l=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(i.iceGatheringState){case"new":i._localIceCandidatesBuffer.push(s),d&&l&&i._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":i._emitBufferedCandidates(),i.dispatchEvent(s),null!==i.onicecandidate&&i.onicecandidate(s),l&&(i.dispatchEvent(new Event("icecandidate")),null!==i.onicecandidate&&i.onicecandidate(new Event("icecandidate")),i.iceGatheringState="complete")}},a.onicestatechange=function(){i._updateConnectionState()};var o=new RTCDtlsTransport(a);return o.ondtlsstatechange=function(){i._updateConnectionState()},o.onerror=function(){o.state="failed",i._updateConnectionState()},{iceGatherer:r,iceTransport:a,dtlsTransport:o}},window.RTCPeerConnection.prototype._transceive=function(t,n,i){var r=this._getCommonCapabilities(t.localCapabilities,t.remoteCapabilities);n&&t.rtpSender&&(r.encodings=t.sendEncodingParameters,r.rtcp={cname:e.localCName},t.recvEncodingParameters.length&&(r.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(r)),i&&t.rtpReceiver&&("video"===t.kind&&t.recvEncodingParameters&&t.recvEncodingParameters.forEach(function(e){delete e.rtx}),r.encodings=t.recvEncodingParameters,r.rtcp={cname:t.cname},t.sendEncodingParameters.length&&(r.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(r))},window.RTCPeerConnection.prototype.setLocalDescription=function(t){var n,i,r=this;if("offer"===t.type)this._pendingOffer&&(n=e.splitSections(t.sdp),i=n.shift(),n.forEach(function(t,n){var i=e.parseRtpParameters(t);r._pendingOffer[n].localCapabilities=i}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===t.type){n=e.splitSections(r.remoteDescription.sdp),i=n.shift();var a=e.matchPrefix(i,"a=ice-lite").length>0;n.forEach(function(t,n){var o=r.transceivers[n],s=o.iceGatherer,c=o.iceTransport,d=o.dtlsTransport,p=o.localCapabilities,l=o.remoteCapabilities;if(!("0"===t.split("\n",1)[0].split(" ",2)[1])&&!o.isDatachannel){var f=e.getIceParameters(t,i);if(a){var h=e.matchPrefix(t,"a=candidate:").map(function(t){return e.parseCandidate(t)}).filter(function(e){return"1"===e.component});h.length&&c.setRemoteCandidates(h)}var u=e.getDtlsParameters(t,i);a&&(u.role="server"),r.usingBundle&&0!==n||(c.start(s,f,a?"controlling":"controlled"),d.start(u));var m=r._getCommonCapabilities(p,l);r._transceive(o,m.codecs.length>0,!1)}})}switch(this.localDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}var o=arguments.length>1&&"function"==typeof arguments[1];if(o){var s=arguments[1];window.setTimeout(function(){s(),"new"===r.iceGatheringState&&(r.iceGatheringState="gathering"),r._emitBufferedCandidates()},0)}var c=Promise.resolve();return c.then(function(){o||("new"===r.iceGatheringState&&(r.iceGatheringState="gathering"),window.setTimeout(r._emitBufferedCandidates.bind(r),500))}),c},window.RTCPeerConnection.prototype.setRemoteDescription=function(t){var n=this,i=new MediaStream,r=[],a=e.splitSections(t.sdp),o=a.shift(),s=e.matchPrefix(o,"a=ice-lite").length>0;switch(this.usingBundle=e.matchPrefix(o,"a=group:BUNDLE ").length>0,a.forEach(function(a,c){var d=e.splitLines(a)[0].substr(2).split(" "),p=d[0],l="0"===d[1],f=e.getDirection(a,o),h=e.matchPrefix(a,"a=mid:");if(h=h.length?h[0].substr(6):e.generateIdentifier(),"application"!==p||"DTLS/SCTP"!==d[2]){var u,m,v,g,w,C,T,S,y,R,E,P,b,k=e.parseRtpParameters(a);l||(E=e.getIceParameters(a,o),(P=e.getDtlsParameters(a,o)).role="client"),S=e.parseRtpEncodingParameters(a);var _=e.matchPrefix(a,"a=ssrc:").map(function(t){return e.parseSsrcMedia(t)}).filter(function(e){return"cname"===e.attribute})[0];_&&(b=_.value);var D=e.matchPrefix(a,"a=end-of-candidates",o).length>0,O=e.matchPrefix(a,"a=candidate:").map(function(t){return e.parseCandidate(t)}).filter(function(e){return"1"===e.component});if("offer"!==t.type||l)"answer"!==t.type||l||(m=(u=n.transceivers[c]).iceGatherer,v=u.iceTransport,g=u.dtlsTransport,w=u.rtpSender,C=u.rtpReceiver,T=u.sendEncodingParameters,y=u.localCapabilities,n.transceivers[c].recvEncodingParameters=S,n.transceivers[c].remoteCapabilities=k,n.transceivers[c].cname=b,(s||D)&&O.length&&v.setRemoteCandidates(O),n.usingBundle&&0!==c||(v.start(m,E,"controlling"),g.start(P)),n._transceive(u,"sendrecv"===f||"recvonly"===f,"sendrecv"===f||"sendonly"===f),!C||"sendrecv"!==f&&"sendonly"!==f?delete u.rtpReceiver:(R=C.track,r.push([R,C]),i.addTrack(R)));else{var x,G=n.usingBundle&&c>0?{iceGatherer:n.transceivers[0].iceGatherer,iceTransport:n.transceivers[0].iceTransport,dtlsTransport:n.transceivers[0].dtlsTransport}:n._createIceAndDtlsTransports(h,c);if(D&&G.iceTransport.setRemoteCandidates(O),(y=RTCRtpReceiver.getCapabilities(p)).codecs=y.codecs.filter(function(e){return"rtx"!==e.name}),T=[{ssrc:1001*(2*c+2)}],R=(C=new RTCRtpReceiver(G.dtlsTransport,p)).track,r.push([R,C]),i.addTrack(R),n.localStreams.length>0&&n.localStreams[0].getTracks().length>=c)"audio"===p?x=n.localStreams[0].getAudioTracks()[0]:"video"===p&&(x=n.localStreams[0].getVideoTracks()[0]),x&&(w=new RTCRtpSender(x,G.dtlsTransport));n.transceivers[c]={iceGatherer:G.iceGatherer,iceTransport:G.iceTransport,dtlsTransport:G.dtlsTransport,localCapabilities:y,remoteCapabilities:k,rtpSender:w,rtpReceiver:C,kind:p,mid:h,cname:b,sendEncodingParameters:T,recvEncodingParameters:S},n._transceive(n.transceivers[c],!1,"sendrecv"===f||"sendonly"===f)}}else n.transceivers[c]={mid:h,isDatachannel:!0}}),this.remoteDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}return i.getTracks().length&&(n.remoteStreams.push(i),window.setTimeout(function(){var e=new Event("addstream");e.stream=i,n.dispatchEvent(e),null!==n.onaddstream&&window.setTimeout(function(){n.onaddstream(e)},0),r.forEach(function(t){var r=t[0],a=t[1],o=new Event("track");o.track=r,o.receiver=a,o.streams=[i],n.dispatchEvent(e),null!==n.ontrack&&window.setTimeout(function(){n.ontrack(o)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":(t.connected>0||t.completed>0)&&(e="connected"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this.dispatchEvent(n),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(n)}},window.RTCPeerConnection.prototype.createOffer=function(){var t,n=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");1===arguments.length&&"function"!=typeof arguments[0]?t=arguments[0]:3===arguments.length&&(t=arguments[2]);var i=[],r=0,a=0;if(this.localStreams.length&&(r=this.localStreams[0].getAudioTracks().length,a=this.localStreams[0].getVideoTracks().length),t){if(t.mandatory||t.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==t.offerToReceiveAudio&&(r=t.offerToReceiveAudio),void 0!==t.offerToReceiveVideo&&(a=t.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){i.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?r>0:a>0}),"audio"===e.kind?r--:"video"===e.kind&&a--});r>0||a>0;)r>0&&(i.push({kind:"audio",wantReceive:!0}),r--),a>0&&(i.push({kind:"video",wantReceive:!0}),a--);var o=e.writeSessionBoilerplate(),s=[];i.forEach(function(t,i){var r,a,o=t.track,c=t.kind,d=e.generateIdentifier(),p=n.usingBundle&&i>0?{iceGatherer:s[0].iceGatherer,iceTransport:s[0].iceTransport,dtlsTransport:s[0].dtlsTransport}:n._createIceAndDtlsTransports(d,i),l=RTCRtpSender.getCapabilities(c);l.codecs=l.codecs.filter(function(e){return"rtx"!==e.name}),l.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var f=[{ssrc:1001*(2*i+1)}];o&&(r=new RTCRtpSender(o,p.dtlsTransport)),t.wantReceive&&(a=new RTCRtpReceiver(p.dtlsTransport,c)),s[i]={iceGatherer:p.iceGatherer,iceTransport:p.iceTransport,dtlsTransport:p.dtlsTransport,localCapabilities:l,remoteCapabilities:null,rtpSender:r,rtpReceiver:a,kind:c,mid:d,sendEncodingParameters:f,recvEncodingParameters:null}}),this.usingBundle&&(o+="a=group:BUNDLE "+s.map(function(e){return e.mid}).join(" ")+"\r\n"),i.forEach(function(t,i){var r=s[i];o+=e.writeMediaSection(r,r.localCapabilities,"offer",n.localStreams[0])}),this._pendingOffer=s;var c=new RTCSessionDescription({type:"offer",sdp:o});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,c),Promise.resolve(c)},window.RTCPeerConnection.prototype.createAnswer=function(){var t=this,n=e.writeSessionBoilerplate();this.usingBundle&&(n+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(i){if(i.isDatachannel)n+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+i.mid+"\r\n";else{var r=t._getCommonCapabilities(i.localCapabilities,i.remoteCapabilities);n+=e.writeMediaSection(i,r,"answer",t.localStreams[0])}});var i=new RTCSessionDescription({type:"answer",sdp:n});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,i),Promise.resolve(i)},window.RTCPeerConnection.prototype.addIceCandidate=function(t){if(t){var n=t.sdpMLineIndex;if(t.sdpMid)for(var i=0;i<this.transceivers.length;i++)if(this.transceivers[i].mid===t.sdpMid){n=i;break}var r=this.transceivers[n];if(r){var a=Object.keys(t.candidate).length>0?e.parseCandidate(t.candidate):{};if("tcp"===a.protocol&&(0===a.port||9===a.port))return;if("1"!==a.component)return;"endOfCandidates"===a.type&&(a={}),r.iceTransport.addRemoteCandidate(a);var o=e.splitSections(this.remoteDescription.sdp);o[n+1]+=(a.type?t.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=o.join("")}}else this.transceivers.forEach(function(e){e.iceTransport.addRemoteCandidate({})});return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(n){var i=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){i.set(t,e[t]),i[t]=e[t]})}),t&&window.setTimeout(t,0,i),n(i)})})}}};module.exports={shimPeerConnection:n.shimPeerConnection,shimGetUserMedia:require("./getusermedia")};
},{"sdp":"YHvh","../utils":"iSxC","./getusermedia":"YdKx"}],"GzSv":[function(require,module,exports) {
"use strict";var e=require("../utils").log,i=require("../utils").browserDetails;module.exports=function(){var n=function(e){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},r=function(r,t,a){var o=function(e){if("object"!=typeof e||e.require)return e;var i=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||i.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var t={};"number"==typeof r.ideal?t[n]={min:r.ideal,max:r.ideal}:t[n]=r.ideal,e.advanced.push(t),delete r.ideal,Object.keys(r).length||delete e[n]}}}),i.length&&(e.require=i),e};return r=JSON.parse(JSON.stringify(r)),i.version<38&&(e("spec: "+JSON.stringify(r)),r.audio&&(r.audio=o(r.audio)),r.video&&(r.video=o(r.video)),e("ff37: "+JSON.stringify(r))),navigator.mozGetUserMedia(r,t,function(e){a(n(e))})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:function(e){return new Promise(function(i,n){r(e,i,n)})},addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},i.version<41){var t=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return t().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(i.version<49){var a=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return a(e).then(function(i){if(e.audio&&!i.getAudioTracks().length||e.video&&!i.getVideoTracks().length)throw i.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return i},function(e){return Promise.reject(n(e))})}}navigator.getUserMedia=function(e,n,t){if(i.version<44)return r(e,n,t);console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(e).then(n,t)}};
},{"../utils":"iSxC"}],"Fzdr":[function(require,module,exports) {
"use strict";var e=require("../utils").browserDetails,n={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(n){var t=new Event("track");t.track=n,t.receiver={track:n},t.streams=[e.stream],this.dispatchEvent(t)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(n,t){if(e.version<38&&n&&n.iceServers){for(var o=[],r=0;r<n.iceServers.length;r++){var i=n.iceServers[r];if(i.hasOwnProperty("urls"))for(var c=0;c<i.urls.length;c++){var s={url:i.urls[c]};0===i.urls[c].indexOf("turn")&&(s.username=i.username,s.credential=i.credential),o.push(s)}else o.push(n.iceServers[r])}n.iceServers=o}return new mozRTCPeerConnection(n,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var n=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var n=RTCPeerConnection.prototype.addIceCandidate;if(RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())},e.version<48){var t=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,n,o){return t.apply(this,[e||null]).then(function(e){return function(e){var n=new Map;return Object.keys(e).forEach(function(t){n.set(t,e[t]),n[t]=e[t]}),n}(e)}).then(n,o)}}}}};module.exports={shimOnTrack:n.shimOnTrack,shimSourceObject:n.shimSourceObject,shimPeerConnection:n.shimPeerConnection,shimGetUserMedia:require("./getusermedia")};
},{"../utils":"iSxC","./getusermedia":"GzSv"}],"t1lL":[function(require,module,exports) {
"use strict";var e={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};module.exports={shimGetUserMedia:e.shimGetUserMedia};
},{}],"tI1X":[function(require,module,exports) {
"use strict";!function(){var e=require("./utils").log,r=require("./utils").browserDetails;module.exports.browserDetails=r,module.exports.extractVersion=require("./utils").extractVersion,module.exports.disableLog=require("./utils").disableLog;var i=require("./chrome/chrome_shim")||null,s=require("./edge/edge_shim")||null,o=require("./firefox/firefox_shim")||null,a=require("./safari/safari_shim")||null;switch(r.browser){case"opera":case"chrome":if(!i||!i.shimPeerConnection)return void e("Chrome shim is not included in this adapter release.");e("adapter.js shimming chrome."),module.exports.browserShim=i,i.shimGetUserMedia(),i.shimMediaStream(),i.shimSourceObject(),i.shimPeerConnection(),i.shimOnTrack();break;case"firefox":if(!o||!o.shimPeerConnection)return void e("Firefox shim is not included in this adapter release.");e("adapter.js shimming firefox."),module.exports.browserShim=o,o.shimGetUserMedia(),o.shimSourceObject(),o.shimPeerConnection(),o.shimOnTrack();break;case"edge":if(!s||!s.shimPeerConnection)return void e("MS edge shim is not included in this adapter release.");e("adapter.js shimming edge."),module.exports.browserShim=s,s.shimGetUserMedia(),s.shimPeerConnection();break;case"safari":if(!a)return void e("Safari shim is not included in this adapter release.");e("adapter.js shimming safari."),module.exports.browserShim=a,a.shimGetUserMedia();break;default:e("Unsupported browser!")}}();
},{"./utils":"iSxC","./chrome/chrome_shim":"uI5X","./edge/edge_shim":"XRic","./firefox/firefox_shim":"Fzdr","./safari/safari_shim":"t1lL"}],"lBM2":[function(require,module,exports) {
var r=require("webrtc-adapter");module.exports=function(r,e){var o,t=2===arguments.length,i="PermissionDeniedError";return t||(e=r,r={video:!0,audio:!0}),"undefined"!=typeof navigator&&navigator.getUserMedia?r.audio||r.video?void navigator.mediaDevices.getUserMedia(r).then(function(r){e(null,r)}).catch(function(r){var o;"string"==typeof r?(o=new Error("MediaStreamError")).name=r===i||"PERMISSION_DENIED"===r?i:"ConstraintNotSatisfiedError":(o=r).name||(o[i]?r.name=i:r.name="ConstraintNotSatisfiedError"),e(o)}):((o=new Error("MediaStreamError")).name="NoMediaRequestedError",setTimeout(function(){e(o)},0)):((o=new Error("MediaStreamError")).name="NotSupportedError",setTimeout(function(){e(o)},0))};
},{"webrtc-adapter":"tI1X"}],"NjTU":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n.default=e,n};Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("regl")),a=n(require("dat.gui")),r=function(){this.message="dat.gui",this.detail=125},o=new r;window.vScale=1,window.gen=!0;var u=t.default({extensions:["webgl_draw_buffers","oes_texture_float","oes_texture_float_linear"]}),c=new a.GUI,l=c.add(o,"detail",10,1080,5);l.onFinishChange(function(e){window.resizeG(e)});var i=require("mouse-change")(),v=8192,s=261.625565,f=s;window.mul=Math.pow(17,.5);var x=1,p=0;function m(e){return f*o.detail/e}window.fastMode=!1,window.simF=m;var d=0,g=0,V=0,y=(new Date).getTime(),w=(new Date).getTime();require("getusermedia")({audio:!0},function(e,n){if(window.vol=[0],!e){var t=new AudioContext,a=t.createMediaStreamSource(n),r=t.createScriptProcessor(v,1,1);console.log(t.sampleRate),r.onaudioprocess=function(e){var n=e.inputBuffer.getChannelData(0);n.map(Math.abs).reduce(function(e,n){return e+n},0),n.length;window.vScale=1;for(var a=[],r=0;r<n.length;r++)a[r]=window.gen?n[r]*window.vScale:.5*Math.sin(2*Math.PI*d/t.sampleRate*s*window.mul),d+=1;g*t.sampleRate<window.vol.length&&window.fastMode?window.vol=window.vol.concat(a):window.fastMode?(g-=window.vol.length/t.sampleRate,window.vol=a):(g=((g-n.length/t.sampleRate)%(1/f)+1/f)%(1/f),window.vol=a)},console.log(a),a.connect(r).connect(t.destination);var c,l,p=u.texture({wrapS:"clamp",wrapT:"clamp"}),h=(l=[z(c="linear"),z(c)],{read:function(){return l[0].buf},write:function(){return l[1].buf},swap:function(){l.reverse()},resize:function(e,n){l.forEach(function(t){t.tex.resize(e,n),t.buf.resize(e,n)})}});window.fboA=h;var b=u({frag:"\nprecision mediump float;\nuniform sampler2D texture;\nuniform vec2 mouse;\nuniform vec2 res;\nuniform float t;\nuniform float vol;\nvarying vec2 uv;\nuniform float mp;\n\nvoid main () {\n  vec2 uvc=(uv-vec2(0.5,0.5))*2.0;\n  if(max(abs(uvc.x),abs(uvc.y))>1.0){\n    gl_FragColor = vec4(vec3(0.0),1.0);\n      \n    return;\n  }\n  float fadeIn=20.0;\n  float easeIn=1.0;\n  if(t<fadeIn){\n    easeIn=t/fadeIn;\n  }\n    float mpt=mp;///2.0;\n    \n    vec2 cVa=texture2D(texture,uv).xy;\n    //vec2 cVa0=texture2D(texture,uv).xy;\n    float sX=cVa.x+0.0;\n    float gn=texture2D(texture,uv).z;\n    cVa.y=cVa.y*2.0-1.0;\n    //cVa0.y=cVa0.y*2.0-1.0;\n    \n    float q=0.0;\n    float qC=0.0;\n   \n      float s=1.0;\n      if(mpt>1.0){\n        s=mpt+0.0;\n        mpt=1.0;\n      }\n      float c=1.0/(s);\n    vec2 up=uv+vec2(0.0,-1.0)/res.xy*s;\n    vec2 left=uv+vec2(-1.0,0.0)/res.xy*s;\n    vec2 right=uv+vec2(1.0,0.0)/res.xy*s;\n    vec2 down=uv+vec2(0.0,1.0)/res.xy*s;\n    \n    vec2 uVa=texture2D(texture,up).xy;\n    uVa.y=uVa.y*2.0-1.0;\n    vec2 lVa=texture2D(texture,left).xy;\n    lVa.y=lVa.y*2.0-1.0;\n    vec2 rVa=texture2D(texture,right).xy;\n    rVa.y=rVa.y*2.0-1.0;\n    vec2 dVa=texture2D(texture,down).xy;\n    dVa.y=dVa.y*2.0-1.0;\n    float oS=0.0;\n    q+=(dVa.x+dVa.y*oS-cVa.y*oS)*c;\n    q+=(uVa.x+uVa.y*oS-cVa.y*oS)*c;\n    q+=(lVa.x+lVa.y*oS-cVa.y*oS)*c;\n    q+=(rVa.x+rVa.y*oS-cVa.y*oS)*c;\n    qC+=c*4.0;\n    float pos=cVa.x-0.5;\n    \n    float accel=(q/qC-cVa.x)*mpt;\n    float vel=(cVa.y+0.0);//+accel/2.0;\n    cVa.y+=accel;\n    \n    \n    \n    float gnt=0.0;\n   \n    if(t<fadeIn){\n        \n        cVa=(vec2(0.5,0.0)*(1.0-easeIn)+cVa*(easeIn));\n        pos=0.0*(1.0-easeIn)+pos*(easeIn);\n        //gn=0.0;\n    }\n    gnt=gn;//1.0;//abs(abs(rVa.x-0.5)+abs(lVa.x-0.5)+abs(uVa.x-0.5)+abs(dVa.x-0.5)-abs((rVa.x-0.5)+(lVa.x-0.5)+(uVa.x-0.5)+(dVa.x-0.5))*2.0)+abs(cVa.x-0.5);\n    float apRat=pow(abs(-accel/mpt/mpt/pos),0.5);\n    gnt=pow(pow(pos,2.0)+pow(vel/mpt/mpt,2.0)/abs(-accel/mpt/mpt/pos),0.5);\n   float H=gnt;\n    \n    //cVa.y=(vec2(0.5,0.0)*0.001+cVa*0.999).y;\n    float j=1.0-length((((uv-vec2(0.5))*res.xy)))*1.3;//pow(2.0,-pow(length(abs(uv-vec2(0.5))*res.xy)/10.0,2.0));\n    cVa.x+=cVa.y*mpt;\n    \n    if( j>0.0 ){\n   j=1.0;\n    float dp=vol/2.0+0.5;\n   \n      cVa=(cVa*(1.0-j)+vec2(dp,0.0)*j);//cos(t*0.1*2.0*atan(0.0,-1.0))/4.0+0.5;\n       }\n    \n  \n   \n   \n        gnt=H;\n        if(abs(gnt)<=1.0){//} && abs(pos)>gnt/2.0){//&& dot(pos,vel)>=0.0 && dot(vel+accel,vel)<=0.0 ){//} && abs(vel+pos-accel/2.0)>=abs(pos))){\n    \n      float le=max(gn/1000.0,0.00001);//max(min((1.0-pow(0.5,1.0*apRat/100.0)),0.01),0.00001);//min(abs(vel*2.0+pos-0.5)/abs(pos-0.5)*0.001+0.00001,1.0);\n      gnt=gnt;\n      //gn=gnt*le+gn*(1.0-le);//+min(max(gnt-gn,-le),le);\n      gn=gn+min(max(gnt-gn,-le),le);\n    }\n    \n  \n   \n    \n    if(true||mod(float(t),1024.0*128.0)<1.0||abs(vel)>=abs(pos+abs(vel)*sign(pos))){\n     \n      float d=0.001;//abs(pos+abs(vel)*s\n    cVa=(vec2(0.5,0.0)*d+cVa*(1.0-d));\n\n    }\n   \n    vec2 outp=vec2(cVa.x,cVa.y*0.5+0.5);\n\n    gn=max(min(1.0,gn),0.0);\n    outp.x=max(min(1.0,outp.x),0.0);\n    outp.y=max(min(1.0,outp.y),0.0);\n    gl_FragColor = vec4(vec3(outp,gn),1.0);\n}",vert:"\n\n  precision mediump float;\n  attribute vec2 position;\n  varying vec2 uv;\n  void main () {\n    uv = position/2.0+vec2(0.5,0.5);\n    gl_Position = vec4(position, 0, 1);\n  }\n  ",attributes:{position:[-1,-1,3,-1,-1,3]},framebuffer:function(){return h.write()},uniforms:{texture:function(){return h.read()},mouse:function(e){var n=e.pixelRatio,t=e.viewportHeight;e.viewportWidth;return[i.x*n,t-i.y*n]},res:function(e){e.viewportHeight,e.viewportWidth;return[o.detail,o.detail]},t:function(e){return e.tick},vol:function(){return e=g*t.sampleRate,n=e%1,(window.vol[Math.floor(e%v)]||0)*(1-n)+(window.vol[Math.floor((e+1)%v)]||0)*n;var e,n},mp:function(){return x}},blend:{enable:!1,func:{srcRGB:"src color",srcAlpha:1,dstRGB:"src color",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,0]},count:3}),D=u({frag:"\n    precision mediump float;\n    uniform sampler2D texture;\n    uniform sampler2D p;\n    uniform sampler2D textureB;\n    uniform sampler2D textureC;\n    uniform vec2 mouse;\n    uniform vec2 res;\n    uniform vec2 resp;\n    uniform float t;\n    varying vec2 uv;\n    float hue2rgb(float f1, float f2, float hue) {\n      if (hue < 0.0)\n          hue += 1.0;\n      else if (hue > 1.0)\n          hue -= 1.0;\n      float res;\n      if ((6.0 * hue) < 1.0)\n          res = f1 + (f2 - f1) * 6.0 * hue;\n      else if ((2.0 * hue) < 1.0)\n          res = f2;\n      else if ((3.0 * hue) < 2.0)\n          res = f1 + (f2 - f1) * ((2.0 / 3.0) - hue) * 6.0;\n      else\n          res = f1;\n      return res;\n  }\n  \n  vec3 hsl2rgb(vec3 hsl) {\n      vec3 rgb;\n      \n      if (hsl.y == 0.0) {\n          rgb = vec3(hsl.z); // Luminance\n      } else {\n          float f2;\n          \n          if (hsl.z < 0.5)\n              f2 = hsl.z * (1.0 + hsl.y);\n          else\n              f2 = hsl.z + hsl.y - hsl.y * hsl.z;\n              \n          float f1 = 2.0 * hsl.z - f2;\n          \n          rgb.r = hue2rgb(f1, f2, hsl.x + (1.0/3.0));\n          rgb.g = hue2rgb(f1, f2, hsl.x);\n          rgb.b = hue2rgb(f1, f2, hsl.x - (1.0/3.0));\n      }   \n      return rgb;\n  }\n  \n  vec3 normAt(vec2 p){\n    float mp=1.0;\n        float qb=2.0;\n        vec2 rc=vec2(min(res.x,res.y));\n        vec2 uv2=p;\n        vec2 up=uv2+vec2(0.0,-1.0)/resp.xy*qb;\n        vec2 left=uv2+vec2(-1.0,0.0)/resp.xy*qb;\n        vec2 right=uv2+vec2(1.0,0.0)/resp.xy*qb;\n        vec2 down=uv2+vec2(0.0,1.0)/resp.xy*qb;\n        vec2 cVa=texture2D(texture,uv2).xy;\n        float gn=texture2D(texture,uv2).z;\n        float gnB=texture2D(texture,vec2(0.0,0.0)).z;\n        cVa.y=cVa.y*2.0-1.0;\n        vec2 uVa=texture2D(texture,up).xy;\n        uVa.y=uVa.y*2.0-1.0;\n        vec2 lVa=texture2D(texture,left).xy;\n        lVa.y=lVa.y*2.0-1.0;\n        vec2 rVa=texture2D(texture,right).xy;\n        rVa.y=rVa.y*2.0-1.0;\n        vec2 dVa=texture2D(texture,down).xy;\n        dVa.y=dVa.y*2.0-1.0;\n        vec2 aa=(cVa+uVa+dVa+lVa+rVa)/5.0;\n        \n        //cVa.x+=cVa.y*mp;\n        //uVa.x+=uVa.y*mp;\n        //lVa.x+=lVa.y*mp;\n        //rVa.x+=rVa.y*mp;\n        //dVa.x+=dVa.y*mp;\n        vec3 normal=vec3(0.0,0.0,0.0);\n        float h=100.0;\n       \n        \n        \n        \n        \n        normal+=normalize(vec3(gn-texture2D(texture,right).z,0.0,1.0/h));\n        normal+=normalize(-vec3(gn-texture2D(texture,left).z,0.0,-1.0/h));\n        normal+=normalize(vec3(0.0,gn-texture2D(texture,down).z,1.0/h));\n        normal+=normalize(-vec3(0.0,gn-texture2D(texture,up).z,-1.0/h));\n        normal=normalize(normal);\n        return normal;\n  }\n    void main () {\n      vec2 rc=vec2(min(res.x,res.y));\n        vec2 uv2=(uv-vec2(0.5,0.5)-vec2(0.5,0.5)/res.xy*0.0)*res.xy/rc.xy+vec2(0.5,0.5);\n        vec2 uvc=(uv2-vec2(0.5,0.5))*2.0;\n        if(max(abs(uvc.x),abs(uvc.y))>1.0){\n          gl_FragColor = vec4(vec3(0.0),1.0);\n            \n          return;\n        }\n        float gn=texture2D(texture,uv2).z;\n     \n      gl_FragColor = vec4(vec3( min(max(1.0-gn/texture2D(texture,vec2(0.0)).z,0.0),1.0)),1.0);\n        float mp=1.0;\n        float qb=0.5;\n        vec2 up=uv2+vec2(0.0,-1.0)/resp.xy*qb;\n        vec2 left=uv2+vec2(-1.0,0.0)/resp.xy*qb;\n        vec2 right=uv2+vec2(1.0,0.0)/resp.xy*qb;\n        vec2 down=uv2+vec2(0.0,1.0)/resp.xy*qb;\n        vec2 cVa=texture2D(texture,uv2).xy;\n        float gnB=texture2D(texture,vec2(0.0,0.0)).z;\n        cVa.y=cVa.y*2.0-1.0;\n        vec2 uVa=texture2D(texture,up).xy;\n        uVa.y=uVa.y*2.0-1.0;\n        vec2 lVa=texture2D(texture,left).xy;\n        lVa.y=lVa.y*2.0-1.0;\n        vec2 rVa=texture2D(texture,right).xy;\n        rVa.y=rVa.y*2.0-1.0;\n        vec2 dVa=texture2D(texture,down).xy;\n        dVa.y=dVa.y*2.0-1.0;\n        vec2 aa=(cVa+uVa+dVa+lVa+rVa)/5.0;\n        \n        //cVa.x+=cVa.y*mp;\n        //uVa.x+=uVa.y*mp;\n        //lVa.x+=lVa.y*mp;\n        //rVa.x+=rVa.y*mp;\n        //dVa.x+=dVa.y*mp;\n        vec3 normal=vec3(0.0);\n        vec2 jDir=vec2(0.0);\n        vec3 mep=vec3(uv2,texture2D(texture,uv2).z);\n        float hb=0.0;\n        float tt=0.0;\n        for(int i=-2;i<=2;i++){\n          for(int j=-2;j<=2;j++){\n            if((i*i>0 || j*j>0 )&& length(vec2(i,j))<=10.0){//} && abs(float(i*j))<1.0){\n              \n            vec2 op=uv2+vec2(float(i),float(j))/resp.xy*qb;\n            vec2 op2=uv2+vec2(float(j),-float(i))/resp.xy*qb;\n            float pV=pow(length(vec2(i,j)),0.0);\n            tt+=pV;\n            if(texture2D(texture,op).z>texture2D(texture,uv2).z){//abs(texture2D(texture,op).y-0.5)>abs(texture2D(texture,uv2).y-0.5)){// && texture2D(texture,uv2-op*2.0).z>gn){\n              hb+=pV;\n              }\n              float mmm=1.0;\n                if(vec2(float(i),float(j)).y<0.0 ||(vec2(float(i),float(j)).y<=0.0 &&vec2(float(i),float(j)).x<=0.0)){\n                  mmm=-1.0;\n                }\n                if(length(vec2(i,j))<=10.0){\n                jDir+=vec2(float(i),float(j))*mmm*(texture2D(texture,op).z-texture2D(texture,op2).z);\n                }\n            //hb=hb+texture2D(texture,op).z/gnB;\n              vec3 opp=vec3(op,texture2D(texture,op).z)-mep;\n              vec3 opp2=vec3(op2,texture2D(texture,op2).z)-mep;\n              normal+=normalize(cross(opp,opp2));\n            }\n          }\n        }\n        normal=normalize(normal);\n        normal.xy=normalize(jDir);\n        \n        //normalize(normAt(uv2)+normAt(up)+normAt(left)+normAt(down)+normAt(right));\n        float colA=atan(normal.y,normal.x)/atan(0.0,-1.0)/2.0;\n        //if(cVa.y<0.0){\n          //colA+=0.5;\n          //colA=mod(colA,1.0);\n        //}\n        //if(uvc.x<0.0){\n          colA=mod(colA,1.0);\n          colA=colA*2.0;\n          colA=mod(colA,1.0);\n          //colA+=0.5;\n        //}\n        // if(gnB*0.5<gn){\n        //   normal=-normal;\n        // }\n       \n        gn=((hb/tt*2.0-1.0)*2.0)/2.0;\n//         if(1.0-texture2D(texture,uv2).z/texture2D(texture,vec2(0.0)).z<0.5){\n// gn=0.0;\n//         }\n        //gn=gn*gn;\n        // if(gn<0.5){\n        //   gn=0.0;\n        // }\n        vec3 col=hsl2rgb(vec3(mod(colA,1.0),1.0,min(max(gn,0.0),1.0)));//max(1.0-10.0*pow(pow((cVa.x-0.5)*4.0,2.0)+pow(cVa.y*8.0,2.0),0.5),0.0)));\n      vec4 cooo = vec4(col,1.0);\n      //gl_FragColor=vec4(vec3(1.0-texture2D(texture,uv2).z/texture2D(texture,vec2(0.0)).z,1.0-texture2D(textureB,uv2).z/texture2D(textureB,vec2(0.0)).z,1.0-texture2D(textureC,uv2).z/texture2D(textureC,vec2(0.0)).z),1.0);\n    //gl_FragColor=vec4(vec3(texture2D(texture,uv2).z,texture2D(textureB,uv2).z,texture2D(textureC,uv2).z),1.0);\n     \n      \n      gl_FragColor=cooo+texture2D(p,uv)*0.0;\n    }",vert:"\n    precision mediump float;\n    attribute vec2 position;\n    varying vec2 uv;\n    void main () {\n      uv = position/2.0+vec2(0.5,0.5);\n      gl_Position = vec4(position, 0, 1);\n    }",attributes:{position:[-1,-1,3,-1,-1,3]},uniforms:{texture:h.read(),p:p,mouse:function(e){var n=e.pixelRatio,t=e.viewportHeight;e.viewportWidth;return[i.x*n,t-i.y*n]},res:function(e){var n=e.viewportHeight;return[e.viewportWidth,n]},resp:function(e){e.viewportHeight,e.viewportWidth;return[o.detail,o.detail]},t:function(e){return e.tick}},count:3});window.resizeG=function(e,n){o.detail=e,h.resize(o.detail,o.detail)};!function e(){for(var n=(new Date).getTime(),a=0;a<4096;a++){if(V+=1,!(g*t.sampleRate<window.vol.length)){V+=4096-a;break}b(),h.swap(),g+=1/m(x),window.gd=[g*t.sampleRate,window.vol.length]}if((n=(new Date).getTime())-w>1e3){console.log("sps",V,"need",f*o.detail,t.sampleRate/(f*o.detail),o.detail),w=n;var r=0;r=Math.min(Math.floor(r),0);var u=Math.floor(t.sampleRate);V>=u/1?(x=1,console.log("subSuper",u,"stepsQ",V),window.fastMode=!0,x>1&&(x=1,window.fastMode=!1)):(x=1,window.fastMode=!1),V=0}window.mpp=x,y=n,window.setTimeout(e,0)}(),u.frame(function(){D()})}function z(e){var n=u.texture({type:"float",width:o.detail,height:o.detail,mag:"linear"});return{tex:n,buf:u.framebuffer({color:n,depthStencil:!1})}}});
},{"regl":"Jx9Q","dat.gui":"KkZG","mouse-change":"a0vS","getusermedia":"lBM2"}]},{},["NjTU"], null)
//# sourceMappingURL=v4.bb11b379.js.map